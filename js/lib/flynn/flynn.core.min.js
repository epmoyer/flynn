var Flynn=Flynn||{};!function(){"use strict";Flynn.VERSION="2.6.1",Flynn.init=function(t,e,n,i,o,s,r){"undefined"==typeof s&&(s=!1),"undefined"==typeof r&&(r=!1),new Flynn.Mcp(t,e,n,i,o,s,r)},Flynn.TICKS_PER_SECOND=60,Flynn.DevPacingMode={NORMAL:0,SLOW_MO:1,FPS_20:2},Flynn.Colors={BLACK:"#000000",BLUE:"#2020FF",WHITE:"#FFFFFF",GREEN:"#00FF00",YELLOW:"#FFFF00",RED:"#FF0000",CYAN:"#00FFFF",MAGENTA:"#FF00FF",CYAN_DK:"#008080",ORANGE:"#E55300",BROWN:"#8B4513",YELLOW_DK:"#807000",GRAY:"#808080",GRAY_DK:"#404040",LIGHTSKYBLUE:"#87CEFA",DODGERBLUE:"#1E90FF",LIGHTBLUE:"#ADD8E6"},Flynn.ColorsOrdered=[Flynn.Colors.BLACK,Flynn.Colors.BLUE,Flynn.Colors.WHITE,Flynn.Colors.GREEN,Flynn.Colors.YELLOW,Flynn.Colors.RED,Flynn.Colors.CYAN,Flynn.Colors.MAGENTA,Flynn.Colors.CYAN_DK,Flynn.Colors.ORANGE,Flynn.Colors.BROWN,Flynn.Colors.YELLOW_DK,Flynn.Colors.GRAY,Flynn.Colors.GRAY_DK,Flynn.Colors.LIGHTSKYBLUE,Flynn.Colors.DODGERBLUE,Flynn.Colors.LIGHTBLUE],Flynn.KeyboardMap={num_0:48,num_1:49,num_2:50,num_3:51,num_4:52,num_5:53,num_6:54,num_7:55,num_8:56,num_9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,semicolon:186,equals:187,comma:188,dash:189,period:190,forward_slash:191,grave_accent:192,left_bracket:219,backslash:220,right_bracket:221,single_quote:222,delete:8,tab:9,enter:13,shift:16,control:17,option:18,escape:27,spacebar:32,left:37,up:38,right:39,down:40,l_command:91,r_command:93,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,icade_up:-1,icade_down:-2,icade_left:-3,icade_right:-4,icade_t1:-5,icade_t2:-6,icade_t3:-7,icade_t4:-8,icade_b1:-9,icade_b2:-10,icade_b3:-11,icade_b4:-12},Flynn.Points={FLYNN_LOGO:[9e3,8014,-21,-9,-21,5,-19,5,-19,-1,-15,-1,-15,-3,-19,-3,-19,-7,17,-7,17,-9,-21,-9,9e3,7e3,-13,5,-13,-5,-11,-5,-11,3,-7,3,-7,5,-13,5,9e3,7e3,-9,-5,9e3,8005,-4,0,-4,5,-2,5,-2,0,3,-5,0,-5,-3,-2,-6,-5,-9,-5,9e3,7e3,1,5,9e3,8014,1,-1,9e3,8001,4,-4,9e3,8014,6,0,6,-5,8,-5,8,5,6,5,3,-1,3,5,1,5,9e3,7e3,10,-5,10,5,12,5,12,-1,15,5,17,5,17,-5,15,-5,15,0,13,-5,10,-5,9e3,7e3,19,-9,19,7,-21,7,-21,9,21,9,21,-9,19,-9]},Flynn.PEN_COMMAND=9e3,Flynn.PEN_UP=7e3,Flynn.PEN_COLOR0=8e3,Flynn.Font={},Flynn.Font.Normal={CharacterHeight:6,CharacterWidth:4,CharacterGap:2,CharacterSpacing:6,Points:{UNIMPLEMENTED_CHAR:[0,0,4,6,4,0,0,6,0,0,4,0,9e3,7e3,0,6,4,6],ASCII:[[1,0,2,5,1.5,5,1.5,6,2.5,6,2.5,5,2,5,3,0,1,0],[1,0,1,1,9e3,7e3,3,0,3,1],[1,5,1,1,9e3,7e3,0,2,4,2,9e3,7e3,3,1,3,5,9e3,7e3,4,4,0,4],[0,6,3,6,4,5,4,4,3,3,1,3,0,2,0,1,1,0,4,0,9e3,7e3,2,0,2,6],[0,6,4,0,9e3,7e3,2,5,2,1,0,1,0,3,4,3,4,5,2,5],[4,6,1,2,1,1,2,0,3,1,3,2,0,4,0,5,1,6,2,6,4,4],[2,0,2,1,2,0],[4,6,3,6,2,5,2,1,3,0,4,0],[1,0,2,0,3,1,3,5,2,6,1,6],[0,1,4,5,9e3,7e3,2,5,2,1,9e3,7e3,4,3,0,3,9e3,7e3,0,5,4,1],[2,5,2,1,9e3,7e3,0,3,4,3],[2,5,1,6,2,5],[1,3,3,3],[1.5,6,1.5,5,2.5,5,2.5,6,1.5,6],[1,6,3,0,1,6],[0,0,4,0,4,6,0,6,0,0],[2,0,2,6],[0,0,4,0,4,3,0,3,0,6,4,6],[0,0,4,0,4,6,0,6,9e3,7e3,0,3,4,3],[4,6,4,0,9e3,7e3,0,0,0,3,4,3],[4,0,0,0,0,3,4,3,4,6,0,6],[0,0,0,6,4,6,4,3,0,3],[0,0,4,0,4,6],[4,0,4,6,0,6,0,0,4,0,9e3,7e3,0,3,4,3],[4,3,0,3,0,0,4,0,4,6],[2,1,1.5,1.5,2,2,2.5,1.5,2,1,9e3,7e3,2,4,1.5,4.5,2,5,2.5,4.5,2,4],[2,1,1.5,1.5,2,2,2.5,1.5,2,1,9e3,7e3,1.5,4,2.5,4,1.5,6,1.5,4],[4,1,0,3,4,5,0,3,4,1],[0,1.5,4,1.5,9e3,7e3,0,4.5,4,4.5],[0,1,4,3,0,5,4,3,0,1],[0,2,0,1,1,0,3,0,4,1,4,2,2,3,2,6,2,3,4,2,4,1,3,0,1,0,0,1,0,2],[3,4,3,2,1,2,1,4,4,4,4,2,3,1,1,1,0,2,0,4,1,5,3,5],[0,6,0,2,2,0,4,2,4,6,9e3,7e3,0,4,4,4],[2,3,3,4,3,5,2,6,0,6,0,0,2,0,3,1,3,2,2,3,0,3],[4,0,0,0,0,6,4,6],[0,0,0,6,2,6,4,4,4,2,2,0,0,0],[4,0,0,0,0,6,4,6,9e3,7e3,0,3,4,3],[0,6,0,0,4,0,9e3,7e3,0,3,3,3],[4,2,4,0,0,0,0,6,4,6,4,4,2,4],[0,0,0,6,9e3,7e3,4,6,4,0,9e3,7e3,0,3,4,3],[0,0,4,0,9e3,7e3,0,6,4,6,9e3,7e3,2,0,2,6],[4,0,4,6,2,6,0,4],[0,0,0,6,9e3,7e3,3,6,0,3,3,0],[0,0,0,6,4,6],[0,6,0,0,2,2,4,0,4,6],[0,6,0,0,4,6,4,0],[0,0,4,0,4,6,0,6,0,0],[0,6,0,0,4,0,4,3,0,3],[0,0,0,6,2,6,4,4,4,0,0,0,9e3,7e3,2,4,4,6],[0,3,4,3,4,0,0,0,0,6,9e3,7e3,4,6,1,3],[4,0,0,0,0,3,4,3,4,6,0,6],[0,0,4,0,9e3,7e3,2,6,2,0],[0,0,0,6,4,6,4,0],[0,0,2,6,4,0],[0,0,0,6,2,4,4,6,4,0],[0,0,4,6,9e3,7e3,4,0,0,6],[2,6,2,3,4,0,9e3,7e3,0,0,2,3],[0,0,4,0,0,6,4,6],[3,0,1,0,1,6,3,6],[1,0,3,6],[1,0,3,0,3,6,1,6],[1,1,2,0,3,1],[0,6,4,6],[1.5,0,2.5,1]]}},Flynn.Font.Block={CharacterHeight:10,CharacterWidth:6,CharacterGap:3,CharacterSpacing:9,Points:{}},Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR=[0,0,6,10,6,0,0,10,0,0,6,0,9e3,7e3,0,10,6,10],Flynn.Font.Block.Points.ASCII=[Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,[0,6,6,6,6,4,0,4,0,6],Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,[0,1,0,9,1,10,5,10,6,9,6,1,5,0,1,0,0,1,9e3,7e3,2,2,4,2,4,8,2,8,2,2],[2,8,1,8,1,10,5,10,5,8,4,8,4,0,2,0,1,1,1,2,2,2,2,8],[0,1,0,3,2,3,2,2,4,2,0,8,0,10,6,10,6,8,2,8,6,2,6,1,5,0,1,0,0,1],[0,1,0,3,2,3,2,2,4,2,4,4,2,4,2,6,4,6,4,8,2,8,2,7,0,7,0,9,1,10,5,10,6,9,6,1,5,0,1,0,0,1],[4,10,6,10,6,0,3,0,0,4,0,6,4,6,4,10,9e3,7e3,4,2,2.25,4,4,4,4,2],[0,10,5,10,6,9,6,5,5,4,2,4,2,2,6,2,6,0,0,0,0,6,4,6,4,8,0,8,0,10],[6,1,6,3,4,3,4,2,2,2,2,4,5,4,6,5,6,9,5,10,1,10,0,9,0,1,1,0,5,0,6,1,9e3,7e3,2,6,2,8,4,8,4,6,2,6],[0,10,2.25,10,5.75,0,0,0,0,2,3,2,0,10],[0,1,0,9,1,10,5,10,6,9,6,1,5,0,1,0,0,1,9e3,7e3,2,2,2,4,4,4,4,2,2,2,9e3,7e3,4,6,4,8,2,8,2,6,4,6],[0,7,0,9,1,10,5,10,6,9,6,1,5,0,1,0,0,1,0,5,1,6,4,6,4,8,2,8,2,7,0,7,9e3,7e3,2,2,2,4,4,4,4,2,2,2],Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,[0,0,0,10,2,10,2,6,4,6,4,10,6,10,6,0,0,0,9e3,7e3,2,2,4,2,4,4,2,4,2,2],[0,0,0,10,5,10,6,9,6,6,5,5,6,4,6,1,5,0,0,0,9e3,7e3,2,2,4,2,4,4,2,4,2,2,9e3,7e3,2,6,4,6,4,8,2,8,2,6],[2,2,6,2,6,0,0,0,0,10,6,10,6,8,2,8,2,2],[0,0,0,10,4,10,5,9,6,7,6,3,5,1,4,0,0,0,9e3,7e3,2,2,3,2,4,3,4,7,3,8,2,8,2,2],[0,0,0,10,6,10,6,8,2,8,2,6,3,6,5,4,2,4,2,2,6,2,6,0,0,0],[0,0,0,10,2,10,2,6,3,6,5,4,2,4,2,2,6,2,6,0,0,0],[2,2,6,2,6,0,0,0,0,10,6,10,6,5,3,5,4,6,4,8,2,8,2,2],[0,0,0,10,2,10,2,6,4,6,4,10,6,10,6,0,4,0,4,4,2,4,2,0,0,0],[0,0,0,2,2,2,2,8,0,8,0,10,6,10,6,8,4,8,4,2,6,2,6,0,0,0],[4,0,4,8,2,8,2,7,0,6,0,9,1,10,5,10,6,9,6,2,6,0,4,0],[0,0,0,10,2,10,2,7,4,10,6.5,10,3.25,5,6.5,0,4,0,2,3,2,0,0,0],[0,0,0,10,6,10,6,8,2,8,2,0,0,0],[0,0,0,10,2,10,2,4,3,6,4,4,4,10,6,10,6,0,4,0,3,2,2,0,0,0],[0,0,0,10,2,10,2,5,4,10,6,10,6,0,4,0,4,5,2,0,0,0],[0,1,0,9,1,10,5,10,6,9,6,1,5,0,1,0,0,1,9e3,7e3,2,2,4,2,4,8,2,8,2,2],[0,0,0,10,2,10,2,6,5,6,6,5,6,1,5,0,0,0,9e3,7e3,2,2,4,2,4,4,2,4,2,2],[6,0,0,0,0,10,3,10,4,9,5,10,6,9,5,8,6,7,6,0,9e3,7e3,4,2,2,2,2,8,4,6,4,2],[0,0,0,10,2,10,2,6,4,10,6,10,4,6,5,6,6,5,6,1,5,0,0,0,9e3,7e3,2,2,4,2,4,4,2,4,2,2],[6,0,1,0,0,1,0,5,1,6,4,6,4,8,0,8,0,10,5,10,6,9,6,5,5,4,2,4,2,2,6,2,6,0],[0,0,0,2,2,2,2,10,4,10,4,2,6,2,6,0,0,0],[0,0,0,9,1,10,5,10,6,9,6,0,4,0,4,8,2,8,2,0,0,0],[0,0,3,10,6,0,4,0,3,4,2,0,0,0],[0,0,0,10,2,10,3,8,4,10,6,10,6,0,4,0,4,6,3,4,2,6,2,0,0,0],[0,0,2,5,0,10,2,10,3,7,4,10,6,10,4,5,6,0,4,0,3,3,2,0,0,0],[-.5,0,2,5,2,10,4,10,4,5,6.5,0,4,0,3,2,2,0,-.5,0],[0,0,0,2,4,2,0,8,0,10,6,10,6,8,2,8,6,2,6,0,0,0],Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR],Flynn.sounds={ui_move:new Howl({src:["sounds/UI_move.webm","sounds/UI_move.mp3"],volume:.4}),ui_select:new Howl({src:["sounds/UI_select.webm","sounds/UI_select.mp3"],volume:.4}),ui_cancel:new Howl({src:["sounds/UI_cancel.webm","sounds/UI_cancel.mp3"],volume:.4}),ui_success:new Howl({src:["sounds/UI_success.webm","sounds/UI_success.mp3"],volume:.4}),ui_error:new Howl({src:["sounds/UI_error.webm","sounds/UI_error.mp3"],volume:.4})},Flynn.Rect=Class.extend({init:function(t,e,n,i){this.object_id="Flynn.Rect",this.left=t,this.top=e,this.width=n,this.height=i,this.center_x=this.left+this.width/2,this.center_y=this.top+this.height/2,this.right=this.left+this.width,this.bottom=this.top+this.height},clone:function(){return new Flynn.Rect(this.left,this.top,this.width,this.height)}})}(),function(){"use strict";Flynn.Util={getUrlValue:function(t){for(var e=window.location.search.substring(1),n=e.split("&"),i=0;i<n.length;i++){var o=n[i].split("=");if(o[0]==t)return o[1]}},getUrlFlag:function(t){for(var e=window.location.search.substring(1),n=e.split("&"),i=0;i<n.length;i++){var o=n[i].split("=");if(o[0]==t)return!0}return!1},hexToRgb:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},componentToHex:function(t){var e=Math.floor(t).toString(16);return 1==e.length?"0"+e:e},rgbToHex:function(t,e,n){return"#"+Flynn.Util.componentToHex(t)+Flynn.Util.componentToHex(e)+Flynn.Util.componentToHex(n)},rgbOverdirve:function(t,e){var n={r:Math.floor(t.r+(255-t.r)*e),g:Math.floor(t.g+(255-t.g)*e),b:Math.floor(t.b+(255-t.b)*e)};return n},angleBound2Pi:function(t){var e=t%(2*Math.PI);return e<0&&(e+=2*Math.PI),e},minMaxBound:function(t,e,n){return t<e?e:t>n?n:t},proximal:function(t,e,n){return Math.abs(e-n)<=t},distance:function(t,e,n,i){return Math.sqrt(Math.pow(n-t,2)+Math.pow(i-e,2))},interceptSolution:function(t,e,n,i){var o={perfect:!1,velocity_v:null},s=t.clone().subtract(n).normalize(),r=s.dot(e),a=s.clone().multiply(new Victor(r,r)),l=e.clone().subtract(a),h=l.clone(),c=h.magnitude(),u=i*i-c*c,d=0;u>0&&(d=Math.sqrt(u));var p=s.clone().multiply(new Victor(d,d));return o.velocity_v=p.add(h),o},zeroPad:function(t,e){var n=e-t.toString().length+1;return Array(+(n>0&&n)).join("0")+t},ticksToTime:function(t){var e=t/60,n=Math.floor(100*(e-Math.floor(e))),i=Math.floor(e/60),o=Math.floor((t-60*i*60)/60);return Flynn.Util.zeroPad(i,2)+":"+Flynn.Util.zeroPad(o,2)+"."+Flynn.Util.zeroPad(n,2)},randomIntFromInterval:function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},randomFromInterval:function(t,e){return Math.random()*(e-t)+t},randomChoice:function(t){return t[this.randomIntFromInterval(0,t.length-1)]},shadeBlend:function(t,e,n){var i=t<0?t*-1:t,o=Math.round,s=parseInt;if(e.length>7){var r=e.split(","),a=(n?n:t<0?"rgb(0,0,0)":"rgb(255,255,255)").split(","),l=s(r[0].slice(4)),h=s(r[1]),c=s(r[2]);return"rgb("+(o((s(a[0].slice(4))-l)*i)+l)+","+(o((s(a[1])-h)*i)+h)+","+(o((s(a[2])-c)*i)+c)+")"}var r=s(e.slice(1),16),a=s((n?n:t<0?"#000000":"#FFFFFF").slice(1),16),u=r>>16,d=r>>8&255,p=255&r;return"#"+(16777216+65536*(o(((a>>16)-u)*i)+u)+256*(o(((a>>8&255)-d)*i)+d)+(o(((255&a)-p)*i)+p)).toString(16).slice(1)},is_mobile_browser:function(){var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t},is_mobile_or_tablet_browser:function(){var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t},logish:function(t,e,n,i){var o=(t-e)/(n-e);return Math.pow(o,i)*(n-e)+e},event_simulator:{simulate:function(t,e){var n,i=Flynn.Util.event_simulator,o=i.extend(i.defaultOptions,arguments[2]||{}),s=null;for(var r in i.eventMatchers)if(i.eventMatchers[r].test(e)){s=r;break}if(!s)throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported");if(document.createEvent)n=document.createEvent(s),"HTMLEvents"==s?n.initEvent(e,o.bubbles,o.cancelable):n.initMouseEvent(e,o.bubbles,o.cancelable,document.defaultView,o.button,o.pointerX,o.pointerY,o.pointerX,o.pointerY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.button,t),t.dispatchEvent(n);else{o.clientX=o.pointerX,o.clientY=o.pointerY;var a=document.createEventObject();n=i.extend(a,o),t.fireEvent("on"+e,n)}return t},extend:function(t,e){for(var n in e)t[n]=e[n];return t},eventMatchers:{HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|dblclick|mouse(?:down|up|over|move|out))$/},defaultOptions:{pointerX:0,pointerY:0,button:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0}}}}(),function(){"use strict";Flynn.Timer=Class.extend({init:function(t,e,n){this.name=t,this.tickCounter=e,this.callback=n,this.expired=!1}}),Flynn.Timers=Class.extend({init:function(){this.timers={}},add:function(t,e,n){t in this.timers?(this.set(t,e),this.timers[t].callback=n):this.timers[t]=new Flynn.Timer(t,e,n)},set:function(t,e){var n=this.timers[t];n.tickCounter=e,n.expired=!1},get:function(t){return this.timers[t].tickCounter},isRunning:function(t){return this.timers[t].tickCounter>0},hasExpired:function(t){var e=this.timers[t];return!!e.expired&&(e.expired=!1,!0)},remove:function(t){delete this.timers[t]},update:function(t){for(var e in this.timers){var n=this.timers[e];n.tickCounter>0&&(n.tickCounter-=t,n.tickCounter<=0&&(n.tickCounter=0,n.expired=!0,n.callback&&n.callback()))}}})}(),function(){"use strict";Flynn.VectorMode={PLAIN:0,V_THIN:1,V_THICK:2,V_FLICKER:3},"undefined"==typeof Flynn.Config&&(Flynn.Config={}),Flynn.Config.MAX_PACE_RECOVERY_TICKS=5,Flynn.Config.VECTOR_DIM_FACTOR_THICK=.75,Flynn.Config.VECTOR_DIM_FACTOR_THIN=.65,Flynn.Config.VECTOR_OVERDRIVE_FACTOR=.2,Flynn.Canvas=Class.extend({init:function(t,e,n,i){this.showMetrics=!1,"undefined"==typeof n?this.canvas=document.getElementById("gameCanvas"):this.canvas=n,"undefined"==typeof i?this.canvas.style.backgroundColor="#000":this.canvas.style.backgroundColor=i,this.canvas.width=t,this.canvas.height=e,this.previousTimestamp=0,this.DEBUGLOGGED=!1,self=this,this.ctx=function(t){return t.width=t.canvas.width,t.height=t.canvas.height,t.fps=0,t.fpsFrameAverage=10,t.fpsFrameCount=0,t.fpsMsecCount=0,t.vectorVericies=[],t.ticks=0,t.is_world=!1,t.ACODE="A".charCodeAt(0),t.ZEROCODE="0".charCodeAt(0),t.SPACECODE=" ".charCodeAt(0),t.EXCLAMATIONCODE="!".charCodeAt(0),t.ACCENTCODE="`".charCodeAt(0),t.LOWERCASE_A="a".charCodeAt(0),t.LOWERCASE_Z="z".charCodeAt(0),t.UPPER_TO_LOWER=32,t.drawPolygon=function(t,e,n){throw"drawPolygon() is obsolete. Use polygon's .render() method."},t.drawFpsGague=function(e,n,i,o){e+=.5,n+=.5,this.beginPath();var s=60,r=6,a=o*s;this.strokeStyle=Flynn.Colors.GRAY,t.fillStyle="#FFFFFF",t.rect(e,n,s,r),t.fillStyle=i,t.fillRect(e,n,a,r),this.stroke()},t.vectorStart=function(t,e){"undefined"==typeof e?this.is_world=!1:this.is_world=e;var n=Flynn.Util.hexToRgb(t),i=1,o=1;switch(Flynn.mcp.options.vectorMode){case Flynn.VectorMode.PLAIN:i=1,o=1;break;case Flynn.VectorMode.V_THICK:i=Flynn.Config.VECTOR_DIM_FACTOR_THICK,o=3;break;case Flynn.VectorMode.V_THIN:i=Flynn.Config.VECTOR_DIM_FACTOR_THIN,o=1;break;case Flynn.VectorMode.V_FLICKER:var s=Math.floor(this.ticks)%3;0===s?(i=Flynn.Config.VECTOR_DIM_FACTOR_THIN,o=3):1===s?(i=1,o=1):(i=Flynn.Config.VECTOR_DIM_FACTOR_THIN,o=1)}n.r*=i,n.g*=i,n.b*=i;var r=Flynn.Util.rgbToHex(n.r,n.g,n.b),a=Flynn.Util.rgbOverdirve(Flynn.Util.hexToRgb(t),Flynn.Config.VECTOR_OVERDRIVE_FACTOR);this.vectorVertexColor=Flynn.Util.rgbToHex(a.r,a.g,a.b),this.vectorVericies=[],this.beginPath(),this.strokeStyle=r,this.lineJoin="round",this.lineWidth=o},t.vectorLineTo=function(t,e){this.vectorLineToUnconstrained(Math.floor(t),Math.floor(e))},t.vectorMoveTo=function(t,e){this.vectorMoveToUnconstrained(Math.floor(t),Math.floor(e))},t.vectorLineToUnconstrained=function(t,e){this.is_world&&(t-=Math.floor(Flynn.mcp.viewport.x),e-=Math.floor(Flynn.mcp.viewport.y)),this.vectorVericies.push(t,e),Flynn.mcp.options.vectorMode===Flynn.VectorMode.V_THICK?this.lineTo(t,e):this.lineTo(t+.5,e+.5)},t.vectorMoveToUnconstrained=function(t,e){this.is_world&&(t-=Math.floor(Flynn.mcp.viewport.x),e-=Math.floor(Flynn.mcp.viewport.y)),this.vectorVericies.push(t,e),Flynn.mcp.options.vectorMode===Flynn.VectorMode.V_THICK?this.moveTo(t,e):this.moveTo(t+.5,e+.5)},t.vectorEnd=function(){if(this.stroke(),Flynn.mcp.options.vectorMode!=Flynn.VectorMode.PLAIN){var e,n;Flynn.mcp.options.vectorMode===Flynn.VectorMode.V_THICK?(e=1,n=2):(e=0,n=1),this.fillStyle=this.vectorVertexColor;for(var i=0,o=this.vectorVericies.length;i<o;i+=2)t.fillRect(this.vectorVericies[i]-e,this.vectorVericies[i+1]-e,n,n)}},t.vectorRect=function(t,e,n,i,o,s,r){"undefined"!=typeof s&&s&&(this.fillStyle=s,this.fillRect(t,e,n,i)),"undefined"==typeof r&&(r=!1),this.vectorStart(o,r),this.vectorMoveTo(t,e),this.vectorLineTo(t+n-1,e),this.vectorLineTo(t+n-1,e+i-1),this.vectorLineTo(t,e+i-1),this.vectorLineTo(t,e),this.vectorEnd()},t.vectorLine=function(t,e,n,i,o,s){"undefined"==typeof s&&(s=!1),this.vectorStart(o,s),this.vectorMoveTo(t,e),this.vectorLineTo(n,i),this.vectorEnd()},t.charToPolygon=function(t,e){var n;return t>=this.EXCLAMATIONCODE&&t<=this.LOWERCASE_Z?(t>=this.LOWERCASE_A&&(t-=this.UPPER_TO_LOWER),n=e.Points.ASCII[t-this.EXCLAMATIONCODE]):n=e.Points.UNIMPLEMENTED_CHAR,n},t.vectorText=function(t,e,n,i,o,s,r,a){t=String(t),"undefined"==typeof s&&(console.log("ctx.vectorText(): default color deprecated.  Please pass a color.  Text:"+t),s=Flynn.Colors.WHITE),"undefined"==typeof r&&(r=!1),"undefined"==typeof a&&(a=Flynn.Font.Normal);var l=e*a.CharacterSpacing;if("number"==typeof o)throw'5th parameter is now "justify" (was "offset").  Pass "left", "right", or "center".';switch(o){case"right":n-=l*t.length-e*a.CharacterGap;break;case"center":n-=l*t.length/2-e*a.CharacterGap/2;break;case"left":break;default:if("number"==typeof n)throw'5th parameter is now "justify" (was "offset").  Pass "left", "right", or "center".'}"number"!=typeof n&&(n=Math.round((this.width-(t.length*l-a.CharacterGap*e))/2)),"number"!=typeof i&&(i=Math.round((this.height-l)/2));for(var h=0,c=t.length;h<c;h++){var u=t.charCodeAt(h);if(u!==this.SPACECODE){var d=this.charToPolygon(u,a),p=!1;this.vectorStart(s,r);for(var y=0,_=d.length;y<_;y+=2)d[y]==Flynn.PEN_COMMAND?p=!0:0===y||p?(this.vectorMoveTo(d[y]*e+n,d[y+1]*e+i),p=!1):this.vectorLineTo(d[y]*e+n,d[y+1]*e+i);this.vectorEnd(),n+=l}else n+=l}this.DEBUGLOGGED=!0},t.vectorTextArc=function(t,e,n,i,o,s,r,a,l,h,c,u){t=String(t),"undefined"==typeof r&&(r=Flynn.Colors.GREEN),"undefined"==typeof a&&(a=!1),"undefined"==typeof l&&(l=!1),"undefined"==typeof h&&(h=!1),"undefined"==typeof c&&(c=Flynn.Font.Normal),"undefined"==typeof u&&(u=null);var d=o,p=Math.asin(c.CharacterSpacing*e/s);u&&(p*=1.4);var y=0;a&&(y=p*(t.length/2-.5),l&&(y=-y)),d-=y;var _=d+Math.PI/2;l&&(_+=Math.PI,p=-p);for(var g=0,f=t.length;g<f;g++){this.vectorStart(r,h);var v=t.charCodeAt(g);if(v!==this.SPACECODE){var m=this.charToPolygon(v,c),F=!1;this.beginPath();for(var E=0,T=m.length;E<T;E+=2)if(m[E]==Flynn.PEN_COMMAND)F=!0;else{if(u){var C=1;l&&(C=-C);var b=m[E+1];l||(b=c.CharacterHeight-b);var I=Flynn.Util.logish(b,0,c.CharacterHeight,1.2),M=s+(I-c.CharacterHeight/2)*e*u,N=d+C*(m[E]-c.CharacterWidth/2)*c.CharacterSpacing*e/(c.CharacterWidth*s),O=Math.cos(N)*M+n,w=Math.sin(N)*M+i}else var A=m[E]-c.CharacterWidth/2,P=m[E+1]-c.CharacterHeight/2,k=Math.cos(_),R=Math.sin(_),O=(k*A-R*P)*e+Math.cos(d)*s+n,w=(R*A+k*P)*e+Math.sin(d)*s+i;0===E||F?(this.vectorMoveToUnconstrained(O,w),F=!1):this.vectorLineToUnconstrained(O,w)}this.vectorEnd(),d+=p,_+=p}else d+=p,_+=p}},t.clearAll=function(){this.clearRect(0,0,this.width,this.height)},t}(this.canvas.getContext("2d")),this.ctx.strokeStyle=Flynn.Colors.WHITE},animate:function(t){var e=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}(),n=this,i=function(o){var s;s=Flynn.mcp.browserSupportsPerformance?performance.now():o,n.ctx.fpsMsecCount+=s-n.previousTimestamp;var r=60*(s-n.previousTimestamp)/1e3;r>Flynn.Config.MAX_PACE_RECOVERY_TICKS&&(r=1),n.ctx.ticks+=1,++n.ctx.fpsFrameCount,n.ctx.fpsFrameCount>=n.ctx.fpsFrameAverage&&(n.ctx.fpsFrameCount=0,n.ctx.fps=Math.round(1e3/(n.ctx.fpsMsecCount/n.ctx.fpsFrameAverage)),n.ctx.fpsMsecCount=0),n.previousTimestamp=s;var a=0,l=0;Flynn.mcp.browserSupportsPerformance&&(a=performance.now()),t(r),Flynn.mcp.browserSupportsPerformance&&(l=performance.now());var h,c;n.showMetrics&&(Flynn.mcp.browserSupportsPerformance&&(c=(l-a)/(1e3/30),n.ctx.drawFpsGague(n.canvas.width-70,n.canvas.height-21,c<=50?Flynn.Colors.GREEN:Flynn.Colors.RED,c)),c=n.ctx.fps/60,h=n.ctx.fps<59?Flynn.Colors.ORANGE:n.ctx.fps<30?Flynn.Colors.RED:Flynn.Colors.GREEN,n.ctx.drawFpsGague(n.canvas.width-70,n.canvas.height-15,h,c)),Flynn.mcp.halted||e(i,n.canvas)};e(i,this.canvas)}})}(),function(){"use strict";Flynn.BUTTON_CONFIGURABLE=!0,Flynn.BUTTON_NOT_CONFIGURABLE=!1,Flynn.TouchRegion=Class.extend({init:function(t,e,n,i,o,s,r){if("round"!=s&&"rect"!=s)throw"Parameter 'shape' must be 'round' or 'rect'";if(this.name=t,this.left=e,this.top=n,this.right=i,this.bottom=o,this.center_x=(this.right+this.left)/2,this.center_y=(this.top+this.bottom)/2,this.shape=s,this.visible_states=r,"round"==s){if(Math.abs(this.right-this.left-(this.bottom-this.top))>3)throw"Round touch regions must have matching width and height";this.radius=(this.right-this.left)/2}else this.radius=null;this.show=!1,this.touchStartIdentifier=0},updateVisibility:function(t){var e,n;if(!this.visible_states)return void(this.show=!0);for(e=0,n=this.visible_states;e<n;e++)if(t==this.visible_states[e])return void(this.show=!0);this.show=!1}}),Flynn.VirtualButton=Class.extend({init:function(t,e){this.name=t,this.isConfigurable=e,this.isDown=!1,this.pressWasReported=!1,this.boundKeyCode=null}}),Flynn.InputHandler=Class.extend({MOUSE_IDENTIFIER:99999991,DIRECTIONS:["up","down","left","right"],init:function(){this.iCadeModeEnabled=!1,this.virtualButtons={},this.touchRegions={},this.keyCodeToVirtualButtonName={},this.uiButtons={},this.keyCodeToUiButtonName={},this.virtualJoysticks={},this.text_capture_enabled=!1,this.captured_text="",this.keyCodeCaptureArmed=!1,this.capturedKeyCode=null,this.iCade={keyDownCodes:[],keyUpCodes:[],buttonNames:[],buttonCodes:[]},this.addiCadeMapping("icade_up","w","e"),this.addiCadeMapping("icade_down","x","z"),this.addiCadeMapping("icade_left","a","q"),this.addiCadeMapping("icade_right","d","c"),this.addiCadeMapping("icade_t1","y","t"),this.addiCadeMapping("icade_t2","u","f"),this.addiCadeMapping("icade_t3","i","m"),this.addiCadeMapping("icade_t4","o","g"),this.addiCadeMapping("icade_b1","h","r"),this.addiCadeMapping("icade_b2","j","n"),this.addiCadeMapping("icade_b3","k","p"),this.addiCadeMapping("icade_b4","l","v"),this.touchable_elements=[];var t=this;if(this.keyDownHandler=function(e){if(e.keyCode!=Flynn.KeyboardMap.escape&&e.keyCode!=Flynn.KeyboardMap.tab||e.preventDefault(),t.iCadeModeEnabled){var n,i=t.iCade.keyDownCodes.indexOf(e.keyCode);if(i>-1)return n={keyCode:t.iCade.buttonCodes[i]},void t.keyDownHandler(n);if(i=t.iCade.keyUpCodes.indexOf(e.keyCode),i>-1)return n={keyCode:t.iCade.buttonCodes[i]},void t.keyUpHandler(n)}if(t.keyCodeCaptureArmed&&e.keyCode!=Flynn.KeyboardMap.escape)return t.capturedKeyCode=e.keyCode,void(t.keyCodeCaptureArmed=!1);if(!t.text_capture_enabled){var o;t.keyCodeToVirtualButtonName[e.keyCode]&&(o=t.keyCodeToVirtualButtonName[e.keyCode],t.virtualButtons[o].isDown=!0),t.keyCodeToUiButtonName[e.keyCode]&&(o=t.keyCodeToUiButtonName[e.keyCode],t.uiButtons[o].isDown=!0)}},document.addEventListener("keydown",this.keyDownHandler),this.keyUpHandler=function(e){var n;t.keyCodeToVirtualButtonName[e.keyCode]&&(n=t.keyCodeToVirtualButtonName[e.keyCode],t.virtualButtons[n].isDown=!1,t.virtualButtons[n].pressWasReported=!1),t.keyCodeToUiButtonName[e.keyCode]&&(n=t.keyCodeToUiButtonName[e.keyCode],t.uiButtons[n].isDown=!1,t.uiButtons[n].pressWasReported=!1)},document.addEventListener("keyup",this.keyUpHandler),this.keyPressHandler=function(e){t.text_capture_enabled&&t.processTextCapture(e.keyCode)},document.addEventListener("keypress",this.keyPressHandler),Flynn.mcp.mousetouchEnabled||Flynn.mcp.developerModeEnabled)try{document.addEventListener("mousedown",function(e){if(Flynn.mcp.halted&&Flynn.mcp.devResume(),Flynn.mcp.mousetouchEnabled){var n=Flynn.mcp.touch_control_canvas.canvas,i=n.getBoundingClientRect(),o=(e.clientX-i.left)*n.width/n.clientWidth,s=(e.clientY-i.top)*n.height/n.clientHeight,r=t.handleTouchStart(o,s,t.MOUSE_IDENTIFIER);r?e.preventDefault():console.log("mousedown not caught")}},!1)}catch(t){console.log('Warning: Could not register "mousedown" event.')}if(Flynn.mcp.mousetouchEnabled){try{document.addEventListener("mouseup",function(e){var n=Flynn.mcp.touch_control_canvas.canvas,i=n.getBoundingClientRect(),o=(e.clientX-i.left)*n.width/n.clientWidth,s=(e.clientY-i.top)*n.height/n.clientHeight,r=t.handleTouchEnd(o,s,t.MOUSE_IDENTIFIER);r?e.preventDefault():console.log("mouseup not caught")},!1)}catch(t){console.log('Warning: Could not register "mouseup" event.')}try{document.addEventListener("mousemove",function(e){if(e.preventDefault(),e.which){var n=Flynn.mcp.touch_control_canvas.canvas,i=n.getBoundingClientRect(),o=(e.clientX-i.left)*n.width/n.clientWidth,s=(e.clientY-i.top)*n.height/n.clientHeight;t.handleTouchMove(o,s,t.MOUSE_IDENTIFIER)}},!1)}catch(t){console.log('Warning: Could not register "mousemove" event.')}}try{document.addEventListener("touchstart",function(e){var n,i=!1;for(n=0;n<e.changedTouches.length;n++){var o=e.changedTouches[n],s=Flynn.mcp.touch_control_canvas.canvas,r=s.getBoundingClientRect(),a=(o.pageX-r.left)*s.width/s.clientWidth,l=(o.pageY-r.top)*s.height/s.clientHeight;i|=t.handleTouchStart(a,l,o.identifier)}i&&e.preventDefault()},!1)}catch(t){console.log('Warning: Could not register "touchstart" event.')}try{document.addEventListener("touchend",function(e){var n,i=!1;for(n=0;n<e.changedTouches.length;n++){var o=e.changedTouches[n],s=Flynn.mcp.touch_control_canvas.canvas,r=s.getBoundingClientRect(),a=(o.pageX-r.left)*s.width/s.clientWidth,l=(o.pageY-r.top)*s.height/s.clientHeight;i|=t.handleTouchEnd(a,l,o.identifier)}i&&e.preventDefault()},!1)}catch(t){console.log('Warning: Could not register "touchend" event.')}try{document.addEventListener("touchmove",function(e){e.preventDefault();var n=e.changedTouches[0],i=Flynn.mcp.touch_control_canvas.canvas,o=i.getBoundingClientRect(),s=(n.pageX-o.left)*i.width/i.clientWidth,r=(n.pageY-o.top)*i.height/i.clientHeight;console.log("DEV: touchmove ",s,r),t.handleTouchMove(s,r,n.identifier)},!1)}catch(t){console.log('Warning: Could not register "touchend" event.')}},startTextCapture:function(){this.text_capture_enabled=!0,this.captured_text=""},getTextCapture:function(){return this.captured_text},setTextCapture:function(t){this.captured_text=t},isTextCaptureDone:function(){return!this.text_capture_enabled},processTextCapture:function(t){13==t?this.text_capture_enabled=!1:t==Flynn.KeyboardMap.delete&&this.captured_text.length>0?this.captured_text=this.captured_text.substring(0,this.captured_text.length-1):(32==t||t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122)&&(this.captured_text+=String.fromCharCode(t)),console.log("processTextCapture():Key Code:"+t+" String:"+this.captured_text)},addTouchableElement:function(t){this.touchable_elements.push(t)},handleTouchStart:function(t,e,n){var i,o,s,r,a;a=!1;for(i in this.touchRegions)o=this.touchRegions[i],r="round"==o.shape?Math.pow(t-o.center_x,2)+Math.pow(e-o.center_y,2)<Math.pow(o.radius,2):t>o.left&&t<o.right&&e>o.top&&e<o.bottom,r&&(this.virtualButtons[i]?this.virtualButtons[i].isDown=!0:this.uiButtons[i]?this.uiButtons[i].isDown=!0:console.log('Flynn: Warning: touch detected in touch region "'+i+'" but no virtual button exists with that name.  The touch will go unreported.'),o.touchStartIdentifier=n,a=!0);for(i in this.virtualJoysticks)s=this.virtualJoysticks[i],a|=s.handleTouchStart(t,e,n),this.setButtonsFromJoystick(s);
return a},handleTouchEnd:function(t,e,n){var i,o,s,r,a,l;l=!1;for(i in this.touchRegions)o=this.touchRegions[i],o.touchStartIdentifier==n&&(this.virtualButtons[i]?(this.virtualButtons[i].isDown=!1,this.virtualButtons[i].pressWasReported=!1):this.uiButtons[i]&&(this.uiButtons[i].isDown=!1,this.uiButtons[i].pressWasReported=!1),o.touchStartIdentifier=0,l=!0);for(i in this.virtualJoysticks)if(s=this.virtualJoysticks[i],s.handleTouchEnd(t,e,n)){for(a=0;a<this.DIRECTIONS.length;a++)r=this.DIRECTIONS[a],i=s.buttons[r].name,i&&(this.virtualButtons[i]?this.virtualButtons[i].isDown=!1:this.uiButtons[i]&&(this.uiButtons[i].isDown=!1));l=!0}return l},handleTouchMove:function(t,e,n){var i,o;for(i in this.virtualJoysticks)o=this.virtualJoysticks[i],o.handleTouchMove(t,e,n),this.setButtonsFromJoystick(o)},setButtonsFromJoystick:function(t){var e,n,i;if(t.in_use)for(i=0;i<this.DIRECTIONS.length;i++)e=this.DIRECTIONS[i],n=t.buttons[e].name,n&&(this.virtualButtons[n]?this.virtualButtons[n].isDown=t.buttons[e].pressed:this.uiButtons[n]&&(this.uiButtons[n].isDown=t.buttons[e].pressed))},setupUIButtons:function(){this.iCadeModeEnabled?(this.addUiButton("UI_enter",Flynn.KeyboardMap.icade_t1),this.addUiButton("UI_escape",Flynn.KeyboardMap.icade_b1),this.addUiButton("UI_exit",Flynn.KeyboardMap.icade_b2),this.addUiButton("UI_quarter",Flynn.KeyboardMap.icade_t3),this.addUiButton("UI_start1",Flynn.KeyboardMap.icade_t4),this.addUiButton("UI_start2",Flynn.KeyboardMap.icade_b4),this.addUiButton("UI_up",Flynn.KeyboardMap.icade_up),this.addUiButton("UI_down",Flynn.KeyboardMap.icade_down),this.addUiButton("UI_right",Flynn.KeyboardMap.icade_right),this.addUiButton("UI_left",Flynn.KeyboardMap.icade_left)):(this.addUiButton("UI_enter",Flynn.KeyboardMap.enter),this.addUiButton("UI_escape",Flynn.KeyboardMap.escape),this.addUiButton("UI_exit",Flynn.KeyboardMap.tab),this.addUiButton("UI_quarter",Flynn.KeyboardMap.num_5),this.addUiButton("UI_start1",Flynn.KeyboardMap.num_1),this.addUiButton("UI_start2",Flynn.KeyboardMap.num_2),this.addUiButton("UI_up",Flynn.KeyboardMap.up),this.addUiButton("UI_down",Flynn.KeyboardMap.down),this.addUiButton("UI_right",Flynn.KeyboardMap.right),this.addUiButton("UI_left",Flynn.KeyboardMap.left),Flynn.mcp.developerModeEnabled&&this.addUiButton("UI_halt",Flynn.KeyboardMap.grave_accent))},enableICade:function(){this.iCadeModeEnabled=!0},addiCadeMapping:function(t,e,n){this.iCade.buttonNames.push(t),this.iCade.buttonCodes.push(Flynn.KeyboardMap[t]),this.iCade.keyDownCodes.push(Flynn.KeyboardMap[e]),this.iCade.keyUpCodes.push(Flynn.KeyboardMap[n])},addUiButton:function(t,e){this.uiButtons[t]&&(console.log('Flynn: Warning: addUiButton() was called for UI button  "'+t+'" but that UI button already exists. The old UI button will be removed first.'),delete this.uiButtons[t]),this.uiButtons[t]=new Flynn.VirtualButton(t,Flynn.BUTTON_NOT_CONFIGURABLE),this.uiButtons[t].boundKeyCode=e,this.keyCodeToUiButtonName[e]=t},addVirtualButton:function(t,e,n){this.virtualButtons[t]&&(console.log('Flynn: Warning: addVirtualButton() was called for virtual button  "'+t+'" but that virtual button already exists. The old virtual button will be removed first.'),delete this.virtualButtons[t]),this.virtualButtons[t]=new Flynn.VirtualButton(t,n),this.bindVirtualButtonToKey(t,e)},bindVirtualButtonToKey:function(t,e){void 0===e&&(console.log('Flynn: Warning: bindVirtualButtonToKey() was called for virtual button  "'+t+'" with keyCode "undefined". Assuming "null" instead, but this may indicate a mistake.'),e=null),this.virtualButtons[t]?(this.unbindVirtualButtonFromKey(t),this.virtualButtons[t].boundKeyCode=e,e&&(this.keyCodeToVirtualButtonName[e]=t)):console.log('Flynn: Warning: bindVirtualButtonToKey() was called for virtual button  "'+t+'", but that virtual button does not exist. Doing nothing.')},getConfigurableVirtualButtonNames:function(){var t=[];for(var e in this.virtualButtons)this.virtualButtons[e].isConfigurable&&t.push(e);return t},getVirtualButtonBoundKeyName:function(t){var e,n;return this.virtualButtons[t]?(e=this.virtualButtons[t].boundKeyCode,n=this.keyCodeToKeyName(e)):this.uiButtons[t]?(e=this.uiButtons[t].boundKeyCode,n=this.keyCodeToKeyName(e)):(console.log('Flynn: Warning: getVirtualButtonBoundKeyName() was called for virtual button  "'+t+'", but that virtual button does not exist.'),"ERROR")},getVirtualButtonBoundKeyCode:function(t){return this.virtualButtons[t]?this.virtualButtons[t].boundKeyCode:(console.log('Flynn: Warning: getVirtualButtonBoundKeyCode() was called for virtual button  "'+t+'", but that virtual button does not exist. Returning null.'),null)},keyCodeToKeyName:function(t){for(var e in Flynn.KeyboardMap)if(Flynn.KeyboardMap[e]===t)return e;return"(Unknown)"},unbindVirtualButtonFromKey:function(t){if(this.virtualButtons[t]){for(var e in this.keyCodeToVirtualButtonName)this.keyCodeToVirtualButtonName[e]===t&&delete this.keyCodeToVirtualButtonName[e];this.virtualButtons[t].boundKeyCode=null}else console.log('Flynn: Warning: unbindVirtualButtonFromKey() was called for virtual button  "'+t+'", but that virtual button does not exist. Doing nothing.')},addTouchRegion:function(t,e,n,i,o,s,r){"undefined"==typeof s&&(s="rect"),t in this.touchRegions&&(console.log('Flynn: Info: addTouchRegion() was called for region  "'+t+'" and that touch region already exists. The old touch region will be removed first.'),delete this.touchRegions[t]);var a=new Flynn.TouchRegion(t,e,n,i,o,s,r);this.touchRegions[t]=a,t in this.virtualButtons||t in this.uiButtons||console.log('Flynn: Warning: touch region name "'+t+'" does not match an existing virtual button name.  Touches to this region will be unreported unless (until) a virtual button with the same name is created.')},renderTouchRegions:function(t){var e,n;for(e in this.touchRegions)n=this.touchRegions[e],n.show&&("round"==n.shape?(t.beginPath(),t.arc((n.left+n.right)/2,(n.top+n.bottom)/2,(n.right-n.left)/2,0,2*Math.PI,!1),this.virtualButtonIsDown(e)?t.fillStyle="rgba(255, 255, 255, 0.3)":t.fillStyle="rgba(255, 255, 255, 0.1)",t.fill(),t.lineWidth=2,t.strokeStyle="rgba(255, 255, 255, 0.2)",t.stroke()):(t.beginPath(),t.rect(n.left,n.top,n.right-n.left,n.bottom-n.top),this.virtualButtonIsDown(e)?t.fillStyle="rgba(255, 255, 255, 0.3)":t.fillStyle="rgba(255, 255, 255, 0.1)",t.fill(),t.lineWidth=2,t.strokeStyle="rgba(255, 255, 255, 0.2)",t.stroke()))},virtualButtonIsDown:function(t){return this.virtualButtons[t]?this.virtualButtons[t].isDown:this.uiButtons[t]?this.uiButtons[t].isDown:void console.log('Flynn: Warning: isDown() was called for virtual button  "'+t+'" but no virtual button with that name exists.')},virtualButtonWasPressed:function(t){return this.virtualButtons[t]?!this.virtualButtons[t].pressWasReported&&(!!this.virtualButtons[t].isDown&&(this.virtualButtons[t].pressWasReported=!0,!0)):this.uiButtons[t]?!this.uiButtons[t].pressWasReported&&(!!this.uiButtons[t].isDown&&(this.uiButtons[t].pressWasReported=!0,!0)):void console.log('Flynn: Warning: isDown() was called for virtual button  "'+t+'" but no virtual button with that name exists.')},armKeyCodeCapture:function(){this.keyCodeCaptureArmed=!0,this.capturedKeyCode=null},getCapturedKeyCode:function(){return this.capturedKeyCode},isKeyCodeAssigned:function(t){for(var e in this.virtualButtons)if(this.virtualButtons[e].boundKeyCode==t)return!0;return!1},addVirtualJoystick:function(t){t=t||{};var e=new Flynn.VirtualJoystick(t);this.virtualJoysticks[e.name]&&(console.log('Flynn: Info: addVirtualJoystick() was called for virtual joystick  "'+e.name+'" and that virtual joystick already exists. The old virtual joystick will be removed first.'),delete this.virtualJoysticks[e.name]),this.virtualJoysticks[e.name]=e},getAnalogJoystickPosition:function(t){return this.virtualJoysticks[t]?this.virtualJoysticks[t].analog_pos:null},updateVisibilityAllControls:function(){var t;for(t in this.virtualJoysticks)this.virtualJoysticks[t].updateVisibility(Flynn.mcp.current_state_id);for(t in this.touchRegions)this.touchRegions[t].updateVisibility(Flynn.mcp.current_state_id)},renderVirtualJoysticks:function(t){var e;for(e in this.virtualJoysticks)this.virtualJoysticks[e].render(t)}})}(),function(){"use strict";Flynn.Polygon=Class.extend({init:function(t,e,n,i){"undefined"==typeof i&&(i={x:100,y:100,is_world:!1}),"undefined"==typeof n&&(n=3),this.color=e||Flynn.Colors.WHITE,this.position=i,this.points=t.slice(0),this.pointsMaster=t.slice(0),this.bounding_enabled=!1,this.bounding_visible=!1,this.points_bounding=null,this.points_bounding_master=null,this.points_bounding_dirty=!0,this.angle=0,this.scale=n,this.visible=!0,this.setAngle(this.angle)},setBoundingPoly:function(t){this.points_bounding_master=t.slice(0),this.points_bounding=t.slice(0),this.bounding_enabled=!0;for(var e=0,n=this.points_bounding_master.length;e<n;e+=2){var i=this.points_bounding_master[e];if(i==Flynn.PEN_COMMAND)throw"Bounding poly cannot contain PEN_COMMAND."}},setAngle:function(t){this.angle=t;for(var e=Math.cos(t),n=Math.sin(t),i=0,o=this.pointsMaster.length;i<o;i+=2){var s=this.pointsMaster[i],r=this.pointsMaster[i+1];s==Flynn.PEN_COMMAND?(this.points[i]=s,this.points[i+1]=r):(this.points[i]=(e*s-n*r)*this.scale,this.points[i+1]=(n*s+e*r)*this.scale)}this.points_bounding_dirty=!0},setScale:function(t){this.scale=t,this.setAngle(this.angle),this.points_bounding_dirty=!0},updateBoundingPoly:function(){if(this.points_bounding_dirty){this.points_bounding_dirty=!1;for(var t=Math.cos(this.angle),e=Math.sin(this.angle),n=0,i=this.points_bounding_master.length;n<i;n+=2){var o=this.points_bounding_master[n],s=this.points_bounding_master[n+1];this.points_bounding[n]=(t*o-e*s)*this.scale,this.points_bounding[n+1]=(e*o+t*s)*this.scale}}},hasPoint:function(t,e){var n,i,o,s=!1;this.bounding_enabled?(this.updateBoundingPoly(),n=this.points_bounding):n=this.points,i=this.position.x,o=this.position.y;var r,a,l,h,c,u,d=n.length;for(r=0,a=d-2;r<d;r+=2)l=n[r]+i,h=n[a]+i,c=n[r+1]+o,u=n[a+1]+o,c>e!=u>e&&t<(h-l)*(e-c)/(u-c)+l&&(s=!s),a=r;return s},is_colliding:function(t){var e,n,i,o;if(!this.visible)return!1;for(i=this.position.x,o=this.position.y,e=0,n=this.points.length-2;e<n;e+=2)if(t.hasPoint(this.points[e]+i,this.points[e+1]+o))return!0;return!1},render:function(t){if(this.visible){var e,n,i,o,s=this.color;this.position.is_world?(i=this.position.x-Flynn.mcp.viewport.x,o=this.position.y-Flynn.mcp.viewport.y):(i=this.position.x,o=this.position.y),t.vectorStart(s);for(var r=!1,a=0,l=this.points.length;a<l;a+=2)this.points[a]==Flynn.PEN_COMMAND?this.points[a+1]==Flynn.PEN_UP?r=!0:(s=Flynn.ColorsOrdered[this.points[a+1]-Flynn.PEN_COLOR0],t.vectorEnd(),t.vectorStart(s),a>0&&t.vectorMoveTo(e+i,n+o)):(e=this.points[a],n=this.points[a+1],0===a||r?(t.vectorMoveTo(e+i,n+o),r=!1):t.vectorLineTo(e+i,n+o));if(t.vectorEnd(),this.bounding_visible){for(this.updateBoundingPoly(),s=Flynn.Colors.GRAY,r=!0,t.vectorStart(s),a=0,l=this.points_bounding.length;a<l;a+=2)e=this.points_bounding[a],n=this.points_bounding[a+1],0===a||r?(t.vectorMoveTo(e+i,n+o),r=!1):t.vectorLineTo(e+i,n+o);t.vectorEnd()}}}})}(),function(){"use strict";Flynn.State=Class.extend({init:function(){},handleInputs:function(){},update:function(){},render:function(t){}})}(),function(){"use strict";Flynn.StateEnd=Flynn.State.extend({CURSOR_BLINK_RATE:2,MAX_NICKNAME_LENGTH:12,init:function(t,e,n,i,o,s){if(this._super(),this.score=t,this.leaderboard=e,this.color=n,this.title=i,this.prompt=o,"undefined"==typeof s)throw"API has changed. parentState is now a required parameter.";this.parentState=s,this.nickname="";var r=this.leaderboard.getWorstEntry();!this.leaderboard.sortDescending&&this.score<r.score||this.leaderboard.sortDescending&&this.score>r.score?(this.hasEnteredName=!1,Flynn.mcp.input.startTextCapture()):this.hasEnteredName=!0,this.cursorBlinkTimer=0},scoreToString:function(t){return t.toString()},getAndCleanNickname:function(){var t=Flynn.mcp.input.getTextCapture();t!=this.nickname&&(this.nickname=Flynn.mcp.input.getTextCapture(),this.nickname=this.nickname.substring(0,this.MAX_NICKNAME_LENGTH+1),Flynn.mcp.input.setTextCapture(this.nickname))},handleInputs:function(t,e){this.hasEnteredName?t.virtualButtonWasPressed("UI_enter")&&(Flynn.mcp.changeState(this.parentState),Flynn.sounds.ui_move.play()):t.isTextCaptureDone()&&(this.hasEnteredName=!0,this.getAndCleanNickname(),this.leaderboard.add({name:this.nickname,score:this.score}),Flynn.sounds.ui_success.play())},update:function(t){this.cursorBlinkTimer+=2*this.CURSOR_BLINK_RATE/60*t,this.hasEnteredName||this.getAndCleanNickname()},render:function(t){if(t.clearAll(),this.hasEnteredName){t.vectorText(this.title,4,null,130,null,this.color);for(var e=0,n=this.leaderboard.leaderList.length;e<n;e++){var i=this.leaderboard.leaderList[e];t.vectorText(i.name,2,360,200+25*e,"left",this.color),t.vectorText(this.scoreToString(i.score),2,660,200+25*e,"right",this.color)}t.vectorText("PRESS <ENTER> TO CONTINUE",2,null,450,null,this.color)}else t.vectorText(this.prompt,4,null,100,null,this.color),t.vectorText("TYPE YOUR NAME AND PRESS ENTER",2,null,180,null,this.color),this.cursorBlinkTimer%2>1?t.vectorText(" "+this.nickname+"_",3,null,220,null,this.color):t.vectorText(this.nickname,3,null,220,null,this.color),t.vectorText(this.scoreToString(this.score),3,null,300,null,this.color)}})}(),function(){"use strict";Flynn.StateConfig=Flynn.State.extend({init:function(t,e,n,i,o,s,r){if(this._super(),Flynn.sounds.ui_select.play(),this.OPTION_SELECTION_MARGIN=5,this.OPTION_SELECTION_MARGININ_SET=2,this.OPTION_TEXT_SCALE=2,this.OPTION_CENTER_GAP_WIDTH=2*Flynn.Font.Normal.CharacterWidth*this.OPTION_TEXT_SCALE,this.OPTION_KEY_PROMPT="PRESS NEW KEY",this.OPTION_INPUT_KEY_VALUE_WIDTH=this.OPTION_TEXT_SCALE*Flynn.Font.Normal.CharacterSpacing*this.OPTION_KEY_PROMPT.length+1+2*this.OPTION_SELECTION_MARGIN,"undefined"==typeof o||"undefined"==typeof s||"undefined"==typeof r)throw"API has changed. parentState, abortState & abortEnable are required parameters.";if(this.parentState=o,this.abortState=s,this.mainTextColor=t,this.menuTextColor=e,this.selectionBoxColor=n,this.menuPromptColor=i,Flynn.mcp.optionManager.removeOption("exitToMenu"),Flynn.mcp.optionManager.removeOption("exitGame"),r){var a=this;Flynn.mcp.optionManager.addOption("exitToMenu",Flynn.OptionType.COMMAND,!0,!0,"EXIT TO MENU",null,function(){Flynn.mcp.changeState(a.abortState)})}else Flynn.mcp.backEnabled&&Flynn.mcp.optionManager.addOption("exitGame",Flynn.OptionType.COMMAND,!0,!0,"EXIT GAME",null,function(){window.history.back()});this.configurableVirtualButtonNames=Flynn.mcp.input.getConfigurableVirtualButtonNames(),this.keyAssignmentInProgress=!1,this.optionKeyNames=Flynn.mcp.optionManager.getOptionKeyNames(),this.numOptions=this.optionKeyNames.length,this.selectedLineIndex=0},handleInputs:function(t,e){var n,i,o=this.optionKeyNames[this.selectedLineIndex];if(this.keyAssignmentInProgress){var s=t.getCapturedKeyCode();return s&&(t.isKeyCodeAssigned(s)?(i=Flynn.mcp.optionManager.getOption(o),i===s?(this.keyAssignmentInProgress=!1,Flynn.sounds.ui_cancel.play()):(t.armKeyCodeCapture(),console.log("that key is in use"),Flynn.sounds.ui_error.play())):(Flynn.mcp.optionManager.setOption(o,s),this.keyAssignmentInProgress=!1,Flynn.sounds.ui_success.play())),void(t.virtualButtonWasPressed("UI_escape")&&(this.keyAssignmentInProgress=!1,Flynn.sounds.ui_cancel.play()))}var r=Flynn.mcp.optionManager.optionDescriptors[this.optionKeyNames[this.selectedLineIndex]];if(Flynn.mcp.arcadeModeEnabled&&t.virtualButtonWasPressed("quarter")&&(Flynn.mcp.credits+=1,this.insert_coin_sound.play()),t.virtualButtonWasPressed("UI_escape")&&(Flynn.mcp.changeState(this.parentState),Flynn.sounds.ui_cancel.play()),t.virtualButtonWasPressed("UI_down")&&(++this.selectedLineIndex,this.selectedLineIndex>=this.numOptions&&(this.selectedLineIndex=0),Flynn.sounds.ui_move.play()),t.virtualButtonWasPressed("UI_up")&&(--this.selectedLineIndex,this.selectedLineIndex<0&&(this.selectedLineIndex=this.numOptions-1),Flynn.sounds.ui_move.play()),t.virtualButtonWasPressed("UI_enter")){switch(r.type){case Flynn.OptionType.BOOLEAN:Flynn.mcp.optionManager.setOption(r.keyName,!r.currentValue),n=r.commandHandler,null!==n&&n();break;case Flynn.OptionType.INPUT_KEY:t.armKeyCodeCapture(),this.keyAssignmentInProgress=!0;break;case Flynn.OptionType.COMMAND:n=r.commandHandler,null!==n&&n()}Flynn.sounds.ui_select.play()}var a=0;if(t.virtualButtonWasPressed("UI_left")&&(a=-1),t.virtualButtonWasPressed("UI_right")&&(a=1),0!==a&&r.type===Flynn.OptionType.MULTI){var l=r.currentPromptValueIndex(),h=r.promptValues.length;l+=a,l<0?l=h-1:l>h-1&&(l=0),Flynn.mcp.optionManager.setOption(r.keyName,r.promptValues[l][1]),Flynn.sounds.ui_select.play()}},update:function(t){},render:function(t){t.clearAll(),t.vectorText("CONFIGURATION OPTIONS",4,null,100,null,this.mainTextColor);var e=15,n=160;t.vectorText("PRESS <UP>/<DOWN> TO SELECT A CONTROL",1.5,null,n,null,this.mainTextColor),n+=e,t.vectorText("PRESS <ENTER> TO EDIT THE SELECTED CONTROL",1.5,null,n,null,this.mainTextColor),n+=e,t.vectorText("PRESS <ESCAPE> TO EXIT/CANCEL",1.5,null,n,null,this.mainTextColor);for(var i,o=250,s=Flynn.mcp.canvasWidth/2,r=30,a={x:0,y:0,width:0,height:0},l=null,h=0,c=this.optionKeyNames.length;h<c;h++){var u=this.optionKeyNames[h],d=Flynn.mcp.optionManager.optionDescriptors[u];switch(d.type){case Flynn.OptionType.COMMAND:t.vectorText(d.promptText,2,null,o+r*h,null,this.menuTextColor),i=(d.promptText.length*Flynn.Font.Normal.CharacterSpacing-Flynn.Font.Normal.CharacterGap)*this.OPTION_TEXT_SCALE,a={x:Flynn.mcp.canvasWidth/2-i/2-this.OPTION_SELECTION_MARGIN,y:o+r*h-this.OPTION_SELECTION_MARGIN,width:i+2*this.OPTION_SELECTION_MARGIN,height:Flynn.Font.Normal.CharacterHeight*this.OPTION_TEXT_SCALE+2*this.OPTION_SELECTION_MARGIN};break;default:t.vectorText(d.promptText+":",2,s-this.OPTION_CENTER_GAP_WIDTH/2,o+r*h,"right",this.menuTextColor)}var p="",y=this.menuTextColor;switch(d.type){case Flynn.OptionType.BOOLEAN:p=d.currentValue===!0?"ON":"OFF",i=(3*Flynn.Font.Normal.CharacterSpacing-Flynn.Font.Normal.CharacterGap)*this.OPTION_TEXT_SCALE,a={x:s+this.OPTION_CENTER_GAP_WIDTH/2-this.OPTION_SELECTION_MARGIN,y:o+r*h-this.OPTION_SELECTION_MARGIN,width:i+2*this.OPTION_SELECTION_MARGIN,height:Flynn.Font.Normal.CharacterHeight*this.OPTION_TEXT_SCALE+2*this.OPTION_SELECTION_MARGIN};break;case Flynn.OptionType.MULTI:var _,g;for(_=0,g=d.promptValues.length;_<g;_++)p+=d.promptValues[_][0]+"  ";var f=0,v=d.currentPromptValueIndex();for(_=0,g=d.promptValues.length;_<g;_++)_<v&&(f+=d.promptValues[_][0].length+2);i=(d.promptValues[v][0].length*Flynn.Font.Normal.CharacterSpacing-Flynn.Font.Normal.CharacterGap)*this.OPTION_TEXT_SCALE,a={x:s+this.OPTION_CENTER_GAP_WIDTH/2-this.OPTION_SELECTION_MARGIN+f*Flynn.Font.Normal.CharacterSpacing*this.OPTION_TEXT_SCALE,y:o+r*h-this.OPTION_SELECTION_MARGIN,width:i+2*this.OPTION_SELECTION_MARGIN,height:Flynn.Font.Normal.CharacterHeight*this.OPTION_TEXT_SCALE+2*this.OPTION_SELECTION_MARGIN},t.vectorRect(a.x+this.OPTION_SELECTION_MARGININ_SET,a.y+this.OPTION_SELECTION_MARGININ_SET,a.width-2*this.OPTION_SELECTION_MARGININ_SET,a.height-2*this.OPTION_SELECTION_MARGININ_SET,y);break;case Flynn.OptionType.INPUT_KEY:var m=d.currentValue;this.keyAssignmentInProgress&&h===this.selectedLineIndex?(p="PRESS NEW KEY",y=this.menuPromptColor):p=Flynn.mcp.input.keyCodeToKeyName(m),a={x:s+this.OPTION_CENTER_GAP_WIDTH/2-this.OPTION_SELECTION_MARGIN,y:o+r*h-this.OPTION_SELECTION_MARGIN,width:this.OPTION_INPUT_KEY_VALUE_WIDTH,height:Flynn.Font.Normal.CharacterHeight*this.OPTION_TEXT_SCALE+2*this.OPTION_SELECTION_MARGIN}}t.vectorText(p,2,s+this.OPTION_CENTER_GAP_WIDTH/2,o+r*h,"left",y),h===this.selectedLineIndex&&(l=a)}null!==l&&t.vectorRect(l.x,l.y,l.width,l.height,this.selectionBoxColor)}})}(),function(){"use strict";Flynn.Projectile=Class.extend({init:function(t,e,n,i,o,s){this.position={x:t.x,y:t.y},this.velocity={x:e.x,y:e.y},this.lifetime=n,this.size=i,this.color=o,this.projectiles=s},kill:function(){this.lifetime=0},update:function(t){var e=!0;return this.lifetime-=t,this.lifetime<=0?e=!1:(this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t),(this.position.x<this.projectiles.bounds_rect.left||this.position.y<this.projectiles.bounds_rect.top||this.position.x>this.projectiles.bounds_rect.right||this.position.y>this.projectiles.bounds_rect.bottom)&&(e=!1),e},render:function(t){t.fillStyle=this.color,this.projectiles.is_world?t.fillRect(this.position.x-Flynn.mcp.viewport.x,this.position.y-Flynn.mcp.viewport.y,this.size,this.size):t.fillRect(this.position.x,this.position.y,this.size,this.size)}}),Flynn.Projectiles=Class.extend({init:function(t,e){if("Flynn.Rect"!=t.object_id)throw"API has changed. Expected bounds_rect type of Flynn.Rect";"undefined"==typeof e&&(e=!1),this.bounds_rect=t.clone(),this.is_world=e,this.projectiles=[]},reset:function(){this.projectiles=[]},add:function(t,e,n,i,o){this.projectiles.push(new Flynn.Projectile(t,e,n,i,o,this))},advanceFrame:function(){this.projectiles[this.projectiles.length-1].update(1)},update:function(t){for(var e=0,n=this.projectiles.length;e<n;e+=1)this.projectiles[e].update(t)||(this.projectiles.splice(e,1),n--,e--)},render:function(t){for(var e=0,n=this.projectiles.length;e<n;e+=1)this.projectiles[e].render(t)}})}(),function(){"use strict";Flynn.OptionType={BOOLEAN:0,MULTI:1,COMMAND:2,INPUT_KEY:3},Flynn.OptionDescriptor=Class.extend({init:function(t,e,n,i,o,s,r){this.keyName=t,this.type=e,this.defaultValue=n,this.currentValue=i,this.promptText=o,this.promptValues=s,this.commandHandler=r},currentPromptValueIndex:function(){for(var t=0,e=this.promptValues.length;t<e;t++)if(this.currentValue===this.promptValues[t][1])return t;return null}}),Flynn.OptionManager=Class.extend({SHADOWED_OPTION_TYPES:[Flynn.OptionType.MULTI,Flynn.OptionType.BOOLEAN],init:function(){this.optionDescriptors={},this.cookiesFetched=!1;var t=this;this.addOption("revertDefaults",Flynn.OptionType.COMMAND,!0,!0,"REVERT TO DEFAULTS",null,function(){t.revertToDefaults(),t.saveAllToCookies()})},addOption:function(t,e,n,i,o,s,r){var a=new Flynn.OptionDescriptor(t,e,n,i,o,s,r);e in this.SHADOWED_OPTION_TYPES&&(Flynn.mcp.options[t]=i),this.optionDescriptors[t]=a},removeOption:function(t){delete Flynn.mcp.options[t],delete this.optionDescriptors[t]},addOptionFromVirtualButton:function(t){var e=Flynn.mcp.input.getVirtualButtonBoundKeyCode(t),n=t,i=new Flynn.OptionDescriptor(n,Flynn.OptionType.INPUT_KEY,e,e,n,null,null);this.optionDescriptors[n]=i},setOption:function(t,e){if(t in this.optionDescriptors){var n=this.optionDescriptors[t];n.currentValue=e,n.type in this.SHADOWED_OPTION_TYPES&&(Flynn.mcp.options[t]=e),n.type===Flynn.OptionType.INPUT_KEY&&Flynn.mcp.input.bindVirtualButtonToKey(t,e)}else console.print('DEV: Warning: FlynnOptionManager.setOption() called for key "'+t+'", which does not match an existing option.  Doing nothing.');this.cookiesFetched&&this.saveOptionToCookies(t)},getOption:function(t){return t in this.optionDescriptors?this.optionDescriptors[t].currentValue:(console.log('DEV: Warning: FlynnOptionManager.getOption() called for key "'+t+'", which does not match an existing option.  Returning null.'),null)},revertToDefaults:function(){for(var t in this.optionDescriptors){var e=this.optionDescriptors[t];e.currentValue!=e.defaultValue&&(e.currentValue=e.defaultValue,e.type in this.SHADOWED_OPTION_TYPES&&(Flynn.mcp.options[t]=e.defaultValue),e.type==Flynn.OptionType.INPUT_KEY&&this.setOption(e.keyName,e.currentValue),e.commandHandler&&e.commandHandler())}},loadFromCookies:function(){this.revertToDefaults();for(var t=this.getOptionKeyNames(),e=0,n=t.length;e<n;e++){var i=t[e],o=document.title+":OPT_"+i,s=Cookies.get(o);if(s)try{var r=JSON.parse(s);this.setOption(i,r),Flynn.mcp.developerModeEnabled&&console.log('DEV: flynnOptionManager: Fetched "'+i+'" = "'+r+'".')}catch(t){console.log('DEV: Could not parse attribute value "'+s+'" for cookie "'+o+'".')}}this.saveAllToCookies(),this.cookiesFetched=!0},saveAllToCookies:function(){for(var t=this.getOptionKeyNames(),e=0,n=t.length;e<n;e++){var i=t[e];this.saveOptionToCookies(i)}},saveOptionToCookies:function(t){if(this.optionDescriptors[t].type!=Flynn.OptionType.COMMAND){var e=document.title+":OPT_"+t,n=this.getOption(t),i=JSON.stringify(n);Cookies.set(e,i,{expires:1/0}),Flynn.mcp.developerModeEnabled&&console.log('DEV: flynnOptionManager: Saved "'+t+'" = "'+n+'".')}},executeCommand:function(t){t in this.optionDescriptors&&this.optionDescriptors[t].type===Flynn.OptionType.COMMAND?this.optionDescriptors[t].commandHandler():console.print('DEV: Warning: FlynnOptionManager.executeCommand() called for key "'+t+'", which does not exist or is not of type COMMAND.  Doing nothing.')},getOptionKeyNames:function(){var t=[],e=[],n=[],i=[];for(var o in this.optionDescriptors)switch(this.optionDescriptors[o].type){case Flynn.OptionType.INPUT_KEY:t.push(o);break;case Flynn.OptionType.COMMAND:e.push(o);break;case Flynn.OptionType.MULTI:n.push(o);break;case Flynn.OptionType.BOOLEAN:i.push(o)}return t.concat(n,i,e)}})}(),function(){"use strict";Flynn.Mcp=Class.extend({init:function(t,e,n,i,o,s,r){Flynn.mcp=this,this.canvasWidth=t,this.canvasHeight=e,this.noChangeState=n,this.gameSpeedFactor=i,this.stateBuilderFunc=o,"undefined"==typeof s?this.hideCanvas=!1:this.hideCanvas=s,"undefined"==typeof r&&(r=!1),this.developerModeEnabled=Flynn.Util.getUrlFlag("develop"),this.arcadeModeEnabled=Flynn.Util.getUrlFlag("arcade"),this.iCadeModeEnabled=Flynn.Util.getUrlFlag("icade"),this.backEnabled=Flynn.Util.getUrlFlag("back"),this.mousetouchEnabled=Flynn.Util.getUrlFlag("mousetouch"),this.halted=!1,this.audio_mute_enabled=!1,this.credits=0,this.next_state_id=n,this.current_state_id=null,this.current_state=null,this.devPacingMode=Flynn.DevPacingMode.NORMAL,this.devLowFpsPaceFactor=0,this.devLowFpsFrameCount=0,this.viewport={x:0,y:0},this.resizeFunc=null,this.slowMoDebug=!1,this.clock=0,this.timers=new Flynn.Timers,this.options={},this.optionManager=new Flynn.OptionManager(this),this.custom={},this.canvas=new Flynn.Canvas(t,e),this.touch_control_canvas=this.canvas,this.input=new Flynn.InputHandler,this.iCadeModeEnabled&&(this.input.enableICade(),this.arcadeModeEnabled=!0),this.input.setupUIButtons(),this.flynn_logo=new Flynn.Polygon(Flynn.Points.FLYNN_LOGO,Flynn.Colors.DODGERBLUE,2,{x:Flynn.mcp.canvasWidth-55,y:Flynn.mcp.canvasHeight-41,is_world:!1}),this.browserSupportsPerformance=!0;try{performance.now()}catch(t){this.browserSupportsPerformance=!1}this.browserIsIos=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),this.browserSupportsTouch=Flynn.Util.is_mobile_or_tablet_browser()&&"ontouchstart"in document.documentElement||this.mousetouchEnabled,this.developerModeEnabled&&(console.log("DEV: title="+document.title),console.log("DEV: browserSupportsPeformance="+this.browserSupportsPerformance),console.log("DEV: browserIsIos="+this.browserIsIos),console.log("DEV: browserSupportsTouch="+this.browserSupportsTouch),console.log("DEV: Cookies: enabled="+Cookies.enabled),console.log("DEV: arcadeModeEnabled="+this.arcadeModeEnabled),console.log("DEV: iCadeModeEnabled="+this.iCadeModeEnabled),console.log("DEV: backEnabled="+this.backEnabled));var a=null,l=Flynn.Util.getUrlValue("vector");for(var h in Flynn.VectorMode)l===h&&(a=Flynn.VectorMode[h]);null===a&&(a=this.browserSupportsTouch?Flynn.VectorMode.V_THICK:Flynn.VectorMode.V_THIN),r||this.optionManager.addOption("vectorMode",Flynn.OptionType.MULTI,a,a,"VECTOR DISPLAY EMULATION",[["NONE",Flynn.VectorMode.PLAIN],["NORMAL",Flynn.VectorMode.V_THIN],["THICK",Flynn.VectorMode.V_THICK],["FLICKER",Flynn.VectorMode.V_FLICKER]],null);var c=this;this.resize=function(){var t={width:window.innerWidth,height:window.innerHeight},e=1024,n=768,i=Math.min(t.height/n,t.width/e),o=Math.floor(e*i),s=Math.floor(n*i),r=Math.floor(t.height/2-s/2),a=Math.floor(t.width/2-o/2),l=document.getElementById("gameCanvas");c.hideCanvas||(l.style.display="block"),l.style.width=o+"px",l.style.height=s+"px",l.style.top=r+"px",l.style.left=a+"px",c.resizeFunc&&c.resizeFunc(t.width,t.height),c.input.updateVisibilityAllControls()},window.addEventListener("resize",this.resize)},setTouchControlCanvas:function(t){this.touch_control_canvas=t},setResizeFunc:function(t){this.resizeFunc=t},changeState:function(t){this.next_state_id=t},muteAudio:function(t){this.audio_mute_enabled=t,Howler.mute(t)},devHalt:function(){var t=this.canvas.ctx,e=60,n=20,i=this.canvasWidth-2*n,o=n,s=this.canvasHeight/2-e/2;this.halted=!0,console.log("DEV: Execution halted"),t.vectorRect(o,s,i,e,Flynn.Colors.CYAN,Flynn.Colors.BLACK),t.vectorText("MCP HALTED.  CLICK TO RESUME.",4,null,null,null,Flynn.Colors.WHITE),Howler.mute(!0)},devResume:function(){this.halted=!1,console.log("DEV: Execution resumed"),this.run(),Howler.mute(this.audio_mute_enabled)},cycleDevPacingMode:function(){switch(this.devPacingMode){case Flynn.DevPacingMode.NORMAL:this.devPacingMode=Flynn.DevPacingMode.SLOW_MO;break;case Flynn.DevPacingMode.SLOW_MO:this.devPacingMode=Flynn.DevPacingMode.FPS_20;break;case Flynn.DevPacingMode.FPS_20:this.devPacingMode=Flynn.DevPacingMode.NORMAL}},toggleDevPacingSlowMo:function(){this.devPacingMode===Flynn.DevPacingMode.SLOW_MO?this.devPacingMode=Flynn.DevPacingMode.NORMAL:this.devPacingMode=Flynn.DevPacingMode.SLOW_MO},toggleDevPacingFps20:function(){this.devPacingMode===Flynn.DevPacingMode.FPS_20?this.devPacingMode=Flynn.DevPacingMode.NORMAL:this.devPacingMode=Flynn.DevPacingMode.FPS_20},renderLogo:function(t,e){"undefined"!=typeof e&&(this.flynn_logo.position=e),this.flynn_logo.render(t),t.vectorText(Flynn.VERSION,1.5,this.flynn_logo.position.x,this.flynn_logo.position.y+23,"center",Flynn.Colors.GRAY)},run:function(){var t=this;this.canvas.animate(function(e){var n=!1,i=null;switch(t.devPacingMode){case Flynn.DevPacingMode.NORMAL:e*=t.gameSpeedFactor;break;case Flynn.DevPacingMode.SLOW_MO:e*=.2*t.gameSpeedFactor,i="SLOW_MO";break;case Flynn.DevPacingMode.FPS_20:e*=t.gameSpeedFactor,++t.devLowFpsFrameCount,t.devLowFpsPaceFactor+=e,5===t.devLowFpsFrameCount?(t.devLowFpsFrameCount=0,e=t.devLowFpsPaceFactor,t.devLowFpsPaceFactor=0):n=!0,i="FPS_20"}n||(t.next_state_id!==t.noChangeState&&(t.current_state&&t.current_state.destructor&&t.current_state.destructor(),t.current_state=t.stateBuilderFunc(t.next_state_id),t.current_state_id=t.next_state_id,t.next_state_id=t.noChangeState,t.input.updateVisibilityAllControls()),t.clock+=e,t.timers.update(e),t.current_state&&(t.current_state.handleInputs(t.input,e),t.current_state.update(e),t.current_state.render(t.canvas.ctx),i&&t.canvas.ctx.vectorText(i,1.5,10,t.canvasHeight-20,"left",Flynn.Colors.GRAY),t.input.renderTouchRegions(t.touch_control_canvas.ctx),t.input.renderVirtualJoysticks(t.touch_control_canvas.ctx),t.developerModeEnabled&&t.input.virtualButtonWasPressed("UI_halt")&&t.devHalt()))})}})}(),function(){"use strict";Flynn.Leaderboard=Class.extend({init:function(t,e,n){this.attributeList=t,this.maxItems=e,this.sortDescending=n,this.leaderList=[],this.defaultLeaderList=[]},setDefaultList:function(t){this.defaultLeaderList=t},loadFromCookies:function(){this.leaderList=[];for(var t=0,e=!1;!e;){for(var n={},i=0,o=this.attributeList.length;i<o;++i){var s=this.attributeList[i],r=document.title+":LB"+t+"_"+s,a=Cookies.get(r);Flynn.mcp.developerModeEnabled&&console.log("DEV: flynnLeaderboard: Fetched "+r+":"+a),a?n[s]=a:e=!0,i===this.maxItems-1&&(e=!0)}e||(this.leaderList.push(n),++t)}0===t&&(this.leaderList=this.defaultLeaderList),this.sortAndTruncate()},saveToCookies:function(){var t,e;for(t=0,e=this.leaderList.length;t<e;t++)for(var n=this.leaderList[t],i=0,o=this.attributeList.length;i<o;++i){var s=this.attributeList[i],r=document.title+":LB"+t+"_"+s,a=n[s];Cookies.set(r,a,{expires:1/0}),Flynn.mcp.developerModeEnabled&&console.log("DEV: flynnLeaderboard: Saved "+r+":"+a)}},add:function(t){this.leaderList.push(t),this.sortAndTruncate(),this.saveToCookies()},getBestEntry:function(){
return this.leaderList[0]},getWorstEntry:function(){return this.leaderList[this.leaderList.length-1]},sortAndTruncate:function(){this.sortDescending?this.leaderList.sort(function(t,e){return e.score-t.score}):this.leaderList.sort(function(t,e){return t.score-e.score});var t=this.leaderList.length-this.maxItems;t>0&&this.leaderList.splice(this.leaderList.length-t,t)},restoreDefaults:function(){this.leaderList=this.defaultLeaderList,this.sortAndTruncate(),this.saveToCookies()}})}(),function(){"use strict";Flynn.Particle=Class.extend({PARTICLE_LIFE_VARIATION:20,PARTICLE_LIFE:50,PARTICLE_FRICTION:.99,init:function(t,e,n,i,o,s){this.particles=t,this.x=e,this.y=n,this.dx=i,this.dy=o,this.color=s,this.life=this.PARTICLE_LIFE+(Math.random()-.5)*this.PARTICLE_LIFE_VARIATION},update:function(t){var e=!0;if(this.life-=t,this.life<=0)e=!1;else{this.x+=this.dx*t,this.y+=this.dy*t;var n=Math.pow(this.PARTICLE_FRICTION,t);this.dx*=n,this.dy*=n}return e},draw:function(t){t.fillStyle=this.color,t.fillRect(this.x,this.y,2,2)}}),Flynn.Particles=Class.extend({VELOCITY_VARIATION:1,init:function(){this.particles=[]},explosion:function(t,e,n,i,o,s,r){"undefined"==typeof s&&(s=0),"undefined"==typeof r&&(r=0);for(var a=0;a<n;a++){var l=Math.random()*Math.PI*2,h=i*(1-this.VELOCITY_VARIATION+Math.random()*this.VELOCITY_VARIATION);this.particles.push(new Flynn.Particle(this,t,e,Math.cos(l)*h+s,Math.sin(l)*h+r,o))}},update:function(t){for(var e=0,n=this.particles.length;e<n;e+=1)this.particles[e].update(t)||(this.particles.splice(e,1),n--,e--)},draw:function(t){for(var e=0,n=this.particles.length;e<n;e+=1)this.particles[e].draw(t)}})}(),function(){"use strict";Flynn.VirtualJoystick=Class.extend({STICK_LIMIT_RATIO:.9,D_WITDH:.6,D_LENGH:.85,INNER_RADIUS_RATIO:.66,init:function(t){t=t||{},t.button_map=t.button_map||{},this.strokeStyle=t.strokeStyle||"rgba(255,255,255,0.3)",this.pos=t.pos||{x:100,y:100},this.radius=t.radius||60,this.deadzone_radius=t.deadzone_radius||8,this.capture_radius=t.capture_radius||this.radius,this.visible_states=t.visible_states||null,this.type=t.type||"stick",this.name=t.name||"joystick0",this.buttons={up:{name:t.button_map.up||null,pressed:!1},down:{name:t.button_map.down||null,pressed:!1},right:{name:t.button_map.right||null,pressed:!1},left:{name:t.button_map.left||null,pressed:!1}},this.limit_radius=this.radius*this.STICK_LIMIT_RATIO,this.touchstart_pos={x:0,y:0},this.stick_offset={x:0,y:0},this.analog_pos={x:0,y:0},this.in_use=!1,this.touch_identifier=null,this.is_visible=!1,this.theshold=Math.sin(Math.PI/8)},clear_all:function(){this.in_use=!1,this.touch_identifier=null,this.stick_offset={x:0,y:0},this.buttons.down.pressed=!1,this.buttons.up.pressed=!1,this.buttons.right.pressed=!1,this.buttons.left.pressed=!1},updateVisibility:function(t){var e,n;if(!this.visible_states)return void(this.is_visible=!0);for(e=0,n=this.visible_states;e<n;e++)if(t==this.visible_states[e])return void(this.is_visible=!0);this.is_visible=!1},handleTouchStart:function(t,e,n){var i=!1;return this.is_visible&&Flynn.Util.distance(t,e,this.pos.x,this.pos.y)<this.capture_radius&&(this.touch_identifier=n,this.in_use=!0,"stick"==this.type||"analog"==this.type?(this.touchstart_pos={x:t,y:e},this.stick_offset={x:0,y:0}):this.handleTouchMove(t,e,n),i=!0),i},handleTouchEnd:function(t,e,n){var i=!1;return this.is_visible&&n==this.touch_identifier&&(this.clear_all(),i=!0,"analog"==this.type&&(this.analog_pos.x=0,this.analog_pos.y=0)),i},handleTouchMove:function(t,e,n){if(this.is_visible&&n==this.touch_identifier){var i,o,s;"stick"==this.type||"analog"==this.type?(i=new Victor(t-this.touchstart_pos.x,e-this.touchstart_pos.y),o=i.clone().normalize(),s=i.length(),s>this.limit_radius&&(i=o.clone().multiply(new Victor(this.limit_radius,this.limit_radius)),s=this.limit_radius),this.stick_offset.x=i.x,this.stick_offset.y=i.y,"analog"==this.type?(this.analog_pos.x=i.x/this.limit_radius,this.analog_pos.y=i.y/this.limit_radius):s>this.deadzone_radius?(this.buttons.down.pressed=o.y>this.theshold,this.buttons.up.pressed=o.y<-this.theshold,this.buttons.right.pressed=o.x>this.theshold,this.buttons.left.pressed=o.x<-this.theshold):(this.buttons.down.pressed=!1,this.buttons.up.pressed=!1,this.buttons.right.pressed=!1,this.buttons.left.pressed=!1)):(i=new Victor(t-this.pos.x,e-this.pos.y),o=i.clone().normalize(),s=i.length(),s>this.deadzone_radius&&s<this.limit_radius?(this.buttons.down.pressed=o.y>this.theshold,this.buttons.up.pressed=o.y<-this.theshold,this.buttons.right.pressed=o.x>this.theshold,this.buttons.left.pressed=o.x<-this.theshold):(this.buttons.down.pressed=!1,this.buttons.up.pressed=!1,this.buttons.right.pressed=!1,this.buttons.left.pressed=!1))}},render:function(t){if(this.is_visible){if("dpad"==this.type){var e=this.radius*this.D_WITDH/2,n=this.radius*this.D_LENGH,i=this.pos.x,o=this.pos.y;t.beginPath(),t.strokeStyle=this.strokeStyle,t.lineWidth=6,t.lineCap="square",t.moveTo(i+e,o-n),t.lineTo(i+e,o-e),t.lineTo(i+n,o-e),t.lineTo(i+n,o+e),t.lineTo(i+e,o+e),t.lineTo(i+e,o+n),t.lineTo(i-e,o+n),t.lineTo(i-e,o+e),t.lineTo(i-n,o+e),t.lineTo(i-n,o-e),t.lineTo(i-e,o-e),t.lineTo(i-e,o-n),t.lineTo(i+e,o-n),t.stroke()}else t.beginPath(),t.strokeStyle=this.strokeStyle,t.lineWidth=6,t.arc(this.pos.x,this.pos.y,this.radius*this.INNER_RADIUS_RATIO,0,2*Math.PI),t.stroke();if("stick"==this.type){var s,r,a,l;for(t.beginPath(),t.strokeStyle=this.strokeStyle,t.lineWidth=1,s=0;s<8;s++)r=Math.PI/4*s+Math.PI/8,a=Math.cos(r),l=Math.sin(r),t.moveTo(a*(this.radius*this.INNER_RADIUS_RATIO+3)+this.pos.x,l*(this.radius*this.INNER_RADIUS_RATIO+3)+this.pos.y),t.lineTo(a*(this.radius-1)+this.pos.x,l*(this.radius-1)+this.pos.y);t.stroke()}t.beginPath(),t.strokeStyle=this.strokeStyle,t.lineWidth=2,t.arc(this.pos.x,this.pos.y,this.radius,0,2*Math.PI),t.stroke(),!this.in_use||"stick"!=this.type&&"analog"!=this.type||(t.beginPath(),t.strokeStyle=this.strokeStyle,t.lineWidth=6,t.arc(this.pos.x+this.stick_offset.x,this.pos.y+this.stick_offset.y,this.radius*this.INNER_RADIUS_RATIO,0,2*Math.PI),t.stroke())}}})}();var Game=Game||{};!function(){"use strict";Flynn.VALogo=Class.extend({POINTS:{FLASK:[-6,-12,9e3,8012,-5,-12,-5,-1,-10,6,-10,10,-8,12,8,12,10,10,10,6,5,-1,5,-12,6,-12,9e3,7e3,3,-9,9e3,8009,3,0,8,7,8,9,7,10,-7,10,-8,9,-8,7,-3,0,-3,-9,3,-9],INNER_BOUNDS:[3,-9,3,0,8,7,8,9,7,10,-7,10,-8,9,-8,7,-3,0,-3,-9,3,-9]},FLASK_INNER_X_MAX:8,FLASK_INNER_Y_MAX:10,FLASK_INNER_Y_MIN:-9,FLASK_VAPOR_Y_MIN:-30,BUBBLE_BOTTOM_PROBABILITY:.8,BUBBLE_RATE:4,BUBBLE_ACCELERATION:.002,BUBBLE_DECELERARION:.003,BUBBLE_DIE_VELOCITY:-.001,BUBBLE_GROW_RATE:.007,BUBBLE_DIE_RATE_MIN:-.001,BUBBLE_DIE_RATE_MAX:-.05,WIGGLE_RATE_ACCELERATION:1e-4,WIGGLE_RATE_MAX:.03,WIGGLE_DISPLACEMENT_ANGLE:Math.PI/6,init:function(t,e,n,i){this.pos={x:t,y:e},this.scale=n,this.bubbles=[],this.wiggle_angle=0,this.wiggle_rate=0,"undefined"==typeof i&&(i=!0),i?this.text_color="#C0E0C0":this.text_color=Flynn.Colors.GRAY,this.flask=new Flynn.Polygon(this.POINTS.FLASK,Flynn.Colors.WHITE,n,{x:t,y:e,is_world:!1}),this.inner_bounds=new Flynn.Polygon(this.POINTS.INNER_BOUNDS,Flynn.Colors.WHITE,n,{x:t,y:e,is_world:!1}),this.angle=0,this.spin_rate=Math.PI/300,this.bubble_time=0;for(var o=0;o<180;o++)this.update(1),this.wiggle_angle=0,this.wiggle_rate=0},bubble_in_inner:function(t){var e=t.x>0?2:-1;return this.inner_bounds.hasPoint(t.x*this.scale+this.pos.x+e,t.y*this.scale+this.pos.y)},update:function(t){if(this.wiggle_rate+=this.WIGGLE_RATE_ACCELERATION*t,this.wiggle_rate=Math.min(this.wiggle_rate,this.WIGGLE_RATE_MAX),this.wiggle_angle+=this.wiggle_rate*t,this.angle=Math.sin(this.wiggle_angle)*this.WIGGLE_DISPLACEMENT_ANGLE,this.bubble_time+=t,this.bubble_time>this.BUBBLE_RATE){this.bubble_time-=this.BUBBLE_RATE;var e={velocity:0,brightness:0,die_rate:Flynn.Util.randomFromInterval(this.BUBBLE_DIE_RATE_MIN,this.BUBBLE_DIE_RATE_MAX)};e.x=Flynn.Util.randomFromInterval(-this.FLASK_INNER_X_MAX,this.FLASK_INNER_X_MAX),e.x=this.FLASK_INNER_X_MAX*Flynn.Util.logish(Math.random(),0,1,2),Math.random()<.5&&(e.x=-e.x),Math.random()<this.BUBBLE_BOTTOM_PROBABILITY?e.y=this.FLASK_INNER_Y_MAX-1:e.y=Flynn.Util.randomFromInterval(this.FLASK_INNER_Y_MIN,this.FLASK_INNER_Y_MAX),this.bubble_in_inner(e)&&this.bubbles.push(e)}for(var n=this.bubbles.length,i=this.BUBBLE_ACCELERATION*t,o=this.BUBBLE_DECELERARION*t,s=0;s<n;s++){var r=this.bubbles[s];if(r.y>this.FLASK_INNER_Y_MIN?r.brightness+=this.BUBBLE_GROW_RATE*t:r.brightness+=r.die_rate*t,r.brightness=Flynn.Util.minMaxBound(r.brightness,0,1),r.y>this.FLASK_INNER_Y_MIN)r.velocity-=i;else if(r.velocity+=o,r.velocity>=this.BUBBLE_DIE_VELOCITY){this.bubbles.splice(s,1),s-=1,n-=1;continue}r.y+=r.velocity*t,r.y>this.FLASK_INNER_Y_MIN?this.bubble_in_inner(r)||(r.x>0?r.x-=.2:r.x+=.2):r.x+=.2*t*Math.sin(this.wiggle_angle-Math.PI/4)*this.wiggle_rate/this.WIGGLE_RATE_MAX,r.y<this.FLASK_VAPOR_Y_MIN&&(this.bubbles.splice(s,1),s-=1,n-=1)}},render:function(t){for(var e=1.4,n=40,i=2,o=this.bubbles.length,s=0;s<o;s++)t.fillStyle=Flynn.Colors.ORANGE,this.bubbles[s].y>this.FLASK_INNER_Y_MIN?t.fillStyle=Flynn.Util.shadeBlend(-(1-this.bubbles[s].brightness),Flynn.Colors.ORANGE):t.fillStyle=Flynn.Util.shadeBlend(-(1-this.bubbles[s].brightness),Flynn.Colors.GRAY),t.fillRect(this.bubbles[s].x*this.scale+this.pos.x,this.bubbles[s].y*this.scale+this.pos.y+1,2,2);this.flask.render(t),t.vectorTextArc("VECTOR",this.scale*e,this.pos.x,this.pos.y,-Math.PI/2+this.angle,this.scale*n,this.text_color,!0,!1,!1,Flynn.Font.Block,i),t.vectorTextArc("ALCHEMY",this.scale*e,this.pos.x,this.pos.y,Math.PI/2+this.angle,this.scale*n,this.text_color,!0,!0,!1,Flynn.Font.Block,i)}})}();
//# sourceMappingURL=flynn.core.min.js.source-map