var Flynn=Flynn||{};!function(){"use strict";Flynn.VERSION="3.21.0u",Flynn.init=function(t,e,n,i,o,s,r,l,a){void 0===s&&(s=!1),void 0===r&&(r=!1),void 0===l&&(l=!1),void 0===a&&(a=!0),Flynn.sounds=l?{ui_move:Flynn.NullSoundHandler,ui_select:Flynn.NullSoundHandler,ui_cancel:Flynn.NullSoundHandler,ui_success:Flynn.NullSoundHandler,ui_error:Flynn.NullSoundHandler}:{ui_move:new Howl({src:["sounds/UI_move.webm","sounds/UI_move.mp3"],volume:.4}),ui_select:new Howl({src:["sounds/UI_select.webm","sounds/UI_select.mp3"],volume:.4}),ui_cancel:new Howl({src:["sounds/UI_cancel.webm","sounds/UI_cancel.mp3"],volume:.4}),ui_success:new Howl({src:["sounds/UI_success.webm","sounds/UI_success.mp3"],volume:.4}),ui_error:new Howl({src:["sounds/UI_error.webm","sounds/UI_error.mp3"],volume:.4})},Flynn.monkeyPatchVictor(),new Flynn.Mcp(t,e,n,i,o,s,r,a)},Flynn.TICKS_PER_SECOND=60,Flynn.DevPacingMode={NORMAL:0,SLOW_MO:1,FPS_20:2},Flynn.Colors={BLACK:"#000000",WHITE:"#FFFFFF",GRAY:"#FFFFFF80",GRAY_DK:"#FFFFFF40",RED:"#FF0000",GREEN:"#00FF00",BLUE:"#2020FF",CYAN:"#00FFFF",MAGENTA:"#FF00FF",YELLOW:"#FFFF00",ORANGE:"#E55300",BROWN:"#E56C0080",YELLOW_DK:"#FFE00080",CYAN_DK:"#00FFFF80",LIGHTSKYBLUE:"#87CEFA",DODGERBLUE:"#1E90FF",LIGHTBLUE:"#ADD8E6"},Flynn.ColorsOrdered=[Flynn.Colors.BLACK,Flynn.Colors.BLUE,Flynn.Colors.WHITE,Flynn.Colors.GREEN,Flynn.Colors.YELLOW,Flynn.Colors.RED,Flynn.Colors.CYAN,Flynn.Colors.MAGENTA,Flynn.Colors.CYAN_DK,Flynn.Colors.ORANGE,Flynn.Colors.BROWN,Flynn.Colors.YELLOW_DK,Flynn.Colors.GRAY,Flynn.Colors.GRAY_DK,Flynn.Colors.LIGHTSKYBLUE,Flynn.Colors.DODGERBLUE,Flynn.Colors.LIGHTBLUE],Flynn.KeyboardMap={num_0:48,num_1:49,num_2:50,num_3:51,num_4:52,num_5:53,num_6:54,num_7:55,num_8:56,num_9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,semicolon:186,equals:187,comma:188,dash:189,period:190,forward_slash:191,grave_accent:192,left_bracket:219,backslash:220,right_bracket:221,single_quote:222,delete:8,tab:9,enter:13,shift:16,control:17,option:18,escape:27,spacebar:32,left:37,up:38,right:39,down:40,l_command:91,r_command:93,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,icade_up:-1,icade_down:-2,icade_left:-3,icade_right:-4,icade_t1:-5,icade_t2:-6,icade_t3:-7,icade_t4:-8,icade_b1:-9,icade_b2:-10,icade_b3:-11,icade_b4:-12},Flynn.Points={FLYNN_LOGO:[9e3,8014,-21,-9,-21,5,-19,5,-19,-1,-15,-1,-15,-3,-19,-3,-19,-7,17,-7,17,-9,-21,-9,9e3,7e3,-13,5,-13,-5,-11,-5,-11,3,-7,3,-7,5,-13,5,9e3,7e3,-9,-5,9e3,8005,-4,0,-4,5,-2,5,-2,0,3,-5,0,-5,-3,-2,-6,-5,-9,-5,9e3,7e3,1,5,9e3,8014,1,-1,9e3,8001,4,-4,9e3,8014,6,0,6,-5,8,-5,8,5,6,5,3,-1,3,5,1,5,9e3,7e3,10,-5,10,5,12,5,12,-1,15,5,17,5,17,-5,15,-5,15,0,13,-5,10,-5,9e3,7e3,19,-9,19,7,-21,7,-21,9,21,9,21,-9,19,-9]},Flynn.PEN_COMMAND=9e3,Flynn.PEN_UP=7e3,Flynn.PEN_COLOR0=8e3,Flynn.Font={},Flynn.Font.Normal={CharacterHeight:6,CharacterWidth:4,CharacterGap:2,CharacterSpacing:6,Points:{UNIMPLEMENTED_CHAR:[0,0,4,6,4,0,0,6,0,0,4,0,9e3,7e3,0,6,4,6],ASCII:[[1,0,2,5,1.5,5,1.5,6,2.5,6,2.5,5,2,5,3,0,1,0],[1,0,1,1,9e3,7e3,3,0,3,1],[1,5,1,1,9e3,7e3,0,2,4,2,9e3,7e3,3,1,3,5,9e3,7e3,4,4,0,4],[0,6,3,6,4,5,4,4,3,3,1,3,0,2,0,1,1,0,4,0,9e3,7e3,2,0,2,6],[0,6,4,0,9e3,7e3,2,5,2,1,0,1,0,3,4,3,4,5,2,5],[4,6,1,2,1,1,2,0,3,1,3,2,0,4,0,5,1,6,2,6,4,4],[2,0,2,1,2,0],[3.5,6,1.95,4,1.95,2,3.5,0],[.5,6,2.05,4,2.05,2,.5,0],[0,1,4,5,9e3,7e3,2,5,2,1,9e3,7e3,4,3,0,3,9e3,7e3,0,5,4,1],[2,5,2,1,9e3,7e3,0,3,4,3],[2,5,1,6,2,5],[1,3,3,3],[1.5,6,1.5,5,2.5,5,2.5,6,1.5,6],[1,6,3,0,1,6],[0,0,4,0,4,6,0,6,0,0],[2,0,2,6],[0,0,4,0,4,3,0,3,0,6,4,6],[0,0,4,0,4,6,0,6,9e3,7e3,0,3,4,3],[4,6,4,0,9e3,7e3,0,0,0,3,4,3],[4,0,0,0,0,3,4,3,4,6,0,6],[0,0,0,6,4,6,4,3,0,3],[0,0,4,0,4,6],[4,0,4,6,0,6,0,0,4,0,9e3,7e3,0,3,4,3],[4,3,0,3,0,0,4,0,4,6],[2,1,1.5,1.5,2,2,2.5,1.5,2,1,9e3,7e3,2,4,1.5,4.5,2,5,2.5,4.5,2,4],[2,1,1.5,1.5,2,2,2.5,1.5,2,1,9e3,7e3,1.5,4,2.5,4,1.5,6,1.5,4],[4,1,0,3,4,5,0,3,4,1],[0,1.5,4,1.5,9e3,7e3,0,4.5,4,4.5],[0,1,4,3,0,5,4,3,0,1],[0,2,0,1,1,0,3,0,4,1,4,2,2,3,2,4,9e3,7e3,2,5,2,6],[3,4,3,2,1,2,1,4,4,4,4,2,3,1,1,1,0,2,0,4,1,5,3,5],[0,6,0,2,2,0,4,2,4,6,9e3,7e3,0,4,4,4],[3,3,4,4,4,5,3,6,0,6,0,0,3,0,4,1,4,2,3,3,0,3],[4,0,0,0,0,6,4,6],[0,0,0,6,2,6,4,4,4,2,2,0,0,0],[4,0,0,0,0,6,4,6,9e3,7e3,0,3,3,3],[0,6,0,0,4,0,9e3,7e3,0,3,3,3],[4,2,4,0,0,0,0,6,4,6,4,4,2,4],[0,0,0,6,9e3,7e3,4,6,4,0,9e3,7e3,0,3,4,3],[0,0,4,0,9e3,7e3,0,6,4,6,9e3,7e3,2,0,2,6],[4,0,4,6,2,6,0,4],[0,0,0,6,9e3,7e3,4,6,0,3,4,0],[0,0,0,6,4,6],[0,6,0,0,2,2,4,0,4,6],[0,6,0,0,4,6,4,0],[0,0,4,0,4,6,0,6,0,0],[0,6,0,0,4,0,4,3,0,3],[0,0,0,6,2,6,4,4,4,0,0,0,9e3,7e3,2,4,4,6],[0,3,4,3,4,0,0,0,0,6,9e3,7e3,4,6,1,3],[4,0,0,0,0,3,4,3,4,6,0,6],[0,0,4,0,9e3,7e3,2,6,2,0],[0,0,0,6,4,6,4,0],[0,0,2,6,4,0],[0,0,0,6,2,4,4,6,4,0],[0,0,4,6,9e3,7e3,4,0,0,6],[2,6,2,3,4,0,9e3,7e3,0,0,2,3],[0,0,4,0,0,6,4,6],[3,0,1,0,1,6,3,6],[1,0,3,6],[1,0,3,0,3,6,1,6],[1,1,2,0,3,1],[0,6,4,6],[1.5,0,2.5,1],[4,4,0,4,0,6,4,6,4,2,0,2],[0,2,3,2,4,3,4,5,3,6,0,6,0,0],[4,2,0,2,0,6,4,6],[4,2,1,2,0,3,0,5,1,6,4,6,4,0],[0,4,4,4,4,2,0,2,0,6,4,6],[4,0,2,0,1,1,1,6,9e3,7e3,0,3,3,3],[4,6,1,6,0,5,0,3,1,2,4,2,4,8,3,9,0,9],[4,6,4,3,3,2,0,2,9e3,7e3,0,6,0,0],[2,0,2,0,9e3,7e3,1,2,2,2,2,6,9e3,7e3,3,6,1,6],[4,0,4,0,9e3,7e3,3,2,4,2,4,8,3,9,0,9],[0,4,4,6,9e3,7e3,4,2,0,4,0,6,0,0],[1,6,3,6,2,6,2,0,1,0],[4,6,4,2,2,2,2,4,9e3,7e3,2,2,0,2,0,6],[0,6,0,2,3,2,4,3,4,6],[0,6,4,6,4,2,0,2,0,6],[0,6,3,6,4,5,4,3,3,2,0,2,0,9],[4,6,1,6,0,5,0,3,1,2,4,2,4,9],[0,6,0,2,3,2,4,3],[0,6,4,6,4,4,0,4,0,2,4,2],[1,0,1,5,2,6,4,6,9e3,7e3,0,2,4,2],[4,2,4,6,0,6,0,2],[4,2,2,6,0,2],[4,2,4,6,2,4,0,6,0,2],[0,6,4,2,9e3,7e3,4,6,0,2],[0,2,0,5,1,6,4,6,9e3,7e3,4,2,4,8,3,9,0,9],[4,6,0,6,4,2,0,2],[3,0,2,0,2,2.5,1,3,2,3.5,2,6,3,6],[2,0,2,6],[1,0,2,0,2,2.5,3,3,2,3.5,2,6,1,6],[.5,3.5,1.5,2.5,2.5,3.5,3.5,2.5]]}},Flynn.Font.Block={CharacterHeight:10,CharacterWidth:6,CharacterGap:3,CharacterSpacing:9,Points:{}},Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR=[0,0,6,10,6,0,0,10,0,0,6,0,9e3,7e3,0,10,6,10],Flynn.Font.Block.Points.ASCII=[[4,8,2,8,2,10,4,10,4,8,9e3,7e3,1,0,3,6,5,0,1,0],Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,[0,6,6,6,6,4,0,4,0,6],Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,[0,1,0,9,1,10,5,10,6,9,6,1,5,0,1,0,0,1,9e3,7e3,2,2,4,2,4,8,2,8,2,2],[2,8,1,8,1,10,5,10,5,8,4,8,4,0,2,0,1,1,1,2,2,2,2,8],[0,1,0,3,2,3,2,2,4,2,0,8,0,10,6,10,6,8,2,8,6,2,6,1,5,0,1,0,0,1],[0,1,0,3,2,3,2,2,4,2,4,4,2,4,2,6,4,6,4,8,2,8,2,7,0,7,0,9,1,10,5,10,6,9,6,1,5,0,1,0,0,1],[4,10,6,10,6,0,3,0,0,4,0,6,4,6,4,10,9e3,7e3,4,2,2.25,4,4,4,4,2],[0,10,5,10,6,9,6,5,5,4,2,4,2,2,6,2,6,0,0,0,0,6,4,6,4,8,0,8,0,10],[6,1,6,3,4,3,4,2,2,2,2,4,5,4,6,5,6,9,5,10,1,10,0,9,0,1,1,0,5,0,6,1,9e3,7e3,2,6,2,8,4,8,4,6,2,6],[0,10,2.25,10,5.75,0,0,0,0,2,3,2,0,10],[0,1,0,9,1,10,5,10,6,9,6,1,5,0,1,0,0,1,9e3,7e3,2,2,2,4,4,4,4,2,2,2,9e3,7e3,4,6,4,8,2,8,2,6,4,6],[0,7,0,9,1,10,5,10,6,9,6,1,5,0,1,0,0,1,0,5,1,6,4,6,4,8,2,8,2,7,0,7,9e3,7e3,2,2,2,4,4,4,4,2,2,2],Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,[0,0,0,10,2,10,2,6,4,6,4,10,6,10,6,0,0,0,9e3,7e3,2,2,4,2,4,4,2,4,2,2],[0,0,0,10,5,10,6,9,6,6,5,5,6,4,6,1,5,0,0,0,9e3,7e3,2,2,4,2,4,4,2,4,2,2,9e3,7e3,2,6,4,6,4,8,2,8,2,6],[2,2,6,2,6,0,0,0,0,10,6,10,6,8,2,8,2,2],[0,0,0,10,4,10,5,9,6,7,6,3,5,1,4,0,0,0,9e3,7e3,2,2,3,2,4,3,4,7,3,8,2,8,2,2],[0,0,0,10,6,10,6,8,2,8,2,6,3,6,5,4,2,4,2,2,6,2,6,0,0,0],[0,0,0,10,2,10,2,6,3,6,5,4,2,4,2,2,6,2,6,0,0,0],[2,2,6,2,6,0,0,0,0,10,6,10,6,5,3,5,4,6,4,8,2,8,2,2],[0,0,0,10,2,10,2,6,4,6,4,10,6,10,6,0,4,0,4,4,2,4,2,0,0,0],[0,0,0,2,2,2,2,8,0,8,0,10,6,10,6,8,4,8,4,2,6,2,6,0,0,0],[4,0,4,8,2,8,2,7,0,6,0,9,1,10,5,10,6,9,6,2,6,0,4,0],[0,0,0,10,2,10,2,7,4,10,6.5,10,3.25,5,6.5,0,4,0,2,3,2,0,0,0],[0,0,0,10,6,10,6,8,2,8,2,0,0,0],[0,0,0,10,2,10,2,4,3,6,4,4,4,10,6,10,6,0,4,0,3,2,2,0,0,0],[0,0,0,10,2,10,2,5,4,10,6,10,6,0,4,0,4,5,2,0,0,0],[0,1,0,9,1,10,5,10,6,9,6,1,5,0,1,0,0,1,9e3,7e3,2,2,4,2,4,8,2,8,2,2],[0,0,0,10,2,10,2,6,5,6,6,5,6,1,5,0,0,0,9e3,7e3,2,2,4,2,4,4,2,4,2,2],[6,0,0,0,0,10,3,10,4,9,5,10,6,9,5,8,6,7,6,0,9e3,7e3,4,2,2,2,2,8,4,6,4,2],[0,0,0,10,2,10,2,6,4,10,6,10,4,6,5,6,6,5,6,1,5,0,0,0,9e3,7e3,2,2,4,2,4,4,2,4,2,2],[6,0,1,0,0,1,0,5,1,6,4,6,4,8,0,8,0,10,5,10,6,9,6,5,5,4,2,4,2,2,6,2,6,0],[0,0,0,2,2,2,2,10,4,10,4,2,6,2,6,0,0,0],[0,0,0,9,1,10,5,10,6,9,6,0,4,0,4,8,2,8,2,0,0,0],[0,0,3,10,6,0,4,0,3,4,2,0,0,0],[0,0,0,10,2,10,3,8,4,10,6,10,6,0,4,0,4,6,3,4,2,6,2,0,0,0],[0,0,2,5,0,10,2,10,3,7,4,10,6,10,4,5,6,0,4,0,3,3,2,0,0,0],[-.5,0,2,5,2,10,4,10,4,5,6.5,0,4,0,3,2,2,0,-.5,0],[0,0,0,2,4,2,0,8,0,10,6,10,6,8,2,8,6,2,6,0,0,0],Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,Flynn.Font.Block.Points.UNIMPLEMENTED_CHAR,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],Flynn.sounds={},Flynn.NullSoundHandler={play:function(){}},Flynn.Rect=Class.extend({init:function(t,e,n,i){this.object_id="Flynn.Rect",this._setAttributes(t,e,n,i)},_setAttributes:function(t,e,n,i){this.left=t,this.top=e,this.width=n,this.height=i,this.center_x=this.left+this.width/2,this.center_y=this.top+this.height/2,this.center_position=new Victor(this.center_x,this.center_y),this.right=this.left+this.width,this.bottom=this.top+this.height},clone:function(){return new Flynn.Rect(this.left,this.top,this.width,this.height)},hasPoint:function(t,e){return t>this.left&&e>this.top&&t<this.right&&e<this.bottom},moveTo:function(t){this._setAttributes(t.x,t.y,this.width,this.height)}})}(),function(){"use strict";Flynn._3DCamera=Class.extend({init:function(){this.position=BABYLON.Vector3.Zero(),this.target=BABYLON.Vector3.Zero()}}),Flynn._3DMesh=Class.extend({init:function(t,e,n,i,o,s,r,l){this.name=t,this.vertices=e,this.lines=n,this.color=i,this.custom_palette=void 0===o?null:o,this.alpha=void 0===s?1:s,this.culling_faces=void 0===r?null:r,this.culling_lines=void 0===l?null:l,null!==this.culling_lines&&null!==this.culling_faces&&(this.culling_lines=this._parse_culling_lines(this.culling_lines,this.culling_faces)),this.world_vertices=new Array(e.length),this.projected_vertices=new Array(e.length),this.check_vertices=new Array(e.length),this.pre_rotation=null,this.rotation=BABYLON.Vector3.Zero(),this.position=BABYLON.Vector3.Zero()},_parse_culling_lines:function(t,e){const n=[];for(const l of t){var i,o,s=l[0],r=l[1];const a=[];for([i,o]of e.entries()){const c=[...o];c.push(o[0]);let e=!1;for(let t=0;t<c.length-1;t++)c[t]===s&&c[t+1]===r&&(e=!0),c[t+1]===s&&c[t]===r&&(e=!0);e&&a.push(i)}n.push([s,r,a])}return console.log(n),n},to_segments:function(){let t=null;t=(this.pre_rotation?BABYLON.Matrix.RotationYawPitchRoll(this.pre_rotation.y,this.pre_rotation.x,this.pre_rotation.z).multiply(BABYLON.Matrix.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)):BABYLON.Matrix.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).multiply(BABYLON.Matrix.Translation(this.position.x,this.position.y,this.position.z));const e=[];let n=null;for(const o of Object.values(this.lines)){var i;o!==Flynn.PEN_UP?(i=this.vertices[o],null!==n&&e.push({from:BABYLON.Vector3.TransformCoordinates(n,t),to:BABYLON.Vector3.TransformCoordinates(i,t)}),n=i):n=null}return e}}),Flynn._3DMeshCube=Flynn._3DMesh.extend({init:function(t,e,n){var i=e/2,e=[new BABYLON.Vector3(i,i,i),new BABYLON.Vector3(-i,i,i),new BABYLON.Vector3(-i,-i,i),new BABYLON.Vector3(i,-i,i),new BABYLON.Vector3(i,i,-i),new BABYLON.Vector3(-i,i,-i),new BABYLON.Vector3(-i,-i,-i),new BABYLON.Vector3(i,-i,-i)],i=[0,1,2,3,0,4,5,6,7,4,Flynn.PEN_UP,1,5,Flynn.PEN_UP,2,6,Flynn.PEN_UP,3,7];this._super(t,e,i,n,null,1,[[0,1,2,3],[7,6,5,4],[0,3,7,4],[0,4,5,1],[1,5,6,2],[2,6,7,3]],[[0,1],[1,2],[2,3],[3,0],[0,4],[1,5],[2,6],[3,7],[7,4],[4,5],[5,6],[6,7]])}}),Flynn._3DMeshTetrahedron=Flynn._3DMesh.extend({init:function(t,e,n){var i=e/(4/3),e=[new BABYLON.Vector3(-Math.sqrt(2/3),-1/3,Math.sqrt(2/9)).scale(i),new BABYLON.Vector3(Math.sqrt(2/3),-1/3,Math.sqrt(2/9)).scale(i),new BABYLON.Vector3(0,-1/3,-Math.sqrt(8/9)).scale(i),new BABYLON.Vector3(0,1,0).scale(i)],i=[0,1,3,0,2,3,Flynn.PEN_UP,2,1];this._super(t,e,i,n,null,1,[[0,1,3],[0,2,1],[0,3,2],[1,2,3]],[[0,1],[1,3],[0,3],[0,2],[1,2],[2,3]])}}),Flynn._3DMeshFromPoints=Flynn._3DMesh.extend({init:function(t,e,n,i){let o;const s=[],r=[];let l=0;for(o=0;o<e.length;o+=2)e[o]!==Flynn.PEN_COMMAND?(s.push(new BABYLON.Vector3(e[o]*n,0,e[o+1]*n)),r.push(l++)):e[o+1]===Flynn.PEN_UP&&r.push(Flynn.PEN_UP);this._super(t,s,r,i)}}),Flynn._3DMeshFromSegments=Flynn._3DMesh.extend({init:function(t,e,n){const i=[],o=[];let s=0;for(const r of Object.values(e))i.push(r.from),o.push(s++),i.push(r.to),o.push(s++),o.push(Flynn.PEN_UP);this._super(t,i,o,n)}}),Flynn._3DMeshPlate=Flynn._3DMesh.extend({init:function(t,e,n,i){e/=2,n/=2,n=[new BABYLON.Vector3(e,0,n),new BABYLON.Vector3(-e,0,n),new BABYLON.Vector3(-e,0,-n),new BABYLON.Vector3(e,0,-n)];this._super(t,n,[0,1,2,3,0],i)}}),Flynn._3DMeshText=Flynn._3DMesh.extend({init:function(t,e,n,i,o,s){let r,l,a,c,h,u;o=String(o);var d=-n/2;const p=[],_=[];var y=n/s.CharacterHeight,g=y*s.CharacterSpacing;let f=(o.length*g-s.CharacterGap*y)/2;for(this._super(t,p,_,i),r=0,a=o.length;r<a;r++)if(0<r&&_.push(Flynn.PEN_UP),h=o.charCodeAt(r),h!==e.SPACECODE){for(u=e.charToPolygon(h,s),l=0,c=u.length;l<c;l+=2)u[l]==Flynn.PEN_COMMAND?_.push(Flynn.PEN_UP):(p.push(new BABYLON.Vector3(f-u[l]*y,0,u[l+1]*y+d)),_.push(p.length-1));f-=g}else f+=g;this._super(t,p,_,i)}}),Flynn._3DRenderer=Class.extend({VERTEX_SIZE:2,init:function(t){t=t||{},this.width=t.width||Flynn.mcp.canvasWidth,this.height=t.height||Flynn.mcp.canvasHeight,this.fog_distance=t.fog_distance||null,this.enable_vertices=t.enable_vertices||!1,this.enable_lines=Flynn.Util.defaultTrue(t.enable_lines),this.enable_distance_order=Flynn.Util.defaultTrue(t.enable_distance_order),this.enable_backface_culling=t.enable_backface_culling||!1,this.enable_opacity=t.enable_opacity||!1,this.screenOffsetV=t.screenOffsetV||new Victor(0,0)},project:function(t,e){var n=BABYLON.Vector3.TransformCoordinates(t,e),t=n.x*this.width+this.width/2+this.screenOffsetV.x,e=-n.y*this.height+this.height/2+this.screenOffsetV.y;return new BABYLON.Vector3(t,e,n.z)},prepare:function(t){const e=BABYLON.Matrix.LookAtLH(t.position,t.target,BABYLON.Vector3.Up());t=BABYLON.Matrix.PerspectiveFovLH(.78,this.width/this.height,.01,1);this.pointTransformMatrix=e.multiply(t),this.transformCheckMatrix=e},renderPoint:function(t,e,n,i,o){0<BABYLON.Vector3.TransformCoordinates(e,this.transformCheckMatrix).z&&(e=this.project(e,this.pointTransformMatrix),t.fillStyle=i,t.fillRect(e.x-n/2,e.y-n/2,n,n,o))},projectPoint:function(t){return this.project(t,this.pointTransformMatrix)},render:function(i,e,o){let s;var r=BABYLON.Matrix.LookAtLH(e.position,e.target,BABYLON.Vector3.Up()),l=BABYLON.Matrix.PerspectiveFovLH(.78,this.width/this.height,.01,1);let a;var c;let h;const u=[];for(let n=0;n<o.length;n++){s=o[n];let t=0;if((this.fog_distance||this.enable_distance_order)&&(t=BABYLON.Vector3.Distance(e.position,s.position)),h=!0,a=s.color,this.fog_distance&&(t>this.fog_distance.far?h=!1:t>this.fog_distance.near&&(c=-((t-this.fog_distance.near)/(this.fog_distance.far-this.fog_distance.near)),a=Flynn.Util.shadeColor(s.color,c))),h){let e=null;e=(s.pre_rotation?BABYLON.Matrix.RotationYawPitchRoll(s.pre_rotation.y,s.pre_rotation.x,s.pre_rotation.z).multiply(BABYLON.Matrix.RotationYawPitchRoll(s.rotation.y,s.rotation.x,s.rotation.z)):BABYLON.Matrix.RotationYawPitchRoll(s.rotation.y,s.rotation.x,s.rotation.z)).multiply(BABYLON.Matrix.Translation(s.position.x,s.position.y,s.position.z));var d=e.multiply(r).multiply(l),p=e.multiply(r);for(let t=0;t<s.vertices.length;t++){s.world_vertices[t]=BABYLON.Vector3.TransformCoordinates(s.vertices[t],e);var _=this.project(s.vertices[t],d);s.projected_vertices[t]=_,s.check_vertices[t]=BABYLON.Vector3.TransformCoordinates(s.vertices[t],p),this.enable_vertices&&0<s.check_vertices[t].z&&(i.fillStyle=a,i.fillRect(_.x-this.VERTEX_SIZE/2,_.y-this.VERTEX_SIZE/2,this.VERTEX_SIZE,this.VERTEX_SIZE))}u.push({mesh_index:n,distance:t,color:a})}}this.enable_distance_order&&u.sort(function(t,e){return e.distance-t.distance}),this.enable_lines&&(this.enable_backface_culling?this._render_culled(i,e,o,u):this._render_all_wireframe(i,o,u))},_render_culled:function(e,n,t,i){let o,s;for(const y of i)if(s=y.color,o=t[y.mesh_index],null!==o.culling_lines&&null!=o.culling_faces){var r,l,a,c,h=o.world_vertices,u=o.projected_vertices;const g=[];for([r,l]of o.culling_faces.entries()){const f=h[l[0]];let t=h[l[1]];var d=t.subtract(f);t=h[l[l.length-1]];var p=t.subtract(f),d=BABYLON.Vector3.Cross(d,p),p=f.subtract(n.position),d=BABYLON.Vector3.Dot(p,d);if(d<0&&(g.push(r),this.enable_opacity)){const m=[];for(const v of l){var _=u[v];m.push(_.x),m.push(_.y)}e.graphics.beginFill(0,1),e.graphics.drawPolygon(m),e.graphics.endFill()}}for(const E of o.culling_lines){const F=E[2];0!==F.filter(t=>g.includes(t)).length&&(a=u[E[0]],c=u[E[1]],e.vectorStart(s,!1,!1,o.alpha),e.vectorMoveTo(a.x,a.y),e.vectorLineTo(c.x,c.y),e.vectorEnd())}}else this._render_mesh_wireframe(e,o,s)},_render_all_wireframe:function(t,e,n){for(const i of n)this._render_mesh_wireframe(t,e[i.mesh_index],i.color)},_render_mesh_wireframe:function(e,n,i){var o=n.lines,s=n.projected_vertices;let r=!0,l=!1;for(let t=0;t<o.length;t++){var a,c=o[t];c!=Flynn.PEN_UP?c>=Flynn.PEN_COLOR0?(a=c-Flynn.PEN_COLOR0,i=(null==n.custom_palette?Flynn.ColorsOrdered:n.custom_palette)[a],l&&e.vectorEnd(),r=!0):(a=s[c],r?0<n.check_vertices[c].z&&(e.vectorStart(i,!1,!1,n.alpha),e.vectorMoveTo(a.x,a.y),r=!1,l=!0):0<n.check_vertices[c].z&&e.vectorLineTo(a.x,a.y)):(e.vectorEnd(),r=!0)}l&&e.vectorEnd()},renderToPolygon:function(t,n){let i;var o=BABYLON.Matrix.LookAtLH(t.position,t.target,BABYLON.Vector3.Up()),s=BABYLON.Matrix.PerspectiveFovLH(.78,this.width/this.height,.01,1);const r=[];let l=!1;for(let t=0;t<n.length;t++){l=0!=r.length,i=n[t];const p=BABYLON.Matrix.RotationYawPitchRoll(i.rotation.y,i.rotation.x,i.rotation.z).multiply(BABYLON.Matrix.Translation(i.position.x,i.position.y,i.position.z));var a=p.multiply(o).multiply(s);p.multiply(o);for(let t=0;t<i.vertices.length;t++){var c=this.project(i.vertices[t],a);i.projected_vertices[t]=c}var h=i.lines,u=i.projected_vertices;let e=!0;for(let t=0;t<h.length;t++){var d=h[t];d!=Flynn.PEN_UP?d>=Flynn.PEN_COLOR0?(r.push(Flynn.PEN_COMMAND),r.push(Flynn.PEN_UP),e=!0):(l&&(l=!1,r.push(Flynn.PEN_COMMAND),r.push(Flynn.PEN_UP)),d=u[d],r.push(d.x),r.push(d.y)):(r.push(Flynn.PEN_COMMAND),r.push(Flynn.PEN_UP),e=!0)}}return new Flynn.Polygon(r,Flynn.Colors.WHITE,1,new Victor(0,0),!1,!1)}})}(),function(){"use strict";Flynn.VectorMode={PLAIN:0,V_THIN:1,V_THICK:2},void 0===Flynn.Config&&(Flynn.Config={}),Flynn.Config.MAX_PACE_RECOVERY_TICKS=5,Flynn.Config.VectorRender={PLAIN:{lineBrightness:0,vertexBrightness:0,lineSize:1,vertexSize:1},V_THIN:{lineBrightness:-.15,vertexBrightness:.6,lineSize:1,vertexSize:1},V_THICK:{lineBrightness:-.15,vertexBrightness:.4,lineSize:2,vertexSize:2}},Flynn.Canvas=Class.extend({init:function(t,e,n,i){this.showMetrics=!1,this.canvas=void 0===n?document.getElementById("gameCanvas"):n,this.canvas.style.backgroundColor=void 0===i?"#000":i,this.canvas.width=t,this.canvas.height=e,this.previousTimestamp=0,this.constrained=!1,this.devLowFpsElapsedTicks=0,this.devLowFpsFrameCount=0;t-=131;this.gaugeFps=new Flynn.Gauge(new Victor(t,e-80),120,60,1,10,Flynn.Colors.YELLOW,"FPS"),this.gaugeGameLogicTime=new Flynn.Gauge(new Victor(t,100),120,34,2,16.6,Flynn.Colors.DODGERBLUE,"Input/Update/Render"),this.gaugeGameLogicTime.moveTo(new Victor(t,this.gaugeFps.rect.top-this.gaugeGameLogicTime.rect.height-8)),this.gaugePixiTime=new Flynn.Gauge(new Victor(t,this.gaugeGameLogicTime.rect.top-93),120,34,2,16.6,Flynn.Colors.CYAN,"Pixi"),this.gaugePixiTime.moveTo(new Victor(t,this.gaugeGameLogicTime.rect.top-this.gaugePixiTime.rect.height-8)),this.gaugeTotalAnimation=new Flynn.Gauge(new Victor(t,this.gaugePixiTime.rect.top-93),120,34,2,16.6,Flynn.Colors.MAGENTA,"Animation"),this.gaugeTotalAnimation.moveTo(new Victor(t,this.gaugePixiTime.rect.top-this.gaugeTotalAnimation.rect.height-8)),(self=this).ctx=function(t){const d={};let e="WebGL";return PIXI.utils.isWebGLSupported()||(e="canvas"),PIXI.utils.sayHello(e),d.renderer=PIXI.autoDetectRenderer({width:Flynn.mcp.canvasWidth,height:Flynn.mcp.canvasHeight,view:t,antialias:!0}),PIXI.settings.SPRITE_MAX_TEXTURES=Math.min(PIXI.settings.SPRITE_MAX_TEXTURES,16),PIXI.settings.PRECISION_FRAGMENT=PIXI.PRECISION.HIGH,d.renderer.backgroundColor=0,d.stage=new PIXI.Container,d.graphics=new PIXI.Graphics,d.stage.addChild(d.graphics),d.clearAll_deprecation_error_reported=!1,d.vectorText_deprecation_error_reported=!1,d.vectorTextArc_deprecation_error_reported=!1,d.width=t.width,d.height=t.height,d.fps=0,d.fpsFrameAverage=10,d.fpsFrameCount=0,d.fpsMsecCount=0,d.ticks=0,d.is_world=!1,d.lineSize=1,d.vertexSize=1,d.MAX_VERTICIES_x2=200,d.vector_vertices=new Array(d.MAX_VERTICIES_x2),d.index_vector_vertex=0,d.ACODE="A".charCodeAt(0),d.ZEROCODE="0".charCodeAt(0),d.SPACECODE=" ".charCodeAt(0),d.EXCLAMATIONCODE="!".charCodeAt(0),d.ACCENTCODE="`".charCodeAt(0),d.LOWERCASE_A="a".charCodeAt(0),d.LOWERCASE_Z="z".charCodeAt(0),d.TILDE="~".charCodeAt(0),d.UPPER_TO_LOWER=32,d.world_wrap_enabled=!1,d.world_bounds=null,d.world_wrap_offset_x=0,d.world_wrap_offset_y=0,d.drawPolygon=function(t,e,n){throw"drawPolygon() is obsolete. Use polygon's .render() method."},d.drawFpsGague=function(t,e,n){if(4==arguments.length)throw"drawFpsGague(): API has changed.";t=t.clone().addScalar(.5);this.beginPath();n*=60;this.strokeStyle=Flynn.Colors.GRAY,d.fillStyle="#FFFFFF",d.rect(t.x,t.y,60,6),d.fillStyle=e,d.fillRect(t.x,t.y,n,6),this.stroke()},d.vectorStart=function(t,e,n,i){this.is_world=void 0!==e&&e,this.constrained=void 0!==n&&n,i=null==i?1:i,9==t.length&&(i=i*parseInt(t.substring(7),16)/255,t=t.substring(0,7));let o;switch(Flynn.mcp.options.vectorMode){case Flynn.VectorMode.PLAIN:o=Flynn.Config.VectorRender.PLAIN;break;case Flynn.VectorMode.V_THIN:o=Flynn.Config.VectorRender.V_THIN;break;case Flynn.VectorMode.V_THICK:o=Flynn.Config.VectorRender.V_THICK}n=Flynn.Util.shadeColor(t,o.lineBrightness);this.vectorVertexColor=Flynn.Util.colorOverdrive(t,o.vertexBrightness),this.vectorVertexAlpha=.7*i,this.index_vector_vertex=0,this.lineSize=o.lineSize,this.vertexSize=o.vertexSize,this.graphics.lineStyle(o.lineSize,Flynn.Util.parseColor(n,!0),i)},d.vectorLineToUnconstrained=function(t,e){throw"vectorLineToUnconstrained() deprecated.  Pass constrained to vectorStart()."},d.vectorMoveToUnconstrained=function(t,e){throw"vectorMoveToUnconstrained() deprecated.  Pass constrained to vectorStart()."},d.vectorLineTo=function(t,e){var n;this.constrained&&(t=Math.floor(t),e=Math.floor(e)),this.is_world&&(t=(n=this.worldToScreen(t,e,!0)).x,e=n.y),this.index_vector_vertex<d.MAX_VERTICIES_x2&&(this.vector_vertices[this.index_vector_vertex++]=t,this.vector_vertices[this.index_vector_vertex++]=e),this.graphics.lineTo(t+.5,e+.5),this.graphics.moveTo(t+.5,e+.5)},d.vectorMoveTo=function(t,e){var n;this.constrained&&(t=Math.floor(t),e=Math.floor(e)),this.is_world&&(t=(n=this.worldToScreen(t,e,!1)).x,e=n.y),this.index_vector_vertex<d.MAX_VERTICIES_x2&&(this.vector_vertices[this.index_vector_vertex++]=t,this.vector_vertices[this.index_vector_vertex++]=e),this.graphics.moveTo(t+.5,e+.5)},d.vectorEnd=function(){var e=this.vertexSize/2;this.graphics.lineStyle(),this.graphics.beginFill(Flynn.Util.parseColor(this.vectorVertexColor,!0),this.vectorVertexAlpha);for(let t=0;t<this.index_vector_vertex;t+=2)this.graphics.drawRect(this.vector_vertices[t]-e+.5,this.vector_vertices[t+1]-e+.5,this.vertexSize,this.vertexSize);this.graphics.endFill()},d.worldToScreen=function(t,e,n){if(t=(t-Flynn.mcp.viewport.x)*Flynn.mcp.viewportZoom,e=(e-Flynn.mcp.viewport.y)*Flynn.mcp.viewportZoom,!this.world_wrap_enabled)return new Victor(t,e);return n||(t<-40?this.world_wrap_offset_x=this.world_bounds.width*Flynn.mcp.viewportZoom:t>this.width+40?this.world_wrap_offset_x=-this.world_bounds.width*Flynn.mcp.viewportZoom:this.world_wrap_offset_x=0,e<-40?this.world_wrap_offset_y=this.world_bounds.height*Flynn.mcp.viewportZoom:e>this.height+40?this.world_wrap_offset_y=-this.world_bounds.height*Flynn.mcp.viewportZoom:this.world_wrap_offset_y=0),new Victor(t+this.world_wrap_offset_x,e+this.world_wrap_offset_y)},d.fillRect=function(t,e,n,i,o){null==o&&(o=1),this.graphics.lineStyle(),this.graphics.beginFill(Flynn.Util.parseColor(d.fillStyle,!0),o),this.graphics.drawRect(t,e,n,i),this.graphics.endFill()},d.vectorRectR=function(t,e,n,i){this.vectorRect(t.left,t.top,t.width,t.height,e,n,i)},d.vectorRect=function(t,e,n,i,o,s,r,l){void 0!==s&&s&&(this.fillStyle=s,this.fillRect(t,e,n,i)),r=null!=r&&r,l=null==l?1:l,this.vectorStart(o,r,!1,l),this.vectorMoveTo(t,e),this.vectorLineTo(t+n-1,e),this.vectorLineTo(t+n-1,e+i-1),this.vectorLineTo(t,e+i-1),this.vectorLineTo(t,e),this.vectorEnd()},d.vectorLine=function(t,e,n,i,o,s,r){void 0===s&&(s=!1),r=null==r?1:r,this.vectorStart(o,s,!1,r),this.vectorMoveTo(t,e),this.vectorLineTo(n,i),this.vectorEnd()},d.charToPolygon=function(t,e){let n;return t>=this.EXCLAMATIONCODE&&t<=this.TILDE?(Flynn.mcp.forceUpperCase&&t>=this.LOWERCASE_A&&t<=this.LOWERCASE_Z&&(t-=this.UPPER_TO_LOWER),n=e.Points.ASCII[t-this.EXCLAMATIONCODE],null==n&&(n=e.Points.UNIMPLEMENTED_CHAR)):n=e.Points.UNIMPLEMENTED_CHAR,n},d.vectorCircle=function(t,e,n,i,o,s){let r;for(this.vectorStart(o,s),r=0;r<=2*Math.PI+.001;r+=2*Math.PI/i)0===r?this.vectorMoveTo(t+n,e):this.vectorLineTo(t+Math.cos(r)*n,e+Math.sin(r)*n);this.vectorEnd()},d.vectorText2=function(e){(e=e||{}).text=Flynn.Util.defaultText(e.text,"<TEXT>"),e.scale=e.scale||1,e.x=Flynn.Util.defaultArg(e.x,null),e.y=Flynn.Util.defaultArg(e.y,null),e.justify=e.justify||"left",e.color=e.color||Flynn.Colors.WHITE,e.is_world=e.is_world||!1,e.font=e.font||Flynn.Font.Normal,e.angle=Flynn.Util.defaultArg(e.angle,null),e.aspect_ratio=e.aspect_ratio||1,e.spacing=e.spacing||1,e.transform_f=e.transform_f||null,null==e.is_constrained&&(null==e.angle?e.is_constrained=!0:e.is_constrained=!1),e.text=String(e.text);let t,n,i,o,s,r,l,a=e.x,c=e.y,h=0,u=0;var d=e.scale*e.font.CharacterSpacing*e.spacing;if(null==e.angle){switch(null==a&&(a=Math.round((this.width-(e.text.length*d-e.font.CharacterGap*e.scale))/2)),null==c&&(c=Math.round((this.height-d)/2)),e.justify){case"right":h-=d*e.text.length-e.scale*e.font.CharacterGap;break;case"center":h-=d*e.text.length/2-e.scale*e.font.CharacterGap/2;break;case"left":case null:break;default:throw'opts.justify must be one of null, "left", "right", or "center".'}for(t=0,n=e.text.length;t<n;t++)if(s=e.text.charCodeAt(t),s!==this.SPACECODE){for(r=this.charToPolygon(s,e.font),l=!1,this.vectorStart(e.color,e.is_world,e.is_constrained),i=0,o=r.length;i<o;i+=2)if(r[i]==Flynn.PEN_COMMAND)l=!0;else{let t=new Victor(r[i]*e.scale+h,r[i+1]/e.aspect_ratio*e.scale+u);null!==e.transform_f&&(t=e.transform_f(t)),0===i||l?(this.vectorMoveTo(t.x+a,t.y+c),l=!1):this.vectorLineTo(t.x+a,t.y+c)}this.vectorEnd(),h+=d}else h+=d}else{null==h&&(h=Math.round(this.width)),null==u&&(u=Math.round(this.height));const p=new Victor(h,u),_=new Victor(1,0).rotate(e.angle),y=new Victor(0,1).rotate(e.angle),g=new Victor(-(e.text.length*d-e.font.CharacterGap*e.scale)/2,-(e.scale/e.aspect_ratio*e.font.CharacterHeight)/2);for(g.rotate(e.angle),p.add(g),t=0,n=e.text.length;t<n;t++)if(s=e.text.charCodeAt(t),s!==this.SPACECODE){for(r=this.charToPolygon(s,e.font),l=!1,this.vectorStart(e.color,e.is_world,e.is_constrained),i=0,o=r.length;i<o;i+=2)if(r[i]==Flynn.PEN_COMMAND)l=!0;else{let t=p.clone();t.add(_.clone().multiplyScalar(r[i]*e.scale)),t.add(y.clone().multiplyScalar(r[i+1]*e.scale/e.aspect_ratio)),null!==e.transform_f&&(t=e.transform_f(t)),0===i||l?(this.vectorMoveTo(t.x+a,t.y+c),l=!1):this.vectorLineTo(t.x+a,t.y+c)}this.vectorEnd(),p.add(_.clone().multiplyScalar(e.scale*e.font.CharacterSpacing))}else p.add(_.clone().multiplyScalar(e.scale*e.font.CharacterSpacing))}},d.vectorText=function(t,e,n,i,o,s,r,l,a,c){this.vectorText_deprecation_error_reported||(this.vectorText_deprecation_error_reported=!0,console.error("ctx.vectorText() has been deprecated. Use ctx.vectortText2() instead.")),d.vectorText2({text:t,scale:e,x:n,y:i,justify:o,color:s,is_world:r,font:l,angle:a,aspect_ratio:c})},d.vectorTextArc2=function(i){(i=i||{}).text=Flynn.Util.defaultText(i.text,"<TEXT>"),i.scale=i.scale||1,i.center_x=i.center_x||this.width/2,i.center_y=i.center_y||this.height/2,i.angle=i.angle||0,i.radius=i.radius||100,i.color=i.color||Flynn.Colors.WHITE,i.is_centered=Flynn.Util.defaultTrue(i.is_centered),i.is_reversed=i.is_reversed||!1,i.is_world=i.is_world||!1,i.font=i.font||Flynn.Font.Normal,i.stretch=i.stretch||null;let o,s;const n=String(i.text);let r=i.angle,l=Math.asin(i.font.CharacterSpacing*i.scale/i.radius);i.stretch&&(l*=1.4);let t=0;i.is_centered&&(t=l*(n.length/2-.5),i.is_reversed&&(t=-t)),r-=t;let a=r+Math.PI/2;i.is_reversed&&(a+=Math.PI,l=-l);for(let t=0,e=n.length;t<e;t++){this.vectorStart(i.color,i.is_world,!1);var c=n.charCodeAt(t);if(c!==this.SPACECODE){var h=this.charToPolygon(c,i.font);let e=!1;for(let n=0,t=h.length;n<t;n+=2)if(h[n]==Flynn.PEN_COMMAND)e=!0;else{if(i.stretch){let t=1;i.is_reversed&&(t=-t);let e=h[n+1];i.is_reversed||(e=i.font.CharacterHeight-e);var u=Flynn.Util.logish(e,0,i.font.CharacterHeight,1.2),d=i.radius+(u-i.font.CharacterHeight/2)*i.scale*i.stretch,p=r+t*(h[n]-i.font.CharacterWidth/2)*i.font.CharacterSpacing*i.scale/(i.font.CharacterWidth*i.radius);o=Math.cos(p)*d+i.center_x,s=Math.sin(p)*d+i.center_y}else{var _=h[n]-i.font.CharacterWidth/2,u=h[n+1]-i.font.CharacterHeight/2,p=Math.cos(a),d=Math.sin(a);o=(p*_-d*u)*i.scale+Math.cos(r)*i.radius+i.center_x,s=(d*_+p*u)*i.scale+Math.sin(r)*i.radius+i.center_y}0===n||e?(this.vectorMoveTo(o,s),e=!1):this.vectorLineTo(o,s)}this.vectorEnd(),r+=l,a+=l}else r+=l,a+=l}},d.vectorTextArc=function(t,e,n,i,o,s,r,l,a,c,h,u){this.vectorTextArc_deprecation_error_reported||(this.vectorTextArc_deprecation_error_reported=!0,console.error("ctx.vectorTextArc() has been deprecated. Use ctx.vectortTextArc2() instead.")),d.vectorTextArc2({text:t,scale:e,center_x:n,center_y:i,angle:o,radius:s,color:r,is_centered:l,is_reversed:a,is_world:c,font:h,is_stretched:u})},d.clearAll=function(){this.clearAll_deprecation_error_reported||(this.clearAll_deprecation_error_reported=!0,console.error("ctx.clearAll() has been deprecated and should not be called."))},d}(this.canvas),this.ctx.strokeStyle=Flynn.Colors.WHITE},animate:function(a){const c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)};var h=this;let u=function(n){let t,i;i=Flynn.mcp.browserSupportsPerformance?(t=performance.now(),performance):(t=n,Flynn.PerformanceNull);var e=t-h.previousTimestamp;h.ctx.fpsMsecCount+=e;let o=60*(t-h.previousTimestamp)/1e3;o>Flynn.Config.MAX_PACE_RECOVERY_TICKS&&(o=1),o*=Flynn.mcp.gameSpeedFactor,h.ctx.ticks+=1,++h.ctx.fpsFrameCount,h.ctx.fpsFrameCount>=h.ctx.fpsFrameAverage&&(h.ctx.fpsFrameCount=0,h.ctx.fps=Math.round(1e3/(h.ctx.fpsMsecCount/h.ctx.fpsFrameAverage)),h.ctx.fpsMsecCount=0),h.previousTimestamp=t;let s="",r=!1;switch(Flynn.mcp.devPacingMode){case Flynn.DevPacingMode.NORMAL:h.gaugeFps.record(1e3/e);break;case Flynn.DevPacingMode.SLOW_MO:o*=.2,s="SLOW_MO",h.gaugeFps.record(1e3/e);break;case Flynn.DevPacingMode.FPS_20:++h.devLowFpsFrameCount,h.devLowFpsElapsedTicks+=o,3===h.devLowFpsFrameCount?(h.devLowFpsFrameCount=0,o=h.devLowFpsElapsedTicks,h.devLowFpsElapsedTicks=0,h.gaugeFps.record(60/o)):r=!0,s="FPS_20"}if(!r){var n=0,l=i.now();h.ctx.stage.removeChildren(),h.ctx.graphics.clear(),h.ctx.stage.addChild(h.ctx.graphics),a(o),s&&h.ctx.vectorText2({text:s,scale:1.5,x:10,y:h.canvas.height-20,color:Flynn.Colors.RED}),h.showMetrics&&(h.gaugeFps.render(h.ctx),h.gaugeGameLogicTime.render(h.ctx),h.gaugePixiTime.render(h.ctx),h.gaugeTotalAnimation.render(h.ctx)),n=i.now(),h.gaugeGameLogicTime.record(n-l);let t,e;t=i.now(),h.ctx.renderer.render(h.ctx.stage),e=i.now(),h.gaugePixiTime.record(e-t),h.gaugeTotalAnimation.record(n-l+e-t)}Flynn.mcp.halted||c(u,h.canvas)};c(u,this.canvas)}}),Flynn.PerformanceNull={now:function(){return 0}}}(),function(){"use strict";Flynn.Gauge=Class.extend({PAD:6,init:function(t,e,n,i,o,s,r){let l,a,c;for(this.position=t,this.num_samples=e,this.range=n,this.scale=i,this.tick_interval=o,this.color_number=Flynn.Util.parseColor(s,!0),this.title=r,this.text_items=[],c=n*i+2*this.PAD,a=e+2,this.rect=new Flynn.Rect(t.x,t.y,a,c),this.samples=[],l=0;l<e;l++)this.samples.push(0);this._buildText()},_buildText:function(){let t;this.text_items=[],t=new PIXI.Text(this.title,{fontFamily:"Arial",fontSize:10,fill:"#fff",fontWeight:"bold"}),t.alpha=.3,t.anchor.set(.5,.5),t.position.set(this.rect.left+this.rect.width/2+.5,this.rect.top+this.rect.height-this.PAD-6+.5),this.text_items.push(t);let e,n,i;for(n=this.rect.left+5,i=0;i<=this.range;i+=this.tick_interval)e=this.rect.top+this.rect.height-this.PAD-i*this.scale,t=new PIXI.Text(i.toString(),{fontFamily:"Arial",fontSize:10,fill:"#aaa",fontWeight:"bold"}),t.anchor.set(0,.5),t.position.set(n,e),this.text_items.push(t)},moveTo:function(t){this.rect.moveTo(t),this._buildText()},record:function(t){this.samples.shift(),this.samples.push(t)},render:function(t){const e=t.graphics;let n,i,o,s;for(e.lineStyle(1,13421772,1),e.beginFill(112),e.drawRect(this.rect.left+.5,this.rect.top+.5,this.rect.width,this.rect.height),e.endFill(),e.lineStyle(1,5592405,1),s=0;s<=this.range;s+=this.tick_interval)n=this.rect.top+this.rect.height-this.PAD-s*this.scale,e.moveTo(this.rect.left+1,n),e.lineTo(this.rect.left+this.rect.width-1,n);for(e.lineStyle(),e.beginFill(this.color_number),o=0;o<this.samples.length;o++)i=this.rect.left+1+o,n=this.rect.top+this.rect.height-this.PAD-this.samples[o]*this.scale,n>this.rect.top+1&&e.drawRect(i,n,2,2);for(e.endFill(),o=0;o<this.text_items.length;o++)t.stage.addChild(this.text_items[o])}})}(),function(){"use strict";Flynn.BUTTON_CONFIGURABLE=!0,Flynn.BUTTON_NOT_CONFIGURABLE=!1,Flynn.TouchRegion=Class.extend({init:function(t,e,n,i,o,s,r){if("round"!=s&&"rect"!=s)throw"Parameter 'shape' must be 'round' or 'rect'";if(this.name=t,this.left=e,this.top=n,this.right=i,this.bottom=o,this.center_x=(this.right+this.left)/2,this.center_y=(this.top+this.bottom)/2,this.shape=s,this.visible_states=r,"round"==s){if(3<Math.abs(this.right-this.left-(this.bottom-this.top)))throw"Round touch regions must have matching width and height";this.radius=(this.right-this.left)/2}else this.radius=null;this.show=!1,this.touchStartIdentifier=0},updateVisibility:function(t){let e,n;if(this.visible_states){for(e=0,n=this.visible_states.length;e<n;e++)if(t==this.visible_states[e])return void(this.show=!0);this.show=!1}else this.show=!0}}),Flynn.VirtualButton=Class.extend({init:function(t,e){this.name=t,this.isConfigurable=e,this.isDown=!1,this.pressWasReported=!1,this.boundKeyCode=null}}),Flynn.InputHandler=Class.extend({MOUSE_IDENTIFIER:99999991,DIRECTIONS:["up","down","left","right"],init:function(){this.iCadeModeEnabled=!1,this.virtualButtons={},this.touchRegions={},this.keyCodeToVirtualButtonName={},this.uiButtons={},this.keyCodeToUiButtonName={},this.virtualJoysticks={},this.text_capture_enabled=!1,this.captured_text="",this.keyCodeCaptureArmed=!1,this.capturedKeyCode=null,this.iCade={keyDownCodes:[],keyUpCodes:[],buttonNames:[],buttonCodes:[]},this.addiCadeMapping("icade_up","w","e"),this.addiCadeMapping("icade_down","x","z"),this.addiCadeMapping("icade_left","a","q"),this.addiCadeMapping("icade_right","d","c"),this.addiCadeMapping("icade_t1","y","t"),this.addiCadeMapping("icade_t2","u","f"),this.addiCadeMapping("icade_t3","i","m"),this.addiCadeMapping("icade_t4","o","g"),this.addiCadeMapping("icade_b1","h","r"),this.addiCadeMapping("icade_b2","j","n"),this.addiCadeMapping("icade_b3","k","p"),this.addiCadeMapping("icade_b4","l","v"),this.touchable_elements=[],this._touch_location_v=null;var l=this;if(this.keyDownHandler=function(n){if(n.keyCode!=Flynn.KeyboardMap.escape&&n.keyCode!=Flynn.KeyboardMap.tab||n.preventDefault(),l.iCadeModeEnabled){let t=l.iCade.keyDownCodes.indexOf(n.keyCode),e;if(-1<t)return e={keyCode:l.iCade.buttonCodes[t]},void l.keyDownHandler(e);if(t=l.iCade.keyUpCodes.indexOf(n.keyCode),-1<t)return e={keyCode:l.iCade.buttonCodes[t]},void l.keyUpHandler(e)}if(l.keyCodeCaptureArmed&&n.keyCode!=Flynn.KeyboardMap.escape)return l.capturedKeyCode=n.keyCode,void(l.keyCodeCaptureArmed=!1);if(!l.text_capture_enabled){let t;l.keyCodeToVirtualButtonName[n.keyCode]&&(t=l.keyCodeToVirtualButtonName[n.keyCode],l.virtualButtons[t].isDown=!0),l.keyCodeToUiButtonName[n.keyCode]&&(t=l.keyCodeToUiButtonName[n.keyCode],l.uiButtons[t].isDown=!0)}},document.addEventListener("keydown",this.keyDownHandler),this.keyUpHandler=function(t){let e;l.keyCodeToVirtualButtonName[t.keyCode]&&(e=l.keyCodeToVirtualButtonName[t.keyCode],l.virtualButtons[e].isDown=!1,l.virtualButtons[e].pressWasReported=!1),l.keyCodeToUiButtonName[t.keyCode]&&(e=l.keyCodeToUiButtonName[t.keyCode],l.uiButtons[e].isDown=!1,l.uiButtons[e].pressWasReported=!1)},document.addEventListener("keyup",this.keyUpHandler),this.keyPressHandler=function(t){l.text_capture_enabled&&l.processTextCapture(t.keyCode)},document.addEventListener("keydown",this.keyPressHandler),Flynn.mcp.mousetouchEnabled||Flynn.mcp.developerModeEnabled)try{document.addEventListener("mousedown",function(t){if(Flynn.mcp.halted&&Flynn.mcp.devResume(),Flynn.mcp.mousetouchEnabled){const i=Flynn.mcp.touch_control_canvas.canvas;var e=i.getBoundingClientRect(),n=(t.clientX-e.left)*i.width/i.clientWidth,e=(t.clientY-e.top)*i.height/i.clientHeight;l.handleTouchStart(n,e,l.MOUSE_IDENTIFIER)?t.preventDefault():console.log("mousedown not caught")}},!1)}catch(t){console.log('Warning: Could not register "mousedown" event.')}if(Flynn.mcp.mousetouchEnabled){try{document.addEventListener("mouseup",function(t){const e=Flynn.mcp.touch_control_canvas.canvas;var n=e.getBoundingClientRect(),i=(t.clientX-n.left)*e.width/e.clientWidth,n=(t.clientY-n.top)*e.height/e.clientHeight;l.handleTouchEnd(i,n,l.MOUSE_IDENTIFIER)?t.preventDefault():console.log("mouseup not caught")},!1)}catch(t){console.log('Warning: Could not register "mouseup" event.')}try{document.addEventListener("mousemove",function(t){if(t.preventDefault(),t.which){const i=Flynn.mcp.touch_control_canvas.canvas;var e=i.getBoundingClientRect(),n=(t.clientX-e.left)*i.width/i.clientWidth,e=(t.clientY-e.top)*i.height/i.clientHeight;l.handleTouchMove(n,e,l.MOUSE_IDENTIFIER)}},!1)}catch(t){console.log('Warning: Could not register "mousemove" event.')}}try{document.addEventListener("touchstart",function(t){let e,n=!1;for(e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];const r=Flynn.mcp.touch_control_canvas.canvas;var o=r.getBoundingClientRect(),s=(i.pageX-o.left)*r.width/r.clientWidth,o=(i.pageY-o.top)*r.height/r.clientHeight;n|=l.handleTouchStart(s,o,i.identifier)}n&&t.preventDefault()},!1)}catch(t){console.log('Warning: Could not register "touchstart" event.')}try{document.addEventListener("touchend",function(t){let e,n=!1;for(e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];const r=Flynn.mcp.touch_control_canvas.canvas;var o=r.getBoundingClientRect(),s=(i.pageX-o.left)*r.width/r.clientWidth,o=(i.pageY-o.top)*r.height/r.clientHeight;n|=l.handleTouchEnd(s,o,i.identifier)}n&&t.preventDefault()},!1)}catch(t){console.log('Warning: Could not register "touchend" event.')}try{document.addEventListener("touchmove",function(t){t.preventDefault();var e=t.changedTouches[0];const n=Flynn.mcp.touch_control_canvas.canvas;var i=n.getBoundingClientRect(),t=(e.pageX-i.left)*n.width/n.clientWidth,i=(e.pageY-i.top)*n.height/n.clientHeight;console.log("DEV: touchmove ",t,i),l.handleTouchMove(t,i,e.identifier)},!1)}catch(t){console.log('Warning: Could not register "touchend" event.')}window.onfocus=function(){let t;for(t in l.virtualButtons)l.virtualButtons[t].isDown&&(l.virtualButtons[t].isDown=!1,console.log('Flynn: Forcing virtual button "'+t+'" up because focus was restored to this app.'));for(t in l.uiButtons)l.uiButtons[t].isDown&&(l.uiButtons[t].isDown=!1,console.log('Flynn: Forcing UI button "'+t+'" up because focus was restored to this app.'))}},startTextCapture:function(t){t=null==t?"":t,this.text_capture_enabled=!0,this.captured_text=t},getTextCapture:function(){return this.captured_text},setTextCapture:function(t){this.captured_text=t},isTextCaptureDone:function(){return!this.text_capture_enabled},processTextCapture:function(t){13==t?this.text_capture_enabled=!1:t==Flynn.KeyboardMap.delete&&0<this.captured_text.length?this.captured_text=this.captured_text.substring(0,this.captured_text.length-1):(32==t||48<=t&&t<=57||65<=t&&t<=90||97<=t&&t<=122)&&(this.captured_text+=String.fromCharCode(t))},addTouchableElement:function(t){this.touchable_elements.push(t)},getLastTouchLocation:function(t){let e;return null==t&&(t=!0),e=null==this._touch_location_v?null:this._touch_location_v.clone(),t&&(this._touch_location_v=null),e},handleTouchStart:function(t,e,n){this._touch_location_v=new Victor(t,e);let i,o,s,r,l;for(i in l=!1,this.touchRegions)o=this.touchRegions[i],o.show&&(r="round"==o.shape?Math.pow(t-o.center_x,2)+Math.pow(e-o.center_y,2)<Math.pow(o.radius,2):t>o.left&&t<o.right&&e>o.top&&e<o.bottom,r&&(this.virtualButtons[i]?this.virtualButtons[i].isDown=!0:this.uiButtons[i]?this.uiButtons[i].isDown=!0:console.log('Flynn: Warning: touch detected in touch region "'+i+'" but no virtual button exists with that name.  The touch will go unreported.'),o.touchStartIdentifier=n,l=!0));for(i in this.virtualJoysticks)s=this.virtualJoysticks[i],l|=s.handleTouchStart(t,e,n),this.setButtonsFromJoystick(s);return l},handleTouchEnd:function(t,e,n){let i,o,s,r,l,a;for(i in a=!1,this.touchRegions)o=this.touchRegions[i],o.touchStartIdentifier==n&&(this.virtualButtons[i]?(this.virtualButtons[i].isDown=!1,this.virtualButtons[i].pressWasReported=!1):this.uiButtons[i]&&(this.uiButtons[i].isDown=!1,this.uiButtons[i].pressWasReported=!1),o.touchStartIdentifier=0,a=!0);for(i in this.virtualJoysticks)if(s=this.virtualJoysticks[i],s.handleTouchEnd(t,e,n)){for(l=0;l<this.DIRECTIONS.length;l++)r=this.DIRECTIONS[l],i=s.buttons[r].name,i&&(this.virtualButtons[i]?this.virtualButtons[i].isDown=!1:this.uiButtons[i]&&(this.uiButtons[i].isDown=!1));a=!0}return a},handleTouchMove:function(t,e,n){let i,o;for(i in this.virtualJoysticks)o=this.virtualJoysticks[i],o.handleTouchMove(t,e,n),this.setButtonsFromJoystick(o)},setButtonsFromJoystick:function(t){let e,n,i;if(t.in_use)for(i=0;i<this.DIRECTIONS.length;i++)e=this.DIRECTIONS[i],n=t.buttons[e].name,n&&(this.virtualButtons[n]?this.virtualButtons[n].isDown=t.buttons[e].pressed:this.uiButtons[n]&&(this.uiButtons[n].isDown=t.buttons[e].pressed))},setupUIButtons:function(){this.iCadeModeEnabled?(this.addUiButton("UI_enter",Flynn.KeyboardMap.icade_t1),this.addUiButton("UI_escape",Flynn.KeyboardMap.icade_b1),this.addUiButton("UI_exit",Flynn.KeyboardMap.icade_b2),this.addUiButton("UI_quarter",Flynn.KeyboardMap.icade_t3),this.addUiButton("UI_start1",Flynn.KeyboardMap.icade_t4),this.addUiButton("UI_start2",Flynn.KeyboardMap.icade_b4),this.addUiButton("UI_up",Flynn.KeyboardMap.icade_up),this.addUiButton("UI_down",Flynn.KeyboardMap.icade_down),this.addUiButton("UI_right",Flynn.KeyboardMap.icade_right),this.addUiButton("UI_left",Flynn.KeyboardMap.icade_left)):(this.addUiButton("UI_enter",Flynn.KeyboardMap.enter),this.addUiButton("UI_escape",Flynn.KeyboardMap.escape),this.addUiButton("UI_exit",Flynn.KeyboardMap.tab),this.addUiButton("UI_quarter",Flynn.KeyboardMap.num_5),this.addUiButton("UI_start1",Flynn.KeyboardMap.num_1),this.addUiButton("UI_start2",Flynn.KeyboardMap.num_2),this.addUiButton("UI_up",Flynn.KeyboardMap.up),this.addUiButton("UI_down",Flynn.KeyboardMap.down),this.addUiButton("UI_right",Flynn.KeyboardMap.right),this.addUiButton("UI_left",Flynn.KeyboardMap.left),Flynn.mcp.developerModeEnabled&&this.addUiButton("UI_halt",Flynn.KeyboardMap.grave_accent))},enableICade:function(){this.iCadeModeEnabled=!0},addiCadeMapping:function(t,e,n){this.iCade.buttonNames.push(t),this.iCade.buttonCodes.push(Flynn.KeyboardMap[t]),this.iCade.keyDownCodes.push(Flynn.KeyboardMap[e]),this.iCade.keyUpCodes.push(Flynn.KeyboardMap[n])},addUiButton:function(t,e){this.uiButtons[t]&&(console.log('Flynn: Warning: addUiButton() was called for UI button  "'+t+'" but that UI button already exists. The old UI button will be removed first.'),delete this.uiButtons[t]),this.uiButtons[t]=new Flynn.VirtualButton(t,Flynn.BUTTON_NOT_CONFIGURABLE),this.uiButtons[t].boundKeyCode=e,this.keyCodeToUiButtonName[e]=t},addVirtualButton:function(t,e,n){this.virtualButtons[t]&&(console.log('Flynn: Warning: addVirtualButton() was called for virtual button  "'+t+'" but that virtual button already exists. The old virtual button will be removed first.'),delete this.virtualButtons[t]),this.virtualButtons[t]=new Flynn.VirtualButton(t,n),this.bindVirtualButtonToKey(t,e)},bindVirtualButtonToKey:function(t,e){void 0===e&&(console.log('Flynn: Warning: bindVirtualButtonToKey() was called for virtual button  "'+t+'" with keyCode "undefined". Assuming "null" instead, but this may indicate a mistake.'),e=null),this.virtualButtons[t]?(this.unbindVirtualButtonFromKey(t),(this.virtualButtons[t].boundKeyCode=e)&&(this.keyCodeToVirtualButtonName[e]=t)):console.log('Flynn: Warning: bindVirtualButtonToKey() was called for virtual button  "'+t+'", but that virtual button does not exist. Doing nothing.')},getConfigurableVirtualButtonNames:function(){const t=[];for(const e in this.virtualButtons)this.virtualButtons[e].isConfigurable&&t.push(e);return t},getVirtualButtonBoundKeyName:function(t){let e,n;return this.virtualButtons[t]?(e=this.virtualButtons[t].boundKeyCode,n=this.keyCodeToKeyName(e),n):this.uiButtons[t]?(e=this.uiButtons[t].boundKeyCode,n=this.keyCodeToKeyName(e),n):(console.log('Flynn: Warning: getVirtualButtonBoundKeyName() was called for virtual button  "'+t+'", but that virtual button does not exist.'),"ERROR")},getVirtualButtonBoundKeyCode:function(t){return this.virtualButtons[t]?this.virtualButtons[t].boundKeyCode:(console.log('Flynn: Warning: getVirtualButtonBoundKeyCode() was called for virtual button  "'+t+'", but that virtual button does not exist. Returning null.'),null)},keyCodeToKeyName:function(t){for(const e in Flynn.KeyboardMap)if(Flynn.KeyboardMap[e]===t)return e;return"(Unknown)"},unbindVirtualButtonFromKey:function(t){if(this.virtualButtons[t]){for(const e in this.keyCodeToVirtualButtonName)this.keyCodeToVirtualButtonName[e]===t&&delete this.keyCodeToVirtualButtonName[e];this.virtualButtons[t].boundKeyCode=null}else console.log('Flynn: Warning: unbindVirtualButtonFromKey() was called for virtual button  "'+t+'", but that virtual button does not exist. Doing nothing.')},addTouchRegion:function(t,e,n,i,o,s,r){void 0===s&&(s="rect"),t in this.touchRegions&&(console.log('Flynn: Info: addTouchRegion() was called for region  "'+t+'" and that touch region already exists. The old touch region will be removed first.'),delete this.touchRegions[t]);r=new Flynn.TouchRegion(t,e,n,i,o,s,r);this.touchRegions[t]=r,t in this.virtualButtons||t in this.uiButtons||console.log('Flynn: Warning: touch region name "'+t+'" does not match an existing virtual button name.  Touches to this region will be unreported unless (until) a virtual button with the same name is created.')},renderTouchRegions:function(t){let e,n;for(e in this.touchRegions)n=this.touchRegions[e],n.show&&("round"==n.shape?(t.graphics.lineStyle(2,16777215,.2),this.virtualButtonIsDown(e)?t.graphics.beginFill(16777215,.3):t.graphics.beginFill(16777215,.1),t.graphics.drawCircle((n.left+n.right)/2,(n.top+n.bottom)/2,(n.right-n.left)/2)):(t.graphics.lineStyle(2,16777215,.2),this.virtualButtonIsDown(e)?t.graphics.beginFill(16777215,.3):t.graphics.beginFill(16777215,.1),t.graphics.drawRect(n.left,n.top,n.right-n.left,n.bottom-n.top)),t.graphics.endFill())},virtualButtonIsDown:function(t){return this.virtualButtons[t]?this.virtualButtons[t].isDown:this.uiButtons[t]?this.uiButtons[t].isDown:void console.log('Flynn: Warning: isDown() was called for virtual button  "'+t+'" but no virtual button with that name exists.')},virtualButtonWasPressed:function(t){return this.virtualButtons[t]?!this.virtualButtons[t].pressWasReported&&(!!this.virtualButtons[t].isDown&&(this.virtualButtons[t].pressWasReported=!0)):this.uiButtons[t]?!this.uiButtons[t].pressWasReported&&(!!this.uiButtons[t].isDown&&(this.uiButtons[t].pressWasReported=!0)):void console.log('Flynn: Warning: isDown() was called for virtual button  "'+t+'" but no virtual button with that name exists.')},flushButtons:function(){for(const t of Object.values(this.virtualButtons))t.isDown&&(t.pressWasReported=!0);for(const e of Object.values(this.uiButtons))e.isDown&&(e.pressWasReported=!0)},armKeyCodeCapture:function(){this.keyCodeCaptureArmed=!0,this.capturedKeyCode=null},getCapturedKeyCode:function(){return this.capturedKeyCode},isKeyCodeAssigned:function(t){for(const e in this.virtualButtons)if(this.virtualButtons[e].boundKeyCode==t)return!0;return!1},addVirtualJoystick:function(t){t=t||{};t=new Flynn.VirtualJoystick(t);this.virtualJoysticks[t.name]&&(console.log('Flynn: Info: addVirtualJoystick() was called for virtual joystick  "'+t.name+'" and that virtual joystick already exists. The old virtual joystick will be removed first.'),delete this.virtualJoysticks[t.name]),this.virtualJoysticks[t.name]=t},getAnalogJoystickPosition:function(t){return this.virtualJoysticks[t]?this.virtualJoysticks[t].analog_pos:null},updateVisibilityAllControls:function(){let t;for(t in this.virtualJoysticks)this.virtualJoysticks[t].updateVisibility(Flynn.mcp.current_state_id);for(t in this.touchRegions)this.touchRegions[t].updateVisibility(Flynn.mcp.current_state_id)},renderVirtualJoysticks:function(t){let e;for(e in this.virtualJoysticks)this.virtualJoysticks[e].render(t)}})}(),function(){"use strict";Flynn.Leaderboard=Class.extend({init:function(t,e,n){this.attributeList=t,this.maxItems=e,this.sortDescending=n,this.leaderList=[],this.defaultLeaderList=[]},isEligible:function(t){let e=!0;0==Game.config.score&&(e=!1);var n=this.getWorstEntry(),t=!this.sortDescending&&t<n.score||this.sortDescending&&t>n.score,n=this.leaderList.length==this.maxItems;return!t&&n&&(e=!1),e},setDefaultList:function(t){this.defaultLeaderList=t},loadFromCookies:function(){this.leaderList=[];var t=document.title+(Flynn.mcp.developerModeEnabled?"_Develop":"")+":LeaderBoard",e=Cookies.get(t);e&&(this.leaderList=JSON.parse(e),Flynn.mcp.developerModeEnabled&&console.log("DEV: flynnLeaderboard: Fetched "+t+":"+this.leaderList)),0==this.leaderList.length&&(this.leaderList=this.defaultLeaderList),this.sortAndTruncate()},saveToCookies:function(){var t=document.title+(Flynn.mcp.developerModeEnabled?"_Develop":"")+":LeaderBoard",e=JSON.stringify(this.leaderList);Cookies.set(t,e,{expires:1/0}),Flynn.mcp.developerModeEnabled&&console.log("DEV: flynnLeaderboard: Saved "+t+":"+e)},add:function(t){this.leaderList.push(t),this.sortAndTruncate(),this.saveToCookies()},getBestEntry:function(){return this.leaderList[0]},getWorstEntry:function(){return this.leaderList[this.leaderList.length-1]},getLength:function(){return this.leaderList.length()},isFull:function(){return this.leaderList.length>=this.maxItems},sortAndTruncate:function(){this.sortDescending?this.leaderList.sort(function(t,e){return e.score-t.score}):this.leaderList.sort(function(t,e){return t.score-e.score});var t=this.leaderList.length-this.maxItems;0<t&&this.leaderList.splice(this.leaderList.length-t,t)},restoreDefaults:function(){this.leaderList=this.defaultLeaderList,this.sortAndTruncate(),this.saveToCookies()}})}(),function(){"use strict";Flynn.Mcp=Class.extend({init:function(t,e,n,i,o,s,r,l){(Flynn.mcp=this).canvasWidth=t,this.canvasHeight=e,this.noChangeState=n,this.gameSpeedFactor=i,this.stateBuilderFunc=o,this.hideCanvas=s,this.forceUpperCase=l,this.developerModeEnabled=Flynn.Util.getUrlFlag("develop"),this.arcadeModeEnabled=Flynn.Util.getUrlFlag("arcade"),this.iCadeModeEnabled=Flynn.Util.getUrlFlag("icade"),this.backEnabled=Flynn.Util.getUrlFlag("back"),this.mousetouchEnabled=Flynn.Util.getUrlFlag("mousetouch"),this.optionNoscale=Flynn.Util.getUrlFlag("noscale"),this.optionQuiethalt=Flynn.Util.getUrlFlag("quiethalt"),this.halted=!1,this.audio_mute_enabled=!1,this.credits=0,this.next_state_id=n,this.current_state_id=null,this.current_state=null,this.devPacingMode=Flynn.DevPacingMode.NORMAL,this.viewport={x:0,y:0},this.viewportZoom=1,this.resizeFunc=null,this.slowMoDebug=!1,this.clock=0,this.timers=new Flynn.Timers,this.options={},this.optionManager=new Flynn.OptionManager(this),this.custom={},this.canvas=new Flynn.Canvas(t,e),this.touch_control_canvas=this.canvas,this.input=new Flynn.InputHandler,this.iCadeModeEnabled&&(this.input.enableICade(),this.arcadeModeEnabled=!0),this.input.setupUIButtons(),this.flynn_logo=new Flynn.Polygon(Flynn.Points.FLYNN_LOGO,Flynn.Colors.DODGERBLUE,2,new Victor(Flynn.mcp.canvasWidth-55,Flynn.mcp.canvasHeight-41),!1,!1),this.browserSupportsPerformance=!0;try{performance.now()}catch(t){this.browserSupportsPerformance=!1}this.browserIsIos=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),this.browserSupportsTouch=Flynn.Util.is_mobile_or_tablet_browser()&&"ontouchstart"in document.documentElement||this.mousetouchEnabled,this.developerModeEnabled&&(console.log("DEV: title="+document.title),console.log("DEV: browserSupportsPeformance="+this.browserSupportsPerformance),console.log("DEV: browserIsIos="+this.browserIsIos),console.log("DEV: browserSupportsTouch="+this.browserSupportsTouch),console.log("DEV: Cookies: enabled="+Cookies.enabled),console.log("DEV: arcadeModeEnabled="+this.arcadeModeEnabled),console.log("DEV: iCadeModeEnabled="+this.iCadeModeEnabled),console.log("DEV: backEnabled="+this.backEnabled),console.log("DEV: optionNoscale="+this.optionNoscale));let a=null;var c=Flynn.Util.getUrlValue("vector");for(const u in Flynn.VectorMode)c===u&&(a=Flynn.VectorMode[u]);null===a&&(a=this.browserSupportsTouch?Flynn.VectorMode.V_THICK:Flynn.VectorMode.V_THIN),r||this.optionManager.addOption("vectorMode",Flynn.OptionType.MULTI,a,a,"VECTOR DISPLAY EMULATION",[["NONE",Flynn.VectorMode.PLAIN],["NORMAL",Flynn.VectorMode.V_THIN],["THICK",Flynn.VectorMode.V_THICK]],null);var h=this;this.resize=function(){var t={width:window.innerWidth,height:window.innerHeight},e=h.canvasWidth,n=h.canvasHeight,i=Math.min(t.height/n,t.width/e);let o,s;s=h.optionNoscale?(o=e,n):(o=Math.floor(e*i),Math.floor(n*i));n=Math.floor(t.height/2-s/2),i=Math.floor(t.width/2-o/2);const r=document.getElementById("gameCanvas");h.hideCanvas||(r.style.display="block"),r.style.width=o+"px",r.style.height=s+"px",r.style.top=n+"px",r.style.left=i+"px",h.resizeFunc&&h.resizeFunc(t.width,t.height),h.input.updateVisibilityAllControls()},window.addEventListener("resize",this.resize)},setViewport:function(t,e,n){this.viewport.x=t.x-e.x/n,this.viewport.y=t.y-e.y/n,this.viewportZoom=n},setTouchControlCanvas:function(t){this.touch_control_canvas=t},setResizeFunc:function(t){this.resizeFunc=t},changeState:function(t){this.next_state_id=t},muteAudio:function(t){this.audio_mute_enabled=t,Howler.mute(t)},devHalt:function(){const t=this.canvas.ctx;var e=this.canvasWidth-40,n=this.canvasHeight/2-30;this.halted=!0,console.log("DEV: Execution halted"),this.optionQuiethalt||(t.vectorRect(20,n,e,60,Flynn.Colors.CYAN,Flynn.Colors.BLACK),t.vectorText2({text:"MCP HALTED.  CLICK TO RESUME.",scale:4,color:Flynn.Colors.WHITE})),Howler.mute(!0)},devResume:function(){this.halted=!1,console.log("DEV: Execution resumed"),this.run(),Howler.mute(this.audio_mute_enabled)},cycleDevPacingMode:function(){switch(this.devPacingMode){case Flynn.DevPacingMode.NORMAL:this.devPacingMode=Flynn.DevPacingMode.SLOW_MO;break;case Flynn.DevPacingMode.SLOW_MO:this.devPacingMode=Flynn.DevPacingMode.FPS_20;break;case Flynn.DevPacingMode.FPS_20:this.devPacingMode=Flynn.DevPacingMode.NORMAL}},toggleDevPacingSlowMo:function(){this.devPacingMode===Flynn.DevPacingMode.SLOW_MO?this.devPacingMode=Flynn.DevPacingMode.NORMAL:this.devPacingMode=Flynn.DevPacingMode.SLOW_MO},toggleDevPacingFps20:function(){this.devPacingMode===Flynn.DevPacingMode.FPS_20?this.devPacingMode=Flynn.DevPacingMode.NORMAL:this.devPacingMode=Flynn.DevPacingMode.FPS_20},renderLogo:function(t,e){void 0!==e&&(this.flynn_logo.position=e),this.flynn_logo.render(t),t.vectorText2({text:Flynn.VERSION,scale:1.5,x:this.flynn_logo.position.x,y:this.flynn_logo.position.y+23,justify:"center",color:Flynn.Colors.GRAY})},run:function(){var e=this;this.canvas.animate(function(t){e.next_state_id!==e.noChangeState&&(e.current_state&&e.current_state.destructor&&e.current_state.destructor(),e.current_state=e.stateBuilderFunc(e.next_state_id),e.current_state_id=e.next_state_id,e.next_state_id=e.noChangeState,e.input.updateVisibilityAllControls()),e.clock+=t,e.timers.update(t),e.current_state&&(e.current_state.handleInputs(e.input,t),e.current_state.update(t),e.current_state.render(e.canvas.ctx),e.input.renderTouchRegions(e.touch_control_canvas.ctx),e.input.renderVirtualJoysticks(e.touch_control_canvas.ctx),e.developerModeEnabled&&e.input.virtualButtonWasPressed("UI_halt")&&e.devHalt())})}}),Flynn.devlog=function(t){Flynn.mcp.developerModeEnabled&&("string"==typeof t?console.log("DEV: "+t):console.log(t))}}(),function(){"use strict";Flynn.OptionType={BOOLEAN:0,MULTI:1,COMMAND:2,INPUT_KEY:3},Flynn.OptionDescriptor=Class.extend({init:function(t,e,n,i,o,s,r){this.keyName=t,this.type=e,this.defaultValue=n,this.currentValue=i,this.promptText=o,this.promptValues=s,this.commandHandler=r},currentPromptValueIndex:function(){for(let t=0,e=this.promptValues.length;t<e;t++)if(this.currentValue===this.promptValues[t][1])return t;return null}}),Flynn.OptionManager=Class.extend({SHADOWED_OPTION_TYPES:[Flynn.OptionType.MULTI,Flynn.OptionType.BOOLEAN],init:function(){this.optionDescriptors={},this.cookiesFetched=!1;var t=this;this.addOption("revertDefaults",Flynn.OptionType.COMMAND,!0,!0,"REVERT TO DEFAULTS",null,function(){t.revertToDefaults(),t.saveAllToCookies()})},addOption:function(t,e,n,i,o,s,r){r=new Flynn.OptionDescriptor(t,e,n,i,o,s,r);e in this.SHADOWED_OPTION_TYPES&&(Flynn.mcp.options[t]=i),this.optionDescriptors[t]=r},removeOption:function(t){delete Flynn.mcp.options[t],delete this.optionDescriptors[t]},addOptionFromVirtualButton:function(t){var e=Flynn.mcp.input.getVirtualButtonBoundKeyCode(t),t=t,e=new Flynn.OptionDescriptor(t,Flynn.OptionType.INPUT_KEY,e,e,t,null,null);this.optionDescriptors[t]=e},setOption:function(t,e){if(t in this.optionDescriptors){const n=this.optionDescriptors[t];n.currentValue=e,n.type in this.SHADOWED_OPTION_TYPES&&(Flynn.mcp.options[t]=e),n.type===Flynn.OptionType.INPUT_KEY&&Flynn.mcp.input.bindVirtualButtonToKey(t,e)}else console.print('DEV: Warning: FlynnOptionManager.setOption() called for key "'+t+'", which does not match an existing option.  Doing nothing.');this.cookiesFetched&&this.saveOptionToCookies(t)},setDefault:function(t,e){if(t in this.optionDescriptors){const n=this.optionDescriptors[t];n.defaultValue=e}else console.print('DEV: Warning: FlynnOptionManager.setOption() called for key "'+t+'", which does not match an existing option.  Doing nothing.')},getOption:function(t){return t in this.optionDescriptors?this.optionDescriptors[t].currentValue:(console.log('DEV: Warning: FlynnOptionManager.getOption() called for key "'+t+'", which does not match an existing option.  Returning null.'),null)},revertToDefaults:function(){for(const t in this.optionDescriptors){const e=this.optionDescriptors[t];e.currentValue!=e.defaultValue&&(e.currentValue=e.defaultValue,e.type in this.SHADOWED_OPTION_TYPES&&(Flynn.mcp.options[t]=e.defaultValue),e.type==Flynn.OptionType.INPUT_KEY&&this.setOption(e.keyName,e.currentValue),e.commandHandler&&e.commandHandler())}},loadFromCookies:function(){this.revertToDefaults();var n=this.getOptionKeyNames();for(let t=0,e=n.length;t<e;t++){var i=n[t],o=document.title+":OPT_"+i,s=Cookies.get(o);if(s)try{var r=JSON.parse(s);this.setOption(i,r),Flynn.mcp.developerModeEnabled&&console.log('DEV: flynnOptionManager: Fetched "'+i+'" = "'+r+'".')}catch(t){console.log('DEV: Could not parse attribute value "'+s+'" for cookie "'+o+'".')}}this.saveAllToCookies(),this.cookiesFetched=!0},saveAllToCookies:function(){var n=this.getOptionKeyNames();for(let t=0,e=n.length;t<e;t++){var i=n[t];this.saveOptionToCookies(i)}},saveOptionToCookies:function(t){var e,n,i;this.optionDescriptors[t].type!=Flynn.OptionType.COMMAND&&(e=document.title+":OPT_"+t,n=this.getOption(t),i=JSON.stringify(n),Cookies.set(e,i,{expires:1/0}),Flynn.mcp.developerModeEnabled&&console.log('DEV: flynnOptionManager: Saved "'+t+'" = "'+n+'".'))},executeCommand:function(t){t in this.optionDescriptors&&this.optionDescriptors[t].type===Flynn.OptionType.COMMAND?this.optionDescriptors[t].commandHandler():console.print('DEV: Warning: FlynnOptionManager.executeCommand() called for key "'+t+'", which does not exist or is not of type COMMAND.  Doing nothing.')},getOptionKeyNames:function(){const t=[],e=[],n=[],i=[];for(const o in this.optionDescriptors)switch(this.optionDescriptors[o].type){case Flynn.OptionType.INPUT_KEY:t.push(o);break;case Flynn.OptionType.COMMAND:e.push(o);break;case Flynn.OptionType.MULTI:n.push(o);break;case Flynn.OptionType.BOOLEAN:i.push(o)}return t.concat(n,i,e)}})}(),function(){"use strict";Flynn.Particle=Class.extend({PARTICLE_LIFE_VARIATION:20,PARTICLE_LIFE:50,PARTICLE_FRICTION:.99,init:function(t,e,n,i,o,s,r,l){this.life=void 0===o?this.PARTICLE_LIFE+(Math.random()-.5)*this.PARTICLE_LIFE_VARIATION:o,void 0===s?(this.length=null,this.angle=null,this.angular_velocity=null):(this.length=s,this.angle=r,this.angular_velocity=l),this.particles=t,this.position=e,this.velocity=n,this.color=i},update:function(t){let e=!0;return this.life-=t,this.life<=0?e=!1:(this.position.add(this.velocity.clone().multiplyScalar(t)),this.velocity.multiplyScalar(Math.pow(this.PARTICLE_FRICTION,t)),null!==this.length&&(this.angle+=this.angular_velocity*t)),e},render:function(t){let e;var n,i,o=this.particles.is_world;e=o?t.worldToScreen(this.position.x,this.position.y,!1):this.position,null===this.length?(t.fillStyle=this.color,n=(i=this.particles.dotSize)/2,t.fillRect(e.x-n,e.y-n,i,i)):(e=this.position,n=Math.cos(this.angle)*this.length/2,i=Math.sin(this.angle)*this.length/2,t.vectorStart(this.color,o,!1),t.vectorMoveTo(e.x+n,e.y+i),t.vectorLineTo(e.x-n,e.y-i),t.vectorEnd())}}),Flynn.Particles=Class.extend({EXPLOSION__VELOCITY_VARIATION:1,SHATTER__DEFAULT_LIFE_RANGE:{min:50,max:60},SHATTER__DEFAULT_VELOCITY_RANGE:{min:.1,max:1.1},SHATTER__DEFAULT_ANGULAR_VELOCITY_RANGE:{min:Math.PI/600,max:Math.PI/120},init:function(t,e){t=void 0!==t&&t,e=void 0===e?2:e,this.particles=[],this.is_world=t,this.dotSize=e,this.draw_warning_issued=!1},explosion:function(e,n,i,o,s){if(!(5==arguments.length&&e instanceof Victor&&s instanceof Victor))throw"API has changed. 5 args. Position and velocity must be instance of Victor.";for(let t=0;t<n;t++){var r=Math.random()*Math.PI*2,l=i*(1-this.EXPLOSION__VELOCITY_VARIATION+Math.random()*this.EXPLOSION__VELOCITY_VARIATION);this.particles.push(new Flynn.Particle(this,e.clone(),s.clone().add(new Victor(Math.cos(r)*l,Math.sin(r)*l)),o))}},shatter:function(t,e){(e=Flynn.Util.defaultArg(e,{})).life_range=Flynn.Util.defaultArg(e.life_range,this.SHATTER__DEFAULT_LIFE_RANGE),e.velocity_range=Flynn.Util.defaultArg(e.velocity_range,this.SHATTER__DEFAULT_VELOCITY_RANGE),e.angular_velocity_range=Flynn.Util.defaultArg(e.angular_velocity_range,this.SHATTER__DEFAULT_ANGULAR_VELOCITY_RANGE),e.base_velocity=Flynn.Util.defaultArg(e.base_velocity,null),e.uniform_exit_angles=Flynn.Util.defaultArg(e.uniform_exit_angles,!1),e.first_exit_angle=Flynn.Util.defaultArg(e.first_exit_angle,null);let n,i,o,s,r,l,a,c,h,u,d,p,_,y,g;if(t.is_world!=this.is_world)throw".is_world must match for polygon and the Particles object.";null===e.base_velocity&&(null==t.velocity?e.base_velocity=new Victor(0,0):e.base_velocity=t.velocity),o=!1,r=t.color,s=!0;const f=[];for(n=0,i=t.points.length;n<i;n+=2)t.points[n]==Flynn.PEN_COMMAND?t.points[n+1]==Flynn.PEN_UP?o=!0:r=Flynn.ColorsOrdered[t.points[n+1]-Flynn.PEN_COLOR0]:(p=t.points[n],_=t.points[n+1],s||o||(l=new Victor((p+y)/2,(_+g)/2).add(t.position),a=new Victor(p-y,_-g),f.push({position:l,segment:a,color:r})),s=!1,o=!1,y=p,g=_);let m;Math.PI;if(e.uniform_exit_angles){var v=2*Math.PI/f.length;if(null===e.first_exit_angle){for(n=0,i=f.length;n<i;n++)m=f[n],m.position_angle=m.position.clone().subtract(t.position).angle();for(f.sort(function(t,e){return t.position_angle-e.position_angle}),u=f[0].position_angle,n=0,i=f.length;n<i;n++)m=f[n],m.exit_angle=u+v*n}else for(n=0,i=f.length;n<i;n++)m=f[n],m.exit_angle=t.angle+e.first_exit_angle+v*n}else for(n=0,i=f.length;n<i;n++)m=f[n],m.exit_angle=m.position.clone().subtract(t.position).angle();for(n=0,i=f.length;n<i;n++){m=f[n],d=Flynn.Util.randomFromInterval(e.velocity_range.min,e.velocity_range.max),c=e.base_velocity.clone().add(new Victor(1,0).rotate(m.exit_angle).multiplyScalar(d)),h=Flynn.Util.randomFromInterval(e.angular_velocity_range.min,e.angular_velocity_range.max),Math.random()<.5&&(h=-h);var E=Flynn.Util.randomFromInterval(e.life_range.min,e.life_range.max);this.particles.push(new Flynn.Particle(this,m.position,c,m.color,E,m.segment.length(),m.segment.angle(),h))}},update:function(n){for(let t=0,e=this.particles.length;t<e;t+=1)this.particles[t].update(n)||(this.particles.splice(t,1),e--,t--)},draw:function(t){this.draw_warning_issued||(this.draw_warning_issued=!0,console.error("Flynn.Particles.Draw() had been deprecated.  Use render()")),this.render(t)},render:function(n){for(let t=0,e=this.particles.length;t<e;t+=1)this.particles[t].render(n)}})}(),function(){"use strict";Flynn.Polygon=Class.extend({init:function(t,e,n,i,o,s){if(6!=arguments.length)throw"Polygon(): init API has changed.";if(!(i instanceof Victor))throw"Polygon(): init API has changed. position must be a Victor object";this.color=e||Flynn.Colors.WHITE,this.position=i.clone(),this.is_world=s,this.points=t.slice(0),this.pointsMaster=t.slice(0),this.bounding_enabled=!1,this.bounding_visible=!1,this.points_bounding=null,this.points_bounding_master=null,this.points_bounding_dirty=!0,this.angle=0,this.scale=n,this.visible=!0,this.setAngle(this.angle),this.constrained=o},setBoundingPoly:function(t){this.points_bounding_master=t.slice(0),this.points_bounding=t.slice(0),this.bounding_enabled=!0;for(let t=0,e=this.points_bounding_master.length;t<e;t+=2)if(this.points_bounding_master[t]==Flynn.PEN_COMMAND)throw"Bounding poly cannot contain PEN_COMMAND."},setAngle:function(t){this.angle=t;var n=Math.cos(t),i=Math.sin(t);for(let t=0,e=this.pointsMaster.length;t<e;t+=2){var o=this.pointsMaster[t],s=this.pointsMaster[t+1];o==Flynn.PEN_COMMAND?(this.points[t]=o,this.points[t+1]=s):(this.points[t]=(n*o-i*s)*this.scale,this.points[t+1]=(i*o+n*s)*this.scale)}this.points_bounding_dirty=!0},getSpan:function(){const n={left:null,right:null,up:null,down:null};let i=!0;for(let t=0,e=this.pointsMaster.length;t<e;t+=2){var o=this.points[t],s=this.points[t+1];o!=Flynn.PEN_COMMAND&&(i?(n.right=o,n.left=o,n.up=s,n.down=s,i=!1):(n.right=Math.max(n.right,o),n.left=Math.min(n.left,o),n.up=Math.min(n.up,s),n.down=Math.max(n.down,s)))}return n},applyAspectRatio:function(n){for(let t=0,e=this.pointsMaster.length;t<e;t+=2){var i=this.pointsMaster[t],o=this.pointsMaster[t+1];i!=Flynn.PEN_COMMAND&&(this.pointsMaster[t+1]=o/n)}},setScale:function(t){this.scale=t,this.setAngle(this.angle),this.points_bounding_dirty=!0},normalizeScale:function(t){for(var e,n,i,o,s,r,l,a,c,h,u=!0,d=0,p=this.pointsMaster.length;d<p;d+=2)s=this.pointsMaster[d],r=this.pointsMaster[d+1],s!=Flynn.PEN_COMMAND&&(o=u?(u=!1,n=e=s,i=r):(e=Math.max(e,s),n=Math.min(n,s),i=Math.max(i,r),Math.min(o,r)));for(l=e-n,a=i-o,Math.max(l,a),c=t?-n-l/2:0,h=t?-o-a/2:0,d=0,p=this.pointsMaster.length;d<p;d+=2)s=this.pointsMaster[d],r=this.pointsMaster[d+1],s!=Flynn.PEN_COMMAND&&(this.pointsMaster[d]=(s+c)/l,this.pointsMaster[d+1]=(r+h)/a);this.points=this.pointsMaster.slice(0)},updateBoundingPoly:function(){if(this.points_bounding_dirty){this.points_bounding_dirty=!1;var n=Math.cos(this.angle),i=Math.sin(this.angle);for(let t=0,e=this.points_bounding_master.length;t<e;t+=2){var o=this.points_bounding_master[t],s=this.points_bounding_master[t+1];this.points_bounding[t]=(n*o-i*s)*this.scale,this.points_bounding[t+1]=(i*o+n*s)*this.scale}}},hasPoint:function(t,e){if(2!=arguments.length)throw"hasPoint(): Temp fix back.";let n=!1,i,o,s;i=this.bounding_enabled?(this.updateBoundingPoly(),this.points_bounding):this.points,o=this.position.x,s=this.position.y;var r=i.length;let l,a,c,h,u,d;for(l=0,a=r-2;l<r;l+=2)c=i[l]+o,h=i[a]+o,u=i[l+1]+s,d=i[a+1]+s,u>e!=d>e&&t<(h-c)*(e-u)/(d-u)+c&&(n=!n),a=l;return n},is_colliding:function(t){let e,n,i,o;if(!this.visible)return!1;for(i=this.position.x,o=this.position.y,e=0,n=this.points.length-2;e<n;e+=2)if(t.hasPoint(this.points[e]+i,this.points[e+1]+o))return!0;return!1},render:function(l){if(this.visible){let t=this.color,e,n,i,o;i=this.position.x,o=this.position.y,l.vectorStart(t,this.is_world,this.constrained);let s=!1,r=!0;for(var a=0,c=this.points.length;a<c;a+=2)this.points[a]==Flynn.PEN_COMMAND?this.points[a+1]==Flynn.PEN_UP?s=!0:(t=Flynn.ColorsOrdered[this.points[a+1]-Flynn.PEN_COLOR0],l.vectorEnd(),l.vectorStart(t,this.is_world,this.constrained),0<a&&l.vectorMoveTo(e+i,n+o)):(e=this.points[a],n=this.points[a+1],r||s?(l.vectorMoveTo(e+i,n+o),s=!1,r=!1):l.vectorLineTo(e+i,n+o));if(l.vectorEnd(),r=!0,this.bounding_visible){for(this.updateBoundingPoly(),t=Flynn.Colors.GRAY,s=!0,l.vectorStart(t,this.is_world,this.constrained),a=0,c=this.points_bounding.length;a<c;a+=2)e=this.points_bounding[a],n=this.points_bounding[a+1],r||s?(l.vectorMoveTo(e+i,n+o),s=!1,r=!1):l.vectorLineTo(e+i,n+o);l.vectorEnd()}}}})}(),function(){"use strict";Flynn.Projectile=Class.extend({init:function(t,e,n,i,o,s){this.position=t,this.velocity=e,this.lifetime=n,this.size=i,this.radius=i/2,this.color=o,this.projectiles=s},kill:function(){this.lifetime=0},update:function(t){let e=!0;return this.lifetime-=t,this.lifetime<=0?e=!1:this.position.add(this.velocity.clone().multiplyScalar(t)),this.projectiles.world_wrap?Flynn.Util.doBoundsWrap(this,this.projectiles.bounds_rect):this.projectiles.bounds_rect.hasPoint(this.position.x,this.position.y)||(e=!1),e},render:function(t){var e;t.fillStyle=this.color,this.projectiles.is_world?(e=t.worldToScreen(this.position.x,this.position.y,!1),t.fillRect(e.x,e.y,this.size,this.size)):t.fillRect(this.position.x,this.position.y,this.size,this.size)}}),Flynn.Projectiles=Class.extend({init:function(t,e,n){if("Flynn.Rect"!=t.object_id)throw"API has changed. Expected bounds_rect type of Flynn.Rect";void 0===e&&(e=!1),void 0===n&&(n=!1),this.bounds_rect=t.clone(),this.is_world=e,this.world_wrap=n,this.projectiles=[]},reset:function(){this.projectiles=[]},add:function(t,e,n,i,o){if(!(t instanceof Victor&&e instanceof Victor))throw"API has changed. Expected position and velocity to be instance of Victor.";this.projectiles.push(new Flynn.Projectile(t.clone(),e.clone(),n,i,o,this))},advanceFrame:function(){this.projectiles[this.projectiles.length-1].update(1)},update:function(n){for(let t=0,e=this.projectiles.length;t<e;t+=1)this.projectiles[t].update(n)||(this.projectiles.splice(t,1),e--,t--)},render:function(n){for(let t=0,e=this.projectiles.length;t<e;t+=1)this.projectiles[t].render(n)}})}(),function(){"use strict";Flynn.State=Class.extend({init:function(){},handleInputs:function(){},update:function(){},render:function(t){}})}(),function(){"use strict";Flynn.StateConfig=Flynn.State.extend({init:function(t,e,n,i,o,s,r){if(this._super(),Flynn.sounds.ui_select.play(),this.OPTION_SELECTION_MARGIN=5,this.OPTION_SELECTION_MARGININ_SET=2,this.OPTION_TEXT_SCALE=2,this.OPTION_CENTER_GAP_WIDTH=2*Flynn.Font.Normal.CharacterWidth*this.OPTION_TEXT_SCALE,this.OPTION_KEY_PROMPT="PRESS NEW KEY",this.OPTION_INPUT_KEY_VALUE_WIDTH=this.OPTION_TEXT_SCALE*Flynn.Font.Normal.CharacterSpacing*this.OPTION_KEY_PROMPT.length+1+2*this.OPTION_SELECTION_MARGIN,void 0===o||void 0===s||void 0===r)throw"API has changed. parentState, abortState & abortEnable are required parameters.";var l;this.parentState=o,this.abortState=s,this.mainTextColor=t,this.menuTextColor=e,this.selectionBoxColor=n,this.menuPromptColor=i,Flynn.mcp.optionManager.removeOption("exitToMenu"),Flynn.mcp.optionManager.removeOption("exitGame"),r?(l=this,Flynn.mcp.optionManager.addOption("exitToMenu",Flynn.OptionType.COMMAND,!0,!0,"EXIT TO MENU",null,function(){Flynn.mcp.changeState(l.abortState)})):Flynn.mcp.backEnabled&&Flynn.mcp.optionManager.addOption("exitGame",Flynn.OptionType.COMMAND,!0,!0,"EXIT GAME",null,function(){window.history.back()}),this.configurableVirtualButtonNames=Flynn.mcp.input.getConfigurableVirtualButtonNames(),this.keyAssignmentInProgress=!1,this.optionKeyNames=Flynn.mcp.optionManager.getOptionKeyNames(),this.numOptions=this.optionKeyNames.length,this.selectedLineIndex=0},handleInputs:function(t,e){var n=this.optionKeyNames[this.selectedLineIndex];let i,o;if(this.keyAssignmentInProgress){var s=t.getCapturedKeyCode();return s&&(t.isKeyCodeAssigned(s)?(o=Flynn.mcp.optionManager.getOption(n),o===s?(this.keyAssignmentInProgress=!1,Flynn.sounds.ui_cancel.play()):(t.armKeyCodeCapture(),console.log("that key is in use"),Flynn.sounds.ui_error.play())):(Flynn.mcp.optionManager.setOption(n,s),this.keyAssignmentInProgress=!1,Flynn.sounds.ui_success.play())),void(t.virtualButtonWasPressed("UI_escape")&&(this.keyAssignmentInProgress=!1,Flynn.sounds.ui_cancel.play()))}const r=Flynn.mcp.optionManager.optionDescriptors[this.optionKeyNames[this.selectedLineIndex]];if(Flynn.mcp.arcadeModeEnabled&&t.virtualButtonWasPressed("quarter")&&(Flynn.mcp.credits+=1,this.insert_coin_sound.play()),t.virtualButtonWasPressed("UI_escape")&&(Flynn.mcp.changeState(this.parentState),Flynn.sounds.ui_cancel.play()),t.virtualButtonWasPressed("UI_down")&&(++this.selectedLineIndex,this.selectedLineIndex>=this.numOptions&&(this.selectedLineIndex=0),Flynn.sounds.ui_move.play()),t.virtualButtonWasPressed("UI_up")&&(--this.selectedLineIndex,this.selectedLineIndex<0&&(this.selectedLineIndex=this.numOptions-1),Flynn.sounds.ui_move.play()),t.virtualButtonWasPressed("UI_enter")){switch(r.type){case Flynn.OptionType.BOOLEAN:Flynn.mcp.optionManager.setOption(r.keyName,!r.currentValue),i=r.commandHandler,null!==i&&i();break;case Flynn.OptionType.INPUT_KEY:t.armKeyCodeCapture(),this.keyAssignmentInProgress=!0;break;case Flynn.OptionType.COMMAND:i=r.commandHandler,null!==i&&i()}Flynn.sounds.ui_select.play()}let l=0;if(t.virtualButtonWasPressed("UI_left")&&(l=-1),t.virtualButtonWasPressed("UI_right")&&(l=1),0!==l&&r.type===Flynn.OptionType.MULTI){let t=r.currentPromptValueIndex();s=r.promptValues.length;t+=l,t<0?t=s-1:t>s-1&&(t=0),Flynn.mcp.optionManager.setOption(r.keyName,r.promptValues[t][1]),Flynn.sounds.ui_select.play()}},update:function(t){},render:function(i){i.vectorText2({text:"CONFIGURATION OPTIONS",scale:4,y:100,color:this.mainTextColor});i.vectorText2({text:"PRESS <UP>/<DOWN> TO SELECT A CONTROL",scale:1.5,y:160,color:this.mainTextColor}),i.vectorText2({text:"PRESS <ENTER> TO EDIT THE SELECTED CONTROL",scale:1.5,y:175,color:this.mainTextColor}),i.vectorText2({text:"PRESS <ESCAPE> TO EXIT/CANCEL",scale:1.5,y:190,color:this.mainTextColor});var o=Flynn.mcp.canvasWidth/2;let s={x:0,y:0,width:0,height:0},r=null,l;for(let n=0,t=this.optionKeyNames.length;n<t;n++){var a=this.optionKeyNames[n];const _=Flynn.mcp.optionManager.optionDescriptors[a];_.type===Flynn.OptionType.COMMAND?(i.vectorText2({text:_.promptText.toUpperCase(),scale:2,y:250+30*n,color:this.menuTextColor}),l=(_.promptText.length*Flynn.Font.Normal.CharacterSpacing-Flynn.Font.Normal.CharacterGap)*this.OPTION_TEXT_SCALE,s={x:Flynn.mcp.canvasWidth/2-l/2-this.OPTION_SELECTION_MARGIN,y:250+30*n-this.OPTION_SELECTION_MARGIN,width:l+2*this.OPTION_SELECTION_MARGIN,height:Flynn.Font.Normal.CharacterHeight*this.OPTION_TEXT_SCALE+2*this.OPTION_SELECTION_MARGIN}):i.vectorText2({text:_.promptText.toUpperCase()+":",scale:2,x:o-this.OPTION_CENTER_GAP_WIDTH/2,y:250+30*n,justify:"right",color:this.menuTextColor});let t="",e=this.menuTextColor;switch(_.type){case Flynn.OptionType.BOOLEAN:t=!0===_.currentValue?"ON":"OFF",l=(3*Flynn.Font.Normal.CharacterSpacing-Flynn.Font.Normal.CharacterGap)*this.OPTION_TEXT_SCALE,s={x:o+this.OPTION_CENTER_GAP_WIDTH/2-this.OPTION_SELECTION_MARGIN,y:250+30*n-this.OPTION_SELECTION_MARGIN,width:l+2*this.OPTION_SELECTION_MARGIN,height:Flynn.Font.Normal.CharacterHeight*this.OPTION_TEXT_SCALE+2*this.OPTION_SELECTION_MARGIN};break;case Flynn.OptionType.MULTI:for(var c=0,h=_.promptValues.length;c<h;c++)t+=_.promptValues[c][0]+"  ";var u=0,d=_.currentPromptValueIndex();for(c=0,h=_.promptValues.length;c<h;c++)c<d&&(u+=_.promptValues[c][0].length+2);l=(_.promptValues[d][0].length*Flynn.Font.Normal.CharacterSpacing-Flynn.Font.Normal.CharacterGap)*this.OPTION_TEXT_SCALE,s={x:o+this.OPTION_CENTER_GAP_WIDTH/2-this.OPTION_SELECTION_MARGIN+u*Flynn.Font.Normal.CharacterSpacing*this.OPTION_TEXT_SCALE,y:250+30*n-this.OPTION_SELECTION_MARGIN,width:l+2*this.OPTION_SELECTION_MARGIN,height:Flynn.Font.Normal.CharacterHeight*this.OPTION_TEXT_SCALE+2*this.OPTION_SELECTION_MARGIN},i.vectorRect(s.x+this.OPTION_SELECTION_MARGININ_SET,s.y+this.OPTION_SELECTION_MARGININ_SET,s.width-2*this.OPTION_SELECTION_MARGININ_SET,s.height-2*this.OPTION_SELECTION_MARGININ_SET,e);break;case Flynn.OptionType.INPUT_KEY:var p=_.currentValue;this.keyAssignmentInProgress&&n===this.selectedLineIndex?(t="PRESS NEW KEY",e=this.menuPromptColor):t=Flynn.mcp.input.keyCodeToKeyName(p).toUpperCase(),s={x:o+this.OPTION_CENTER_GAP_WIDTH/2-this.OPTION_SELECTION_MARGIN,y:250+30*n-this.OPTION_SELECTION_MARGIN,width:this.OPTION_INPUT_KEY_VALUE_WIDTH,height:Flynn.Font.Normal.CharacterHeight*this.OPTION_TEXT_SCALE+2*this.OPTION_SELECTION_MARGIN}}i.vectorText2({text:t,scale:2,x:o+this.OPTION_CENTER_GAP_WIDTH/2,y:250+30*n,justify:"left",color:e}),n===this.selectedLineIndex&&(r=s)}null!==r&&i.vectorRect(r.x,r.y,r.width,r.height,this.selectionBoxColor)}})}(),Flynn.persist=Flynn.persist||{},Flynn.persist.StateEnd={default_leaderboard_name:""},function(){"use strict";Flynn.StateEnd=Flynn.State.extend({CURSOR_BLINK_RATE:2,MAX_NICKNAME_LENGTH:12,TOUCH_KEYBOARD_ROWS:[["Q","W","E","R","T","Y","U","I","O","P","BACK"],["A","S","D","F","G","H","J","K","L","ENTER"],["Z","X","C","V","B","N","M"],["SPACE"]],DEBUG_SHOW_KEY_CENTERS:!1,REFERENCE_KEY_SIZE:48,REFERENCE_KEY_GAP:5,KEYBOARD_MARGIN:5,init:function(t,e,n,i,o,s,r,l,a){if(this._super(),this.score=t,this.leaderboard=e,this.color=n,this.title=i,this.prompt=o,null==r&&(r=!1),null==l&&(l=1),null==a&&(a="0.0"),this.score_is_seconds=r,this.font_aspect_ratio=l,this.game_version=a,void 0===s)throw"API has changed. parentState is now a required parameter.";this.parentState=s,this.nickname="";a=this.leaderboard.getWorstEntry();!this.leaderboard.sortDescending&&this.score<a.score||this.leaderboard.sortDescending&&this.score>a.score?this.hasEnteredName=!1:this.hasEnteredName=this.leaderboard.isFull(),this.hasEnteredName||Flynn.mcp.input.startTextCapture(Flynn.persist.StateEnd.default_leaderboard_name),this.cursorBlinkTimer=0;s=12*this.REFERENCE_KEY_SIZE+10*this.REFERENCE_KEY_GAP,a=(Flynn.mcp.canvasWidth-2*this.KEYBOARD_MARGIN)/s,s=this.TOUCH_KEYBOARD_ROWS.length,s=(s*this.REFERENCE_KEY_SIZE+(s-1)*this.REFERENCE_KEY_GAP)*a;const c={key_size:this.REFERENCE_KEY_SIZE*a,key_gap:this.REFERENCE_KEY_GAP*a,key_separation:null,touch_radius:58*.7,row_jog:.35,y_top:Flynn.mcp.canvasHeight-s-this.KEYBOARD_MARGIN,x_left:this.KEYBOARD_MARGIN,text_scale:3,keys:[]};c.key_separation=c.key_size+c.key_gap,this.touch_keyboard=c;var h=this;let u,d;$.each(this.TOUCH_KEYBOARD_ROWS,function(i,t){d=0,$.each(t,function(t,e){switch(e){case"ENTER":case"BACK":u=2*c.key_size;break;case"SPACE":u=9*c.key_size;break;default:u=c.key_size}const n={text:e,x_left:c.x_left+d+c.key_size*c.row_jog*i,width:u,y_top:c.y_top+i*c.key_separation};n.center_v=new Victor(n.x_left+u/2,n.y_top+c.key_size/2),h.touch_keyboard.keys.push(n),d+=u+c.key_gap})}),Flynn.mcp.input.getLastTouchLocation()},scoreToString:function(t){return this.score_is_seconds?Flynn.Util.ticksToTime(60*t):t.toString()},getAndCleanNickname:function(){Flynn.mcp.input.getTextCapture()!=this.nickname&&(this.nickname=Flynn.mcp.input.getTextCapture(),this.nickname=this.nickname.substring(0,this.MAX_NICKNAME_LENGTH+1),Flynn.mcp.input.setTextCapture(this.nickname))},handleInputs:function(s,t){if(this.hasEnteredName?(s.virtualButtonWasPressed("UI_enter")||Flynn.mcp.browserSupportsTouch&&null!==s.getLastTouchLocation())&&(Flynn.mcp.changeState(this.parentState),Flynn.sounds.ui_move.play()):s.isTextCaptureDone()&&(this.hasEnteredName=!0,this.getAndCleanNickname(),this.leaderboard.add({name:this.nickname,score:this.score,version:this.game_version,timestamp:(new Date).toISOString()}),Flynn.sounds.ui_success.play(),Flynn.persist.StateEnd.default_leaderboard_name=this.nickname,s.virtualButtonWasPressed("UI_enter")),Flynn.mcp.browserSupportsTouch){let i=null,o=1e11;var r=s.getLastTouchLocation();if(null!==r){let n;var l=this;if($.each(this.touch_keyboard.keys,function(t,e){n=e.center_v.distance(r),n<l.touch_keyboard.touch_radius&&n<o&&(i=e,o=n)}),null!==i){let n=i.text.toLowerCase();switch(n){case"back":n="delete";break;case"space":n="spacebar"}$.each(Flynn.KeyboardMap,function(t,e){if(t==n)return s.processTextCapture(e),!1})}}}},update:function(t){this.cursorBlinkTimer+=2*this.CURSOR_BLINK_RATE/60*t,this.hasEnteredName||this.getAndCleanNickname()},render:function(n){if(this.hasEnteredName){n.vectorText2({text:this.title,scale:4,y:130,color:this.color});for(let t=0,e=this.leaderboard.leaderList.length;t<e;t++){var i=this.leaderboard.leaderList[t];n.vectorText2({text:i.name,scale:2,x:Flynn.mcp.canvasWidth/2-152,y:200+25*t,color:this.color,aspect_ratio:this.font_aspect_ratio}),n.vectorText2({text:this.scoreToString(i.score),scale:2,x:Flynn.mcp.canvasWidth/2+148,y:200+25*t,justify:"right",color:this.color,aspect_ratio:this.font_aspect_ratio})}var t=Flynn.mcp.browserSupportsTouch?"TAP ANYWHERE TO CONTINUE":"PRESS <ENTER> TO CONTINUE";n.vectorText2({text:t,scale:2,y:450,color:this.color,aspect_ratio:this.font_aspect_ratio})}else{var o;n.vectorText2({text:this.prompt,scale:3.5,y:100,justify:null,color:this.color,aspect_ratio:this.font_aspect_ratio}),n.vectorText2({text:"TYPE YOUR NAME AND PRESS ENTER",scale:2,y:180,color:this.color,aspect_ratio:this.font_aspect_ratio}),1<this.cursorBlinkTimer%2?n.vectorText2({text:" "+this.nickname+"_",scale:3,y:220,justify:null,color:this.color,aspect_ratio:this.font_aspect_ratio}):n.vectorText2({text:this.nickname,scale:3,y:220,color:this.color,aspect_ratio:this.font_aspect_ratio}),n.vectorText2({text:this.scoreToString(this.score),scale:3,y:300,color:this.color,aspect_ratio:this.font_aspect_ratio}),Flynn.mcp.browserSupportsTouch&&(o=this,$.each(this.touch_keyboard.keys,function(t,e){n.vectorRect(e.x_left,e.y_top,e.width,o.touch_keyboard.key_size,o.color),n.vectorText2({text:e.text,scale:o.touch_keyboard.text_scale,x:e.center_v.x,y:e.center_v.y-Flynn.Font.Normal.CharacterHeight*o.touch_keyboard.text_scale/2,color:this.color,justify:"center",aspect_ratio:this.font_aspect_ratio}),this.DEBUG_SHOW_KEY_CENTERS&&(n.fillStyle=Flynn.Colors.RED,n.fillRect(e.center_v.x-1,e.center_v.y-1,3,3))}))}}})}(),function(){"use strict";Flynn.Text=Class.extend({init:function(t){t=t||{},this.string=String(Flynn.Util.defaultText(t.string,"<TEXT>")),this.scale=t.scale||1,this.x=Flynn.Util.defaultArg(t.x,null),this.y=Flynn.Util.defaultArg(t.y,null),this.justify=t.justify||"left",this.color=t.color||Flynn.Colors.WHITE,this.is_world=t.is_world||!1,this.font=t.font||Flynn.Font.Normal,this.angle=Flynn.Util.defaultArg(t.angle,null),this.aspect_ratio=t.aspect_ratio||1,this.spacing=t.spacing||1,this.transform_f=t.transform_f||null,this.is_constrained=t.is_constrained,null==this.is_constrained&&(this.is_constrained=null==t.angle),this.updatePoints()},setString:function(t){this.string=t,this.updatePoints()},setScale:function(t){this.scale=t,this.updatePoints()},setJustify:function(t){this.justify=t,this.updatePoints()},setFont:function(t){this.font=t,this.updatePoints()},setAngle:function(t){this.angle=t,this.updatePoints()},setSpacing:function(t){this.spacing=t,this.updatePoints()},setTransformF:function(t){this.transform_f=t,this.updatePoints()},updatePoints:function(){var t=Flynn.mcp.canvas.ctx,e=this.scale*this.font.CharacterSpacing*this.spacing;this.points=this.angle?this.createRotatedPoints(t,e):this.createNonRotatedPoints(t,e),this.pointsLength=this.points.length},createNonRotatedPoints:function(t,e){let n,i,o,s,r,l,a=0;switch(this.justify){case"right":a-=e*this.string.length-this.scale*this.font.CharacterGap;break;case"center":a-=e*this.string.length/2-this.scale*this.font.CharacterGap/2;break;case"left":case null:break;default:throw'justify must be one of null, "left", "right", or "center".'}const c=[];for(n=0,i=this.string.length;n<i;n++)if(r=this.string.charCodeAt(n),r!==t.SPACECODE){for(l=t.charToPolygon(r,this.font),o=0,s=l.length;o<s;o+=2)if(0!==o&&l[o]!==Flynn.PEN_COMMAND||(c.push(Flynn.PEN_COMMAND),c.push(Flynn.PEN_UP),0===o)){let t=new Victor(l[o]*this.scale+a,l[o+1]/this.aspect_ratio*this.scale+0);null!==this.transform_f&&(t=this.transform_f(t)),c.push(t.x),c.push(t.y)}a+=e}else a+=e;return c},createRotatedPoints:function(t,e){let n,i,o,s,r,l;const a=new Victor(0,0),c=new Victor(1,0).rotate(this.angle),h=new Victor(0,1).rotate(this.angle),u=new Victor(-(this.string.length*e-this.font.CharacterGap*this.scale)/2,-(this.scale/this.aspect_ratio*this.font.CharacterHeight)/2);u.rotate(this.angle),a.add(u);const d=[];for(n=0,i=this.string.length;n<i;n++)if(r=this.string.charCodeAt(n),r!==t.SPACECODE){for(l=t.charToPolygon(r,this.font),o=0,s=l.length;o<s;o+=2)if(0!==o&&l[o]!==Flynn.PEN_COMMAND||(d.push(Flynn.PEN_COMMAND),d.push(Flynn.PEN_UP),0===o)){let t=a.clone();t.add(c.clone().multiplyScalar(l[o]*this.scale)),t.add(h.clone().multiplyScalar(l[o+1]*this.scale/this.aspect_ratio)),this.transform_f&&(t=this.transform_f(t)),d.push(t.x,t.y)}a.add(c.clone().multiplyScalar(this.scale*this.font.CharacterSpacing))}else a.add(c.clone().multiplyScalar(this.scale*this.font.CharacterSpacing));return d},render:function(e){e.vectorStart(this.color,this.is_world,this.is_constrained);let n=!1;for(let t=0;t<this.pointsLength;t+=2){var i=this.points[t],o=this.points[t+1];i!==Flynn.PEN_COMMAND||o!==Flynn.PEN_UP?0===t||n?(e.vectorMoveTo(this.x+i,this.y+o),n=!1):e.vectorLineTo(this.x+i,this.y+o):n=!0}e.vectorEnd()}})}(),function(){"use strict";Flynn.Timer=Class.extend({init:function(t,e,n){this.name=t,this.tickCounter=e,this.callback=n,this.expired=!1}}),Flynn.Timers=Class.extend({init:function(){this.timers={}},add:function(t,e,n){t in this.timers?(this.set(t,e),this.timers[t].callback=n):this.timers[t]=new Flynn.Timer(t,e,n)},set:function(t,e){const n=this.timers[t];n.tickCounter=e,n.expired=!1},get:function(t){return this.timers[t].tickCounter},isRunning:function(t){return 0<this.timers[t].tickCounter},hasExpired:function(t){const e=this.timers[t];return!!e.expired&&!(e.expired=!1)},remove:function(t){delete this.timers[t]},update:function(t){for(const e in this.timers){const n=this.timers[e];0<n.tickCounter&&(n.tickCounter-=t,n.tickCounter<=0&&(n.tickCounter=0,n.expired=!0,n.callback&&n.callback()))}}})}(),function(){"use strict";Flynn.Util={getUrlValue:function(e){const t=window.location.search.substring(1),n=t.split("&");for(let t=0;t<n.length;t++){var i=n[t].split("=");if(i[0]==e)return i[1]}},getUrlFlag:function(e){const t=window.location.search.substring(1),n=t.split("&");for(let t=0;t<n.length;t++)if(n[t].split("=")[0]==e)return!0;return!1},hexToRgb:function(t){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},componentToHex:function(t){t=Math.floor(t).toString(16);return 1==t.length?"0"+t:t},defaultTrue:function(t){return void 0===t||t},defaultArg:function(t,e){return null==t?e:t},defaultText:function(t,e){return null==t||null==t?e:t},rgbToHex:function(t,e,n){return"#"+Flynn.Util.componentToHex(t)+Flynn.Util.componentToHex(e)+Flynn.Util.componentToHex(n)},heatmap:function(t){let e,n,i;t=Flynn.Util.minMaxBound(t,0,1),e=0,i=0,.5<=t&&(e=255*(t-.5)*2,n=255*(1-t)*2),t<.5&&(i=255*(.5-t)*2,n=255*t*2);t=Math.max(e,n,i);return Flynn.Util.rgbToHex(255*e/t,255*n/t,255*i/t)},colorOverdrive:function(t,e){let n,i,o,s,r,l;i=Flynn.Util.hexToRgb(t),o=Math.max(i.r,i.g,i.b)/255,s=1-o;return e*=.2+.8*o,0==o?"#000000":e<=s?(n=(o+e)/o,i.r=i.r*n,i.g=i.g*n,i.b=i.b*n,i.r=Math.min(i.r,255),i.g=Math.min(i.g,255),i.b=Math.min(i.b,255),Flynn.Util.rgbToHex(i.r,i.g,i.b)):(n=(o+s)/o,i.r=i.r*n,i.g=i.g*n,i.b=i.b*n,i.r=Math.min(i.r,255),i.g=Math.min(i.g,255),i.b=Math.min(i.b,255),r=Math.min(e-s,1),l=Flynn.Util.rgbToHex(i.r,i.g,i.b),Flynn.Util.shadeColor(l,r))},angleBound2Pi:function(t){let e=t%(2*Math.PI);return e<0&&(e+=2*Math.PI),e},minMaxBound:function(t,e,n){return t<e?e:n<t?n:t},minMaxBoundWrap:function(t,e,n){return t<e?n:n<t?e:t},proximal:function(t,e,n){return Math.abs(e-n)<=t},distance:function(t,e,n,i){return Math.sqrt(Math.pow(n-t,2)+Math.pow(i-e,2))},interceptSolution:function(t,e,n,i){const o={perfect:!1,velocity_v:null},s=t.clone().subtract(n).normalize();n=s.dot(e),n=s.clone().multiply(new Victor(n,n));const r=e.clone().subtract(n),l=r.clone();n=l.magnitude(),n=i*i-n*n;let a=0;0<n&&(a=Math.sqrt(n));const c=s.clone().multiply(new Victor(a,a));return o.velocity_v=c.add(l),o},zeroPad:function(t,e){e=e-t.toString().length+1;return Array(+(0<e&&e)).join("0")+t},ticksToTime:function(t){var e=t/60,n=Math.floor(100*(e-Math.floor(e))),e=Math.floor(e/60),t=Math.floor((t-60*e*60)/60);return Flynn.Util.zeroPad(e,2)+":"+Flynn.Util.zeroPad(t,2)+"."+Flynn.Util.zeroPad(n,2)},randomAngle:function(){return Math.random()*Math.PI*2},randomIntFromInterval:function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},randomFromInterval:function(t,e){return Math.random()*(e-t)+t},randomChoice:function(t){return t[this.randomIntFromInterval(0,t.length-1)]},randomShuffle:function(t){let e=(t=t.slice()).length,n,i;for(;0!==e;)i=Math.floor(Math.random()*e),--e,n=t[e],t[e]=t[i],t[i]=n;return t},shadeBlend:function(t,e,n){var i=t<0?-1*t:t;const o=Math.round,s=parseInt;if(7<e.length){var r=e.split(","),l=(n||(t<0?"rgb(0,0,0)":"rgb(255,255,255)")).split(","),a=s(r[0].slice(4)),c=s(r[1]),h=s(r[2]);return"rgb("+(o((s(l[0].slice(4))-a)*i)+a)+","+(o((s(l[1])-c)*i)+c)+","+(o((s(l[2])-h)*i)+h)+")"}r=s(e.slice(1),16),l=s((n||(t<0?"#000000":"#FFFFFF")).slice(1),16),n=r>>16,t=r>>8&255,r&=255;return"#"+(16777216+65536*(o(((l>>16)-n)*i)+n)+256*(o(((l>>8&255)-t)*i)+t)+(o(((255&l)-r)*i)+r)).toString(16).slice(1)},shadeColor:function(t,e){var n=parseInt(t.slice(1),16),i=e<0?0:255,o=e<0?-1*e:e,t=n>>16,e=n>>8&255,n=255&n;return"#"+(16777216+65536*(Math.round((i-t)*o)+t)+256*(Math.round((i-e)*o)+e)+(Math.round((i-n)*o)+n)).toString(16).slice(1)},is_mobile_browser:function(){let t=!1;var e;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},is_mobile_or_tablet_browser:function(){let t=!1;var e;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},logish:function(t,e,n,i){t=(t-e)/(n-e);return Math.pow(t,i)*(n-e)+e},event_simulator:{simulate:function(t,e){const n=Flynn.Util.event_simulator,i=n.extend(n.defaultOptions,arguments[2]||{});let o,s=null;for(const l in n.eventMatchers)if(n.eventMatchers[l].test(e)){s=l;break}if(!s)throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported");var r;return document.createEvent?(o=document.createEvent(s),"HTMLEvents"==s?o.initEvent(e,i.bubbles,i.cancelable):o.initMouseEvent(e,i.bubbles,i.cancelable,document.defaultView,i.button,i.pointerX,i.pointerY,i.pointerX,i.pointerY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,t),t.dispatchEvent(o)):(i.clientX=i.pointerX,i.clientY=i.pointerY,r=document.createEventObject(),o=n.extend(r,i),t.fireEvent("on"+e,o)),t},extend:function(t,e){for(const n in e)t[n]=e[n];return t},eventMatchers:{HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|dblclick|mouse(?:down|up|over|move|out))$/},defaultOptions:{pointerX:0,pointerY:0,button:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0}},make_regular_polygon_points:function(t,e){if(t<3)throw"make_regular_polygon_points(): num_sides must be 3 or greater";let n,i;for(n=[],i=0;i<=2*Math.PI;i+=2*Math.PI/t)n.push(Math.cos(i)*e),n.push(Math.sin(i)*e);return n},is_colliding:function(t,e){return t.position.distance(e.position)<t.radius+e.radius},resolve_collision:function(t,e){const n=t.position.clone().subtract(e.position);var i=n.length();const o=n.clone().multiplyScalar((t.radius+e.radius-i)/i);var s=1/t.mass,r=1/e.mass;t.position.add(o.clone().multiplyScalar(s/(s+r))),e.position.subtract(o.clone().multiplyScalar(r/(s+r)));const l=t.velocity.clone().subtract(e.velocity);i=l.dot(o.clone().normalize());if(i<0){i=-2*i/(s+r);const a=o.clone().normalize().multiplyScalar(i);t.velocity.add(a.clone().multiplyScalar(s)),e.velocity.subtract(a.clone().multiplyScalar(r))}},doBoundsBounce:function(t,e,n){return t.position.x<e.left+t.radius?(t.position.x=e.left+t.radius+(e.left+t.radius-t.position.x),t.velocity.x=-t.velocity.x*n,!0):t.position.x>e.right-t.radius?(t.position.x=e.right-t.radius-(t.position.x-(e.right-t.radius)),t.velocity.x=-t.velocity.x*n,!0):t.position.y<e.top+t.radius?(t.position.y=e.top+t.radius+(e.top+t.radius-t.position.y),t.velocity.y=-t.velocity.y*n,!0):t.position.y>e.bottom-t.radius&&(t.position.y=e.bottom-t.radius-(t.position.y-(e.bottom-t.radius)),t.velocity.y=-t.velocity.y*n,!0)},doBoundsWrap:function(t,e){t.position.x<e.left?t.position.x+=e.width:t.position.x>e.right&&(t.position.x-=e.width),t.position.y<e.top?t.position.y+=e.height:t.position.y>e.bottom&&(t.position.y-=e.height)},parseColor:function(t,e){return!0===e?"number"==typeof t?0|t:("string"==typeof t&&"#"===t[0]&&(t=t.slice(1)),window.parseInt(t,16)):"number"==typeof t?"#"+("00000"+(0|t).toString(16)).substr(-6):t},validateProperties:function(t,e,n){let i,o;var s=Object.keys(n);const r=e.concat(s),l=Object.keys(t);for(i=0;i<e.length;i++)if(o=e[i],-1==l.indexOf(o))throw Error('Required key "'+o+'" not present in object.');for(i=0;i<l.length;i++)if(o=l[i],-1==r.indexOf(o))throw Error('Unexpected key "'+o+'" in object.');for(i=0;i<s.length;i++)o=s[i],-1==l.indexOf(o)&&(t[o]=n[o])}},Flynn.WrapUtil=Class.extend({init:function(t){this.bounds=t},getRelativePosition:function(t,e){var n=t.x-this.bounds.width/2,i=t.y-this.bounds.height/2;let o=e.x-n,s=e.y-i;return o<0?o+=this.bounds.width:o>this.bounds.width&&(o-=this.bounds.width),s<0?s+=this.bounds.height:s>this.bounds.height&&(s-=this.bounds.height),new Victor(n+o-t.x,i+s-t.y)}})}();var Game=Game||{};!function(){"use strict";Flynn.VALogo=Class.extend({POINTS:{FLASK:[-6,-12,9e3,8012,-5,-12,-5,-1,-10,6,-10,10,-8,12,8,12,10,10,10,6,5,-1,5,-12,6,-12,9e3,7e3,3,-9,9e3,8009,3,0,8,7,8,9,7,10,-7,10,-8,9,-8,7,-3,0,-3,-9,3,-9],INNER_BOUNDS:[3,-9,3,0,8,7,8,9,7,10,-7,10,-8,9,-8,7,-3,0,-3,-9,3,-9]},FLASK_INNER_X_MAX:8,FLASK_INNER_Y_MAX:10,FLASK_INNER_Y_MIN:-9,FLASK_VAPOR_Y_MIN:-30,BUBBLE_BOTTOM_PROBABILITY:.8,BUBBLE_RATE:4,BUBBLE_ACCELERATION:.002,BUBBLE_DECELERARION:.003,BUBBLE_DIE_VELOCITY:-.001,BUBBLE_GROW_RATE:.007,BUBBLE_DIE_RATE_MIN:-.001,BUBBLE_DIE_RATE_MAX:-.05,WIGGLE_RATE_ACCELERATION:1e-4,WIGGLE_RATE_MAX:.03,WIGGLE_DISPLACEMENT_ANGLE:Math.PI/6,init:function(t,e,n){if(3<arguments.length)throw"VALogo(): init API has changed.";if(!(t instanceof Victor))throw"VALogo(): Position must be a Victor object";this.position=t,this.scale=e,this.bubbles=[],this.wiggle_angle=0,void(this.wiggle_rate=0)===n&&(n=!0),this.text_color=n?"#C0E0C0":Flynn.Colors.GRAY,this.flask=new Flynn.Polygon(this.POINTS.FLASK,Flynn.Colors.WHITE,e,t,!1,!1),this.inner_bounds=new Flynn.Polygon(this.POINTS.INNER_BOUNDS,Flynn.Colors.WHITE,e,t,!1,!1),this.angle=0,this.spin_rate=Math.PI/300;for(let t=this.bubble_time=0;t<180;t++)this.update(1),this.wiggle_angle=0,this.wiggle_rate=0},bubble_in_inner:function(t){var e=0<t.x?2:-1;return this.inner_bounds.hasPoint(t.x*this.scale+this.position.x+e,t.y*this.scale+this.position.y)},update:function(e){if(this.wiggle_rate+=this.WIGGLE_RATE_ACCELERATION*e,this.wiggle_rate=Math.min(this.wiggle_rate,this.WIGGLE_RATE_MAX),this.wiggle_angle+=this.wiggle_rate*e,this.angle=Math.sin(this.wiggle_angle)*this.WIGGLE_DISPLACEMENT_ANGLE,this.bubble_time+=e,this.bubble_time>this.BUBBLE_RATE){this.bubble_time-=this.BUBBLE_RATE;const t={velocity:0,brightness:0,die_rate:Flynn.Util.randomFromInterval(this.BUBBLE_DIE_RATE_MIN,this.BUBBLE_DIE_RATE_MAX)};t.x=Flynn.Util.randomFromInterval(-this.FLASK_INNER_X_MAX,this.FLASK_INNER_X_MAX),t.x=this.FLASK_INNER_X_MAX*Flynn.Util.logish(Math.random(),0,1,2),Math.random()<.5&&(t.x=-t.x),Math.random()<this.BUBBLE_BOTTOM_PROBABILITY?t.y=this.FLASK_INNER_Y_MAX-1:t.y=Flynn.Util.randomFromInterval(this.FLASK_INNER_Y_MIN,this.FLASK_INNER_Y_MAX),this.bubble_in_inner(t)&&this.bubbles.push(t)}let n=this.bubbles.length;var i=this.BUBBLE_ACCELERATION*e,o=this.BUBBLE_DECELERARION*e;for(let t=0;t<n;t++){const s=this.bubbles[t];if(s.y>this.FLASK_INNER_Y_MIN?s.brightness+=this.BUBBLE_GROW_RATE*e:s.brightness+=s.die_rate*e,s.brightness=Flynn.Util.minMaxBound(s.brightness,0,1),s.y>this.FLASK_INNER_Y_MIN)s.velocity-=i;else if(s.velocity+=o,s.velocity>=this.BUBBLE_DIE_VELOCITY){this.bubbles.splice(t,1),--t,--n;continue}s.y+=s.velocity*e,s.y>this.FLASK_INNER_Y_MIN?this.bubble_in_inner(s)||(0<s.x?s.x-=.2:s.x+=.2):s.x+=.2*e*Math.sin(this.wiggle_angle-Math.PI/4)*this.wiggle_rate/this.WIGGLE_RATE_MAX,s.y<this.FLASK_VAPOR_Y_MIN&&(this.bubbles.splice(t,1),--t,--n)}},render:function(e){var n=this.bubbles.length;for(let t=0;t<n;t++)e.fillStyle=Flynn.Colors.ORANGE,this.bubbles[t].y>this.FLASK_INNER_Y_MIN?e.fillStyle=Flynn.Util.shadeBlend(-(1-this.bubbles[t].brightness),Flynn.Colors.ORANGE):e.fillStyle=Flynn.Util.shadeBlend(-(1-this.bubbles[t].brightness),"#808080"),e.fillRect(this.bubbles[t].x*this.scale+this.position.x,this.bubbles[t].y*this.scale+this.position.y+1,2,2);this.flask.render(e),e.vectorTextArc2({text:"VECTOR",scale:1.4*this.scale,center_x:this.position.x,center_y:this.position.y,angle:-Math.PI/2+this.angle,radius:40*this.scale,color:this.text_color,is_centered:!0,is_reversed:!1,font:Flynn.Font.Block,stretch:2}),e.vectorTextArc2({text:"ALCHEMY",scale:1.4*this.scale,center_x:this.position.x,center_y:this.position.y,angle:Math.PI/2+this.angle,radius:40*this.scale,color:this.text_color,is_centered:!0,is_reversed:!0,font:Flynn.Font.Block,stretch:2})}})}(),function(){"use strict";Flynn.monkeyPatchVictor=function(){if("undefined"==typeof Victor)throw"Victor.js must be loaded before monkeyPatchVictor() is run.";Victor.fromPolar=function(t,e){return void 0===e&&(e=1),new Victor(Math.cos(t)*e,Math.sin(t)*e)},Victor.randomDirection=function(t){void 0===t&&(t=1);var e=Math.random()*Math.PI*2;return new Victor(Math.cos(e)*t,Math.sin(e)*t)},Victor.prototype.boundMagnitude=function(t){var e=this.magnitude();return t<e&&this.multiplyScalar(t/e),this}}}(),function(){"use strict";Flynn.VirtualJoystick=Class.extend({STICK_LIMIT_RATIO:.9,D_WITDH:.6,D_LENGH:.85,INNER_RADIUS_RATIO:.66,init:function(t){(t=t||{}).button_map=t.button_map||{},this.color=t.color||16777215,this.alpha=t.alpha||.3,this.pos=t.pos||{x:100,y:100},this.radius=t.radius||60,this.deadzone_radius=t.deadzone_radius||8,this.capture_radius=t.capture_radius||this.radius,this.visible_states=t.visible_states||null,this.type=t.type||"stick",this.name=t.name||"joystick0",this.buttons={up:{name:t.button_map.up||null,pressed:!1},down:{name:t.button_map.down||null,pressed:!1},right:{name:t.button_map.right||null,pressed:!1},left:{name:t.button_map.left||null,pressed:!1}},this.limit_radius=this.radius*this.STICK_LIMIT_RATIO,this.touchstart_pos={x:0,y:0},this.stick_offset={x:0,y:0},this.analog_pos={x:0,y:0},this.in_use=!1,this.touch_identifier=null,this.is_visible=!1,this.theshold=Math.sin(Math.PI/8)},clear_all:function(){this.in_use=!1,this.touch_identifier=null,this.stick_offset={x:0,y:0},this.buttons.down.pressed=!1,this.buttons.up.pressed=!1,this.buttons.right.pressed=!1,this.buttons.left.pressed=!1},updateVisibility:function(t){let e,n;if(this.visible_states){for(e=0,n=this.visible_states.length;e<n;e++)if(t==this.visible_states[e])return void(this.is_visible=!0);this.is_visible=!1}else this.is_visible=!0},handleTouchStart:function(t,e,n){let i=!1;return this.is_visible&&Flynn.Util.distance(t,e,this.pos.x,this.pos.y)<this.capture_radius&&(this.touch_identifier=n,this.in_use=!0,"stick"==this.type||"analog"==this.type?(this.touchstart_pos={x:t,y:e},this.stick_offset={x:0,y:0}):this.handleTouchMove(t,e,n),i=!0),i},handleTouchEnd:function(t,e,n){let i=!1;return this.is_visible&&n==this.touch_identifier&&(this.clear_all(),i=!0,"analog"==this.type&&(this.analog_pos.x=0,this.analog_pos.y=0)),i},handleTouchMove:function(i,o,t){if(this.is_visible&&t==this.touch_identifier){let t,e,n;"stick"==this.type||"analog"==this.type?(t=new Victor(i-this.touchstart_pos.x,o-this.touchstart_pos.y),e=t.clone().normalize(),n=t.length(),n>this.limit_radius&&(t=e.clone().multiply(new Victor(this.limit_radius,this.limit_radius)),n=this.limit_radius),this.stick_offset.x=t.x,this.stick_offset.y=t.y,"analog"==this.type?(this.analog_pos.x=t.x/this.limit_radius,this.analog_pos.y=t.y/this.limit_radius):n>this.deadzone_radius?(this.buttons.down.pressed=e.y>this.theshold,this.buttons.up.pressed=e.y<-this.theshold,this.buttons.right.pressed=e.x>this.theshold,this.buttons.left.pressed=e.x<-this.theshold):(this.buttons.down.pressed=!1,this.buttons.up.pressed=!1,this.buttons.right.pressed=!1,this.buttons.left.pressed=!1)):(t=new Victor(i-this.pos.x,o-this.pos.y),e=t.clone().normalize(),n=t.length(),n>this.deadzone_radius&&n<this.limit_radius?(this.buttons.down.pressed=e.y>this.theshold,this.buttons.up.pressed=e.y<-this.theshold,this.buttons.right.pressed=e.x>this.theshold,this.buttons.left.pressed=e.x<-this.theshold):(this.buttons.down.pressed=!1,this.buttons.up.pressed=!1,this.buttons.right.pressed=!1,this.buttons.left.pressed=!1))}},render:function(t){if(this.is_visible){const s=t.graphics;var e,n,i,o;if("dpad"==this.type?(e=this.radius*this.D_WITDH/2,n=this.radius*this.D_LENGH,i=this.pos.x,o=this.pos.y,s.lineStyle(6,this.color,this.alpha),s.moveTo(i+e,o-n),s.lineTo(i+e,o-e),s.lineTo(i+n,o-e),s.lineTo(i+n,o+e),s.lineTo(i+e,o+e),s.lineTo(i+e,o+n),s.lineTo(i-e,o+n),s.lineTo(i-e,o+e),s.lineTo(i-n,o+e),s.lineTo(i-n,o-e),s.lineTo(i-e,o-e),s.lineTo(i-e,o-n),s.lineTo(i+e,o-n)):(s.lineStyle(6,this.color,this.alpha),s.drawCircle(this.pos.x,this.pos.y,this.radius*this.INNER_RADIUS_RATIO)),"stick"==this.type){let t,e,n,i;for(s.lineStyle(1,this.color,this.alpha),t=0;t<8;t++)e=Math.PI/4*t+Math.PI/8,n=Math.cos(e),i=Math.sin(e),s.moveTo(n*(this.radius*this.INNER_RADIUS_RATIO+3)+this.pos.x,i*(this.radius*this.INNER_RADIUS_RATIO+3)+this.pos.y),s.lineTo(n*(this.radius-1)+this.pos.x,i*(this.radius-1)+this.pos.y)}s.lineStyle(2,this.color,this.alpha),t.graphics.drawCircle(this.pos.x,this.pos.y,this.radius),!this.in_use||"stick"!=this.type&&"analog"!=this.type||(s.lineStyle(6,this.color,this.alpha),t.graphics.drawCircle(this.pos.x+this.stick_offset.x,this.pos.y+this.stick_offset.y,this.radius*this.INNER_RADIUS_RATIO))}}})}();